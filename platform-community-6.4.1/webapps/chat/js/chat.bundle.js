define((()=>(()=>{"use strict";var t={d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{init:()=>Ge});var s={};t.r(s),t.d(s,{deleteMessage:()=>B,deleteRoom:()=>V,initChatCometdHandshake:()=>L,initChatConnectionListener:()=>k,initSettings:()=>D,isConnected:()=>F,leaveRoom:()=>G,registreEventListener:()=>q,sendMessage:()=>X,setRoomMessagesAsRead:()=>H,setStatus:()=>U,unregistreEventListener:()=>j});var o={};t.r(o),t.d(o,{escapeHtml:()=>Ut,getBaseURL:()=>Pt,getChatRooms:()=>pt,getChatUsers:()=>Mt,getModalParticipantsToSuggest:()=>wt,getNotReadMessages:()=>tt,getOnlineUsers:()=>nt,getReceiversForMessagePushNotif:()=>ut,getRoomDetail:()=>Ct,getRoomId:()=>_t,getRoomMessages:()=>St,getRoomParticipants:()=>Et,getRoomParticipantsCount:()=>gt,getRoomParticipantsToSuggest:()=>bt,getSpaceAvatar:()=>Q,getSpaceByPrettyName:()=>kt,getSpaceProfileLink:()=>Dt,getUserAvatar:()=>J,getUserChatRooms:()=>ft,getUserInfo:()=>It,getUserNotificationSettings:()=>Nt,getUserProfileLink:()=>$t,getUserSettings:()=>it,getUserState:()=>lt,getUserStatus:()=>Y,getUsersToMention:()=>vt,initChatSettings:()=>et,initSettings:()=>st,isRoomEnabled:()=>Vt,loadNotificationSettings:()=>Ot,saveRoom:()=>xt,sendMeetingNotes:()=>Lt,sendMentionNotification:()=>rt,sendMessageReceivedNotification:()=>ct,setExternal:()=>mt,setProfileStatus:()=>at,setRoomNotificationTrigger:()=>Tt,setUserNotificationPreferences:()=>At,setUserPreferredNotification:()=>yt,setUserStatus:()=>Z,toggleFavorite:()=>ht,unescapeHtml:()=>Ft,updateRoomEnabled:()=>Gt,updateRoomMeetingStatus:()=>Rt,updateTotalUnread:()=>ot,updateUser:()=>dt});const a={PORTAL:eXo.env.portal.context||"",PORTAL_NAME:eXo.env.portal.portalName||"",PORTAL_REST:eXo.env.portal.rest,SOCIAL_USER_API:`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/social/users/`,SOCIAL_SPACE_API:`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/social/spaces/`,PEOPLE_INFO_API:`${eXo.env.portal.context}/${eXo.env.portal.rest}/social/people/getPeopleInfo/{0}.json`,USER_STATE_API:`${eXo.env.portal.context}/${eXo.env.portal.rest}/state/status/`,BY_PRETTY_NAME:"byPrettyName/",CHAT_API:"/chat/api/1.0/user/",PROFILE_PAGE_NAME:"profile",PROFILE_SPACE_LINK:"/g/",CHAT_SERVER_API:"/chatServer/",CHAT_PLUGIN_API:"/chat/api/1.0/plugin/",UPLOAD_API:"/portal/rest/chat/api/1.0/file/upload",FILE_PERSIST_URL:"/portal/rest/chat/api/1.0/file/persist",DEFAULT_ROOM_AVATAR:"/chat/img/room-default.jpg",MAX_UPLOAD_FILES:1,ON_SITE_NOTIF:"on-site",DESKTOP_NOTIF:"desktop",BIP_NOTIF:"bip",NOT_DISTURB_NOTIF:"notify-even-not-disturb",STORED_PARAM_TYPE_FILTER:"exo-chat-typeFilter",TYPE_FILTER_DEFAULT:"All",STORED_PARAM_SORT_FILTER:"exo-chat-sortFilter",SORT_FILTER_DEFAULT:"Recent",STORED_PARAM_TERM_FILTER:"exo-chat-termFilter",TERM_FILTER_DEFAULT:"",CONTACTS_PER_PAGE:20,ROOMS_PER_PAGE:20,ADD_TEAM_MESSAGE:"type-add-team-user",REMOVE_TEAM_MESSAGE:"type-remove-team-user",EVENT_MESSAGE:"type-event",FILE_MESSAGE:"type-file",LINK_MESSAGE:"type-link",RAISE_HAND:"type-hand",QUESTION_MESSAGE:"type-question",NOTES_MESSAGE:"type-notes",MEETING_START_MESSAGE:"type-meeting-start",MEETING_STOP_MESSAGE:"type-meeting-stop",ADD_USER_MESSAGE:"type-add-team-user",REMOVE_USER_MESSAGE:"type-remove-team-user",CALL_JOIN_MESSAGE:"call-join",CALL_ON_MESSAGE:"call-on",CALL_OFF_MESSAGE:"call-off",DELETED_MESSAGE:"DELETED",EDITED_MESSAGE:"EDITED",ROOM_MEMBER_LEFT:"room-member-left",ANIMATION_PERIOD:200,ANIMATION_DURATION:3e3,LOADING_ANIMATION_DURATION:3e3,MESSAGES_PER_PAGE:50,MAX_SCROLL_POSITION_FOR_AUTOMATIC_SCROLL:25,ENTER_CODE_KEY:13,STORED_PARAM_STATUS_FILTER:"exo-chat-roomParticipantFilter",STATUS_FILTER_DEFAULT:"All",REATTEMPT_PERIOD:1e3,NB_MILLISECONDS_PERD_SECOND:1e3,STORED_PARAM_LAST_SELECTED_ROOM:"exo-chat-lastSelectedRoom",STORED_PARAM_PENDING_MESSAGES:"exo-chat-pendingMessages",STORED_PARAM_MESSAGES_SENDING:"exo-chat-messagesSending",STORED_PARAM_LAST_NOTIFY:"exo-chat-lastNotify",STORED_PARAM_OPENED_MINI_CHAT_ROOM:"exo-chat-openedMiniChatRoom",STORED_PARAM_MEETING_STARTED:"exo-chat-meetingStarted",ACTION_MESSAGE_SEND:"exo-chat-message-tosend-requested",ACTION_MESSAGE_EDIT:"exo-chat-message-action-edit-requested",ACTION_MESSAGE_QUOTE:"exo-chat-message-action-quote-requested",ACTION_MESSAGE_EDIT_LAST:"exo-chat-message-edit-last-requested",ACTION_MESSAGE_SEARCH:"exo-chat-message-search-requested",ACTION_MESSAGE_DELETE:"exo-chat-message-todelete-requested",ACTION_ROOM_SET_READ:"exo-chat-set-room-as-read-requested",ACTION_ROOM_SELECT:"exo-chat-select-room-requested",ACTION_ROOM_DELETE:"exo-chat-setting-deleteRoom-requested",ACTION_ROOM_EDIT:"exo-chat-setting-editRoom-requested",ACTION_ROOM_LEAVE:"exo-chat-setting-leaveRoom-requested",ACTION_ROOM_OPEN_SETTINGS:"exo-chat-setting-notificationSettings-requested",ACTION_ROOM_START_MEETING:"exo-chat-setting-startMeeting-requested",ACTION_ROOM_STOP_MEETING:"exo-chat-setting-stopMeeting-requested",ACTION_ROOM_FAVORITE_ADD:"exo-chat-setting-addToFavorite-requested",ACTION_ROOM_FAVORITE_REMOVE:"exo-chat-setting-removeFromFavorite-requested",ACTION_ROOM_SHOW_PARTICIPANTS:"exo-chat-setting-showParticipants-requested",ACTION_APPS_CLOSE:"exo-chat-apps-close-requested",ACTION_ROOM_OPEN_CHAT:"exo-chat-room-open-requested",ACTION_FILTER_ROOM_TYPE:"exo-chat-room-filter-changed",ACTION_CHAT_OPEN_DRAWER:"exo-chat-open-drawer",ACTION_CHAT_OPEN_QUICK_CREATE_DISCUSSION_DRAWER:"exo-chat-open-quick-create-discussion-drawer",EVENT_CONNECTED:"exo-chat-connected",EVENT_DISCONNECTED:"exo-chat-disconnected",EVENT_RECONNECTED:"exo-chat-reconnected",EVENT_LOGGED_OUT:"exo-chat-logout-sent",EVENT_MESSAGE_RECEIVED:"exo-chat-message-sent",EVENT_MESSAGE_DELETED:"exo-chat-message-deleted",EVENT_MESSAGE_NOT_SENT:"exo-chat-message-not-sent",EVENT_MESSAGE_SENT:"exo-chat-message-sent-ack",EVENT_MESSAGE_READ:"exo-chat-message-read",EVENT_MESSAGE_UPDATED:"exo-chat-message-updated",EVENT_MESSAGE_STATISTIC:"exo-statistic-message",EVENT_GLOBAL_UNREAD_COUNT_UPDATED:"exo-chat-notification-count-updated",ROOM_NOTIFICATION_SETTINGS_UPDATED:"exo-chat-room-notification-settings-updated",EVENT_ROOM_PARTICIPANTS_LOADED:"exo-chat-participants-loaded",EVENT_ROOM_DELETED:"exo-chat-room-deleted",EVENT_ROOM_FAVORITE_ADDED:"exo-chat-room-favorite-added",EVENT_ROOM_FAVORITE_REMOVED:"exo-chat-room-favorite-removed",EVENT_ROOM_MEMBER_JOINED:"exo-chat-room-member-joined",EVENT_ROOM_MEMBER_LEFT:"exo-chat-room-member-left",EVENT_ROOM_UPDATED:"exo-chat-room-updated",EVENT_ROOM_SELECTION_CHANGED:"exo-chat-selected-contact-changed",EVENT_USER_SETTINGS_LOADED:"exo-chat-settings-loaded",EVENT_USER_STATUS_CHANGED:"exo-chat-user-status-changed",RESEND_FAILED_MESSAGE:"exo-chat-resend-failed-message",DELETE_FAILED_MESSAGE:"exo-chat-delete-failed-message",DEFAULT_OFFSET:0,DEFAULT_USER_LIMIT:20};let i=!1,n=!1;function r(){i||(eXo=eXo||{},eXo.social=eXo.social?eXo.social:{},eXo.social.tiptip=eXo.social.tiptip?eXo.social.tiptip:{},eXo.social.tiptip.extraActions=eXo.social.tiptip.extraActions?eXo.social.tiptip.extraActions:[],eXo.social.tiptip.extraActions.push({appendContentTo(t,e,s){s||(s="username"),t.append(`<a title="Chat"\n          class="chatPopupOverlay chatPopup"\n          type="button"\n          onclick="document.dispatchEvent(new CustomEvent('${a.ACTION_ROOM_OPEN_CHAT}', {detail: {name: '${e}', type: '${s}'}}))">\n            <i class="uiIconBannerChat uiIconLightGray"></i>\n        </a>`)}}),i=!0),n||($(".spaceMenuNav .spaceMenuNavHeader .spaceMenuApps").length&&eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.spaceGroup?($(".spaceMenuNav .spaceMenuNavHeader .spaceMenuApps").append(`<li>\n          <a onclick="document.dispatchEvent(new CustomEvent('${a.ACTION_ROOM_OPEN_CHAT}', {detail: {name: '${eXo.env.portal.spaceGroup}', type: 'space-name'}}))"           class="chat-button btn" href="javascript:void(0);">             <i class="uiIconBannerChat"></i>             <span class="chat-label-status">&nbsp;Chat</span>           </a>         </li>`),n=!0):$(".profileMenuNav .profileMenuNavHeader .profileMenuApps").length&&eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.profileOwner&&eXo.env.portal.profileOwner!==eXo.env.portal.userName&&($(".profileMenuNav .profileMenuNavHeader .profileMenuApps").append(`<li>\n          <a onclick="document.dispatchEvent(new CustomEvent('${a.ACTION_ROOM_OPEN_CHAT}', {detail: {name: '${eXo.env.portal.profileOwner}', type: 'username'}}))"           class="chat-button btn" href="javascript:void(0);">             <i class="uiIconBannerChat"></i>             <span class="chat-label-status">&nbsp;Chat</span>           </a>         </li>`),n=!0))}$(document).ready((function(){r()}));const c=[{key:"file",rank:30,type:"type-file",nameKey:"exoplatform.chat.file",labelKey:"exoplatform.chat.upload.file",iconClass:"uiIconChatUpload",hideModalActions:!0,contact:null,i18NConverter:null,appClass:"chat-file-upload DropZone",init(t){this.contact=t},html(t){return this.i18NConverter=t,`<div class="progressBar">               <div class="progress">                 <div class="bar" style="width: 0.0%;"></div>                 <div class="label">                   <div class="label-inner">${t("exoplatform.chat.file.drop")}</div>                 </div>               </div>             </div>             <div class="uiActionBorder">               <a href="#" class="btn btn-primary chat-file-upload" type="button">                 <span>${t("exoplatform.chat.file.manually")}</span>                 <input id="chat-file-file" type="file" name="userfile" />               </a>               <input id="chat-file-submit" value="${t("exoplatform.chat.file.manually")}" type="submit" style="display:none" />               <a href="#" type="button" class="btn btnClosePopup" onclick="document.dispatchEvent(new CustomEvent('${a.ACTION_APPS_CLOSE}'))">${t("exoplatform.chat.cancel")}</a>             </div>`},htmlAdded(t){this.initUpload(t)},showButtons(t,e){e?t(".apps-composer-modal .chat-file-upload .uiActionBorder").show():t(".apps-composer-modal .chat-file-upload .uiActionBorder").hide()},setErrorCode(t,e,s){const o=t(".apps-composer-modal .alert-error");e&&e.length?(o.html(this.i18NConverter(`exoplatform.chat.${e}`,s)),o.show()):(o.hide(),o.html(""))},initUpload(t){const e=Math.round(1e5*Math.random()),s=t("#appComposerForm .DropZone"),o=this;s.filedrop({fallback_id:"chat-file-file",url:`${a.UPLOAD_API}?uploadId=${e}&action=upload`,paramname:"userfile",error:function(e){switch(e){case"ErrorBrowserNotSupported":case"BrowserNotSupported":o.setErrorCode(t,"BrowserNotSupported");break;case"ErrorTooManyFiles":case"TooManyFiles":o.setErrorCode(t,"TooManyFiles");break;case"ErrorFileTooLarge":case"FileTooLarge":o.setErrorCode(t,"upload.filesize",{0:eXo.chat.userSettings.maxUploadSize});break;case"ErrorFileTypeNotAllowed":case"FileTypeNotAllowed":o.setErrorCode(t,"FileTypeNotAllowed")}o.showButtons(t,!0)},allowedfiletypes:[],maxfiles:a.MAX_UPLOAD_FILES,maxfilesize:eXo.chat.userSettings.maxUploadSize,uploadStarted:function(){o.setErrorCode(t,""),o.showButtons(t,!1)},progressUpdated:function(t,e,o){s.find(".bar").width(`${o}%`),s.find(".bar").html(`${o}%`)},uploadFinished:function(){fetch(`${a.UPLOAD_API}?uploadId=${e}&action=progress`,{method:"post",credentials:"include"}).then((t=>t.text())).then((s=>{s=s.replace(" upload :",' "upload" :'),(s=(s=JSON.parse(s))&&s.upload&&s.upload[e]?s.upload[e]:null)&&s.percent&&(100===s.percent||"100"===s.percent)?fetch(a.FILE_PERSIST_URL,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},method:"post",credentials:"include",body:t.param({uploadId:e,token:eXo.chat.userSettings.token,targetRoom:o.contact.user,targetFullname:o.contact.fullName})}).then((e=>e.ok?e.json():void o.setErrorCode(t,"ErrorPersistFile"))).then((e=>{if(!e)return void o.setErrorCode(t,"UknownError");e.type="type-file";const s={msg:e.name,room:o.contact.room,clientId:(new Date).getTime().toString(),user:eXo.chat.userSettings.username,options:e};document.dispatchEvent(new CustomEvent(a.ACTION_MESSAGE_SEND,{detail:s})),document.dispatchEvent(new CustomEvent(a.ACTION_APPS_CLOSE))})):o.setErrorCode(t,"ErrorFileUploadNotComplete")}))}})}}],l=[{key:"link",rank:20,type:"type-link",nameKey:"exoplatform.chat.link",labelKey:"exoplatform.chat.share.link",iconClass:"uiIconChatLink",saveLabelKey:"exoplatform.chat.share",html:()=>'<input id="link" name="link" class="large" type="text" placeholder="E.g: http://www.exoplatform.com" required>',checkURL:t=>(/^(https?|ftp):\/\//i.test(t)||(t=`http://${t}`),!!new RegExp("^((https?:)?\\/\\/)?(?:\\S+(?::\\S*)?@)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(t)&&t),submit(t,e,s){const o=this.checkURL(s.link);return o?(e.options.link=o,{ok:!0}):{errorCode:"link.invalid.message"}}},{key:"question",rank:40,type:"type-question",nameKey:"exoplatform.chat.question",labelKey:"exoplatform.chat.ask.question",iconClass:"uiIconChatQuestion",saveLabelKey:"exoplatform.chat.ask",html:t=>`<input name="msg" placeholder="${t("exoplatform.chat.question.what")}" class="large" type="text" required>`,submit:(t,e,s)=>(e.msg=s.msg,{ok:!0})},{key:"raise-hand",rank:50,type:"type-hand",labelKey:"exoplatform.chat.raise.hand",iconClass:"uiIconChatRaiseHand",saveLabelKey:"exoplatform.chat.raise.your",html:t=>`<input name="msg" placeholder="${t("exoplatform.chat.optional.comment")}" class="large" type="text">`,submit:(t,e,s)=>(e.msg=s.msg,{ok:!0})}],d=[{key:"notificationSettings",rank:30,labelKey:"exoplatform.stats.notifications",class:"uiIconPLFNotifications"},{key:"addToFavorite",rank:40,labelKey:"exoplatform.chat.add.favorites",class:"uiIconStar",enabled:t=>!t.contact.isFavorite},{key:"removeFromFavorite",rank:50,labelKey:"exoplatform.chat.remove.favorites",class:"uiIconStar",enabled:t=>t.contact.isFavorite},{key:"showParticipants",rank:60,labelKey:"exoplatform.chat.participants",class:"uiIconViewList",enabled:()=>!0},{key:"editRoom",rank:70,labelKey:"exoplatform.chat.team.edit",type:"t",class:"uiIconEditInfo",enabled:t=>t.isAdmin},{key:"deleteRoom",rank:80,labelKey:"exoplatform.chat.team.delete",type:"t",class:"uiIconDelete",confirm:{title:"exoplatform.chat.team.delete.title",message:"exoplatform.chat.team.delete.message",okMessage:"exoplatform.chat.team.delete.ok",koMessage:"exoplatform.chat.team.delete.ko",confirmed(t){document.dispatchEvent(new CustomEvent(a.ACTION_ROOM_DELETE,{detail:t}))}},enabled:t=>t.isAdmin},{key:"leaveRoom",rank:90,labelKey:"exoplatform.chat.team.leave",type:"t",class:"uiIconExit",enabled:t=>!t.isAdmin,confirm:{title:"exoplatform.chat.team.leave",message:"exoplatform.chat.team.leave.message",okMessage:"exoplatform.chat.team.leave.ok",koMessage:"exoplatform.chat.team.leave.ko",confirmed(t){document.dispatchEvent(new CustomEvent(a.ACTION_ROOM_LEAVE,{detail:t}))}}}],m=[{keys:[":)",":-)"],class:"emoticon-smile"},{keys:[":(",":-("],class:"emoticon-sad"},{keys:[";)",";-)"],class:"emoticon-wink"},{keys:[":|",":-|"],class:"emoticon-speechless"},{keys:[":o",":-o"],class:"emoticon-surprise"},{keys:[":p",":-p"],class:"emoticon-smile-tongue"},{keys:[":d",":-d"],class:"emoticon-flaugh"},{keys:["(cool)"],class:"emoticon-cool"},{keys:[";(",":'("],class:"emoticon-crying"},{keys:["(beer)"],class:"emoticon-beer"},{keys:["(bow)"],class:"emoticon-bow"},{keys:["(bug)"],class:"emoticon-bug"},{keys:["(cake)","(^)"],class:"emoticon-cake"},{keys:["(cash)"],class:"emoticon-cash"},{keys:["(coffee)"],class:"emoticon-coffee"},{keys:["(star)"],class:"emoticon-star"},{keys:["(heart)","&lt;3"],class:"emoticon-heart"},{keys:["(y)","(yes)"],class:"emoticon-raise-up"},{keys:["(n)","(no)"],class:"emoticon-raise-down"},{keys:["(devil)"],class:"emoticon-devil"}],h=[{key:"edit",rank:10,labelKey:"exoplatform.chat.msg.edit",enabled:t=>{const e=!t.message.isDeleted&&!t.message.notSent&&t.isCurrentUser;return t.message.options?!("type-file"===t.message.options.type)&&e:e&&!t.message.isSystem}},{key:"delete",rank:20,labelKey:"exoplatform.chat.delete",enabled:t=>!t.message.isDeleted&&!t.message.notSent&&t.isCurrentUser&&!t.message.isSystem,confirm:{title:"exoplatform.chat.popup.delete.title",message:"exoplatform.chat.popup.delete.message",okMessage:"exoplatform.chat.user.popup.confirm",koMessage:"exoplatform.chat.cancel",confirmed(t){document.dispatchEvent(new CustomEvent(a.EVENT_ROOM_MEMBER_LEFT,{detail:t}))}}},{key:"quote",rank:30,labelKey:"exoplatform.chat.quote",enabled:t=>{const e=!t.message.isDeleted&&!t.message.notSent;return t.message.options?!("type-file"===t.message.options.type)&&e:e&&!t.message.isSystem}}];function u(t,e){for(const s of e)extensionRegistry&&extensionRegistry.registerExtension("chat",t,s)}function p(t){return extensionRegistry?extensionRegistry.loadExtensions("chat",t):[]}r(),u("composer-application",l),u("message-action",h),u("room-action",d);const f=p("message-type");p("message-notif");let E=p("room-action");const g=p("room-action-component"),v=p("mini-chat-title-action-component");let _=p("composer-application"),C=p("message-action"),S=!1;function T(t){t&&t.fullName&&(S||(S=!0,t.canUploadFiles&&u("composer-application",c),_=p("composer-application"),C=p("message-action"),E=p("room-action")))}var A=function(){var t=this,e=t._self._c;return e("div",{class:{online:t.connected,offline:!t.connected,"show-conversation":t.showMobileConversations,"show-participants":t.showMobileParticipants,"show-sideMenu":t.sideMenuArea},attrs:{id:"chat-application"}},[e("div",{staticClass:"uiChatLeftContainer"},[e("div",{staticClass:"userDetails"},[e("exo-chat-contact",{attrs:{"contact-room-id":t.selectedContact.room,"user-name":t.userSettings.username,name:t.userSettings.fullName,status:t.userSettings.status,"is-current-user":!0,type:"u"},on:{"status-changed":function(e){return t.setStatus(e)}}},["mobile"!==t.mq?e("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.right",value:t.$t("exoplatform.chat.settings.button.tip"),expression:"$t('exoplatform.chat.settings.button.tip')",modifiers:{right:!0}}],staticClass:"chat-user-settings",on:{click:t.openSettingModal}},[e("i",{staticClass:"uiIconGear"})]):t._e(),t._v(" "),"mobile"!==t.mq?e("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.right",value:t.$t("exoplatform.chat.home"),expression:"$t('exoplatform.chat.home')",modifiers:{right:!0}}],staticClass:"home-button"},[e("a",{attrs:{href:"/"}},[e("i",{staticClass:"uiIconHomeInfo"})])]):t._e()]),t._v(" "),"mobile"===t.mq?e("div",{staticClass:"discussion-label"},[t._v(t._s(t.$t("exoplatform.chat.discussion")))]):t._e()],1),t._v(" "),e("exo-chat-contact-list",{attrs:{contacts:t.contactList,selected:t.selectedContact,"loading-contacts":t.loadingContacts},on:{"open-side-menu":function(e){t.sideMenuArea=!t.sideMenuArea},"load-more-contacts":t.changeFilter,"search-contact":t.searchContacts,"change-filter-type":t.changeFilter,"contact-selected":t.setSelectedContact,"refresh-contacts":function(e){return t.refreshContacts(e)}}})],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.selectedContact&&(t.selectedContact.room||t.selectedContact.user)||"mobile"===t.mq,expression:"(selectedContact && (selectedContact.room || selectedContact.user)) || mq === 'mobile'"}],staticClass:"uiGlobalRoomsContainer",attrs:{role:"main"}},[0!==Object.keys(t.selectedContact).length?e("exo-chat-room-detail",{attrs:{"is-room-notification-silence":t.isSelectedRoomSilence,contact:t.selectedContact,"room-actions":t.roomActions},on:{"back-to-contact-list":function(e){t.conversationArea=!1}}}):t._e(),t._v(" "),e("div",{staticClass:"room-content"},[e("exo-chat-message-list",{attrs:{"composers-applications":t.composerApplications,contact:t.selectedContact,"user-settings":t.userSettings,"is-opened-contact-apps":t.contactOpened}}),t._v(" "),e("exo-chat-room-participants",{attrs:{contact:t.selectedContact},on:{"participants-loaded":function(e){return t.setContactParticipants(e)},"back-to-conversation":function(e){t.participantsArea=!1}}})],1)],1),t._v(" "),"mobile"===t.mq?e("div",{staticClass:"chat-side-menu"},[e("div",{staticClass:"side-menu-header"},[e("exo-chat-contact",{attrs:{"user-name":t.userSettings.username,name:t.userSettings.fullName,status:t.userSettings.status,type:"u",list:""},on:{"status-changed":function(e){return t.setStatus(e)}}})],1),t._v(" "),e("ul",{staticClass:"side-menu-list"},[e("li",[e("a",{attrs:{href:"#"},on:{click:t.openSettingModal}},[e("i",{staticClass:"uiIconSetting"}),t._v(t._s(t.$t("exoplatform.chat.settings.button.tip")))])]),t._v(" "),e("li",[e("a",{attrs:{href:"/"}},[e("i",{staticClass:"uiIconHomeInfo"}),t._v(t._s(t.$t("exoplatform.chat.home")))])])])]):t._e(),t._v(" "),"mobile"===t.mq||t.selectedContact&&(t.selectedContact.room||t.selectedContact.user)?t._e():e("div",{staticClass:"chat-no-conversation muted"},[e("span",{staticClass:"text"},[t._v(t._s(t.$t("exoplatform.chat.no.conversation")))])]),t._v(" "),e("exo-chat-global-notification-modal",{attrs:{show:t.settingModal},on:{"close-modal":function(e){t.settingModal=!1}}}),t._v(" "),e("exo-chat-modal",{directives:[{name:"show",rawName:"v-show",value:t.loggedout,expression:"loggedout"}],staticClass:"logout-popup",attrs:{title:t.$t("exoplatform.chat.timeout.title"),"display-close":!1}},[e("div",{staticClass:"modal-body"},[t._v("\n      "+t._s(t.$t("exoplatform.chat.timeout.description"))+"\n    ")]),t._v(" "),e("div",{staticClass:"uiAction uiActionBorder"},[e("a",{staticClass:"btn btn-primary",attrs:{href:"#"},on:{click:t.reloadPage}},[t._v("\n        "+t._s(t.$t("exoplatform.chat.timeout.login"))+"\n      ")])])]),t._v(" "),t._m(0)],1)};function y(t,e){let s=localStorage.getItem(`${t}TS`);const o=localStorage.getItem(t);s||(s=-1);const i=Math.round(new Date/a.NB_MILLISECONDS_PERD_SECOND);return o&&(i<s||-1===s)?o:(localStorage.removeItem(t),localStorage.removeItem(`${t}TS`),localStorage.removeItem(t),e)}function N(t,e,s){e&&e.length?(s&&s>-1&&(s=s||300,localStorage.setItem(`${t}TS`,Math.round(new Date/a.NB_MILLISECONDS_PERD_SECOND)+s)),localStorage.setItem(t,e)):(localStorage.removeItem(t),localStorage.removeItem(`${t}TS`))}function O(t){let e=y(`${a.STORED_PARAM_PENDING_MESSAGES}-${t}`);if(e){if(e=JSON.parse(e),!Array.isArray(e))return e;e={},localStorage.removeItem(`${a.STORED_PARAM_PENDING_MESSAGES}-${t}`)}return{}}function M(t){const e=t.sender?t.sender:t.data&&t.data.sender?t.data.sender:t.user?t.user:t.data?t.data.user:null,s=t.clientId?t.clientId:t.data?t.data.clientId:null,o=t.room?t.room:t.data?t.data.room:null;return!(e!==eXo.chat.userSettings.username||!o||!s)&&(t.notSent=!1,x(e,s))}function x(t,e){const s=O(t);return!(!s||!s[e]||(document.dispatchEvent(new CustomEvent(a.EVENT_MESSAGE_DELETED,{detail:{data:s[e]}})),delete s[e],N(`${a.STORED_PARAM_PENDING_MESSAGES}-${t}`,JSON.stringify(s)),0))}function R(t,e){if(!y(a.STORED_PARAM_MESSAGES_SENDING)){N(a.STORED_PARAM_MESSAGES_SENDING,"true",5e3/a.NB_MILLISECONDS_PERD_SECOND);try{const s=O(t);s&&s[e.clientId]&&document.dispatchEvent(new CustomEvent(a.ACTION_MESSAGE_SEND,{detail:s[e.clientId]})),N(a.STORED_PARAM_MESSAGES_SENDING)}catch(t){N(a.STORED_PARAM_MESSAGES_SENDING)}}}function I(){document.addEventListener(a.EVENT_MESSAGE_SENT,(t=>{M(t.detail)})),document.addEventListener(a.RESEND_FAILED_MESSAGE,(t=>{R(t.detail.user,t.detail.message)})),document.addEventListener(a.DELETE_FAILED_MESSAGE,(t=>{x(t.detail.user,t.detail.clientId)}))}function b(){document.removeEventListener(a.EVENT_MESSAGE_SENT,(t=>{M(t.detail)})),document.removeEventListener(a.RESEND_FAILED_MESSAGE,(t=>{R(t.detail.user,t.detail.message)})),document.removeEventListener(a.DELETE_FAILED_MESSAGE,(t=>{x(t.detail.user,t.detail.clientId)}))}A._withStripped=!0;const w={connected:!1};function D(t){w.token=t.token,w.username=t.username,w.sessionId=t.sessionId,w.spaceId=t.spaceId,w.fullname=t.fullName,w.cometdToken=t.cometdToken,w.standalone="true"===t.standalone||!0===t.standalone;const e=window.location,s=e.port?`:${e.port}`:"";if(w.wsEndpoint=t.wsEndpoint.indexOf("://")>-1?t.wsEndpoint:`${e.protocol}//${e.hostname}${s}${t.wsEndpoint}`,!w.cCometD&&(w.cCometD=w.standalone?cCometD.getInstance("chat"):cCometD,!w.cCometD.isConfigured)){const t={url:w.wsEndpoint,exoId:w.username,exoToken:w.cometdToken,maxSendBayeuxMessageSize:10485760};w.cCometD.configure(t)}w.chatSubscription||(L(),k(),P(),U(t.status))}function k(){w.connected=!1,w.cCometD.addListener("/meta/connect",(function(t){if(w.cCometD.isDisconnected())return eXo.chat.isOnline=!1,void(w.connected=!1);const e=w.connected;eXo.chat.isOnline=w.connected=!0===t.successful,w.connected?e?document.dispatchEvent(new CustomEvent(a.EVENT_RECONNECTED)):document.dispatchEvent(new CustomEvent(a.EVENT_CONNECTED)):e&&document.dispatchEvent(new CustomEvent(a.EVENT_DISCONNECTED))})),w.cCometD.addListener("/meta/disconnect",(function(t){t.successful&&document.dispatchEvent(new CustomEvent(a.EVENT_DISCONNECTED))}))}function L(){w.cCometD.addListener("/meta/handshake",(function(t){t.successful?P():!1===w.connected&&$.ajax({url:"/portal/rest/chat/api/1.0/user/cometdToken",success:function(t){w.cometdToken=t,w.cCometD.isConfigured=!1;const e={url:w.wsEndpoint,exoId:w.username,exoToken:w.cometdToken,maxSendBayeuxMessageSize:10485760};w.cCometD.configure(e),P()},error:t=>console.error("Error while retrieving cometd token from server",t)})}))}function P(){w.chatSubscription?w.cCometD.resubscribe(w.chatSubscription):w.chatSubscription=w.cCometD.subscribe("/service/chat",null,(function(t){let e=t.data;"object"!=typeof e&&(e=JSON.parse(e)),document.dispatchEvent(new CustomEvent(`exo-chat-${e.event}`,{detail:e}))}),null,(function(t){t.successful&&(w.chatSubscription=t,document.dispatchEvent(new CustomEvent(a.EVENT_CONNECTED)))}))}function U(t,e,s){t&&F()?w.cCometD.publish("/service/chat",JSON.stringify({event:"user-status-changed",sender:w.username,room:w.username,token:w.token,data:{status:t}}),(function(o){o.successful?"function"==typeof e&&("complete"===document.readyState?e(t):s(t)):s&&"function"==typeof s&&s()})):s&&"function"==typeof s&&s()}function F(){return w.cCometD&&!w.cCometD.isDisconnected()&&w.chatSubscription}function G(t,e){if(!w.cCometD)return;const s=JSON.stringify({event:"room-member-leave-requested",clientId:(new Date).getTime().toString(),sender:w.username,token:w.token,room:t,options:{fullName:w.fullname}});w.cCometD.publish("/service/chat",s,(function(t){t&&t.successful&&e?e():t.failure&&console.error(`Error when sending message on ${t.failure.connectionType} with exception : ${t.failure.exception}`)}))}function V(t,e){if(!w.cCometD)return;const s=JSON.stringify({event:"room-deleted",sender:w.username,token:w.token,room:t});w.cCometD.publish("/service/chat",s,(function(t){t&&t.successful&&e?e():t.failure&&console.error(`Error when sending message on ${t.failure.connectionType} with exception : ${t.failure.exception}`)}))}function X(t,e){const s={clientId:t.clientId,timestamp:t.timestamp?t.timestamp:Date.now(),msg:t.message?t.message:t.msg,msgId:t.msgId,room:t.room,options:t.options?t.options:{},isSystem:t.isSystemMessage||t.isSystem,user:w.username,fullname:w.fullname};if(!F()||!navigator.onLine)return document.dispatchEvent(new CustomEvent(a.EVENT_MESSAGE_NOT_SENT,{detail:s})),void document.dispatchEvent(new CustomEvent(a.EVENT_DISCONNECTED));const o={event:t.msgId?"message-updated":"message-sent",room:t.room,sender:w.username,token:w.token,data:s};try{w.cCometD.publish("/service/chat",JSON.stringify(o),(function(t){t&&t.successful?(document.dispatchEvent(new CustomEvent(a.EVENT_MESSAGE_SENT,{detail:o})),e&&e(s)):(console.error(`Error when sending message on ${t.failure.connectionType} with exception : ${t.failure.exception}`),document.dispatchEvent(new CustomEvent(a.EVENT_MESSAGE_NOT_SENT,{detail:s})))}))}catch(t){document.dispatchEvent(new CustomEvent(a.EVENT_MESSAGE_NOT_SENT,{detail:s}))}}function B(t,e){if(!w.cCometD)return;const s={event:"message-deleted",sender:w.username,token:w.token,room:t.room,data:{msgId:t.msgId}};w.cCometD.publish("/service/chat",JSON.stringify(s),(function(t){t.successful?"function"==typeof e&&e():t.failure&&console.error(`Error when sending message on ${t.failure.connectionType} with exception : ${t.failure.exception}`)}))}function H(t,e){const s=JSON.stringify({event:"message-read",sender:w.username,token:w.token,room:t});w.cCometD&&w.cCometD.publish("/service/chat",s,(function(t){t.successful?"function"==typeof e&&e():t.failure&&console.error(`Error when sending message on ${t.failure.connectionType} with exception : ${t.failure.exception}`)}))}function q(){document.addEventListener(a.EVENT_LOGGED_OUT,(t=>{const e=t.detail;e&&e.data&&e.data.sessionId===w.sessionId&&(w.cCometD.disconnect(),w.cCometD.explicitlyDisconnected=!0)})),document.addEventListener(a.ACTION_MESSAGE_SEND,(t=>{X(t.detail)})),document.addEventListener(a.ACTION_MESSAGE_DELETE,(t=>{B(t.detail)})),document.addEventListener(a.ACTION_ROOM_SET_READ,(t=>{t.detail&&t.detail.trim()&&H(t.detail)}))}function j(){document.removeEventListener(a.EVENT_LOGGED_OUT,(t=>{const e=t.detail;e&&e.data&&e.data.sessionId===w.sessionId&&(w.cCometD.disconnect(),w.cCometD.explicitlyDisconnected=!0)})),document.removeEventListener(a.ACTION_MESSAGE_SEND,(t=>{X(t.detail)})),document.removeEventListener(a.ACTION_MESSAGE_DELETE,(t=>{B(t.detail)})),document.removeEventListener(a.ACTION_ROOM_SET_READ,(t=>{t.detail&&t.detail.trim()&&H(t.detail)}))}function K(t){return!!(eXo.chat.desktopNotificationSettings&&eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger&&eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger[t])&&"silence"===eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger[t].notifCond}function z(t){const e=t.detail,s=e.data;!function(t,e){!e.room&&t.room&&(e.room=t.room),e.user||!t.user&&!t.sender||(e.user=t.user?t.user:t.sender)}(e,s),s&&s.user!==eXo.chat.userSettings.username&&s.type!==a.EDITED_MESSAGE&&s.type!==a.DELETED_MESSAGE&&setTimeout((function(){if(localStorage.getItem(`${a.STORED_PARAM_LAST_NOTIFY}-${s.room}`)===s.msgId)return;localStorage.setItem(`${a.STORED_PARAM_LAST_NOTIFY}-${s.room}`,s.msgId);const t={roomType:s.roomType,options:s.options,roomDisplayName:s.roomDisplayName,content:s.msg,room:s.room,from:s.user,msgId:s.msgId};var e,o;("donotdisturb"!==eXo.chat.userSettings.status||-1!==eXo.chat.desktopNotificationSettings.preferredNotificationTrigger.indexOf("notify-even-not-disturb")||"donotdisturb"!==eXo.chat.userSettings.status&&"offline"!==eXo.chat.userSettings.status)&&function(t){const e=t.content,s=t.room;return!eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger[s]||!eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger[s].notifCond||eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger[s].notifCond.startsWith("normal")||eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger[s].notifCond.startsWith("keywords")&&function(t,e){if(t=t.toLowerCase(),!e||!e.trim())return!1;const s=e.split(/[\s,]+/);for(let e=0;e<s.length;e++)if(t.includes(s[e].trim().toLowerCase()))return!0;return!1}(e,eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger[s].keywords)}(t)&&(e=s.room,o=s.silentReceivers,-1!==eXo.chat.desktopNotificationSettings.preferredNotification.indexOf("bip")&&!K(e)&&!function(t){return t.includes(eXo.env.portal.userName)}(o)&&$("#chat-audio-notif")[0].play(),-1!==eXo.chat.desktopNotificationSettings.preferredNotification.indexOf("desktop")&&W(eXo.chat.userSettings.chatPage,t))}))}function W(t,e){if(!window.Notification)return;let s=function(t){let e=t.content;if(t.options&&t.options.type)switch(t.options.type){case"type-event":e=t.options.summary;break;case"type-hand":e=`raises hand: ${t.content}`;break;case"type-link":e=t.options.link;break;case"type-mention":e=`You have been mentioned in ${t.roomDisplayName}`;break;default:_.forEach((s=>{s.type===t.options.type&&s.notificationContent&&(e=s.notificationContent(t))}))}return e=$("<div />").html(e).text(),e}(e);if(s=$("<div />").html(s).text(),"granted"!==Notification.permission)Notification.requestPermission((function(s){Notification.permission!==s&&(Notification.permission=s),"granted"===Notification.permission&&W(t,e)}));else{const t="undefined"!=typeof InstallTrigger,o=function(t){t.onclick=function(){document.dispatchEvent(new CustomEvent(a.ACTION_ROOM_SELECT,{detail:e.room}));const s=`${a.PORTAL}/${a.PORTAL_NAME}/chat`;window.open(s,"_chat").focus(),t.close()}};let i=null;if(navigator.platform.indexOf("Linux")>=0&&t)i=new Notification(e.roomDisplayName,{body:s,tag:e.msgId}),o(i);else{let t=null;t="u"===e.roomType?It(e.from).then((t=>t.avatar)):"s"===e.roomType?kt(e.roomDisplayName).then((t=>t.avatarUrl)):a.DEFAULT_ROOM_AVATAR,i=new Notification(e.roomDisplayName,{icon:t,body:s,tag:e.msgId}),o(i)}document.getElementById(e.msgId).scrollIntoView()}}function J(t){return`${a.SOCIAL_USER_API}${t}/avatar`}function Q(t){return`${a.SOCIAL_SPACE_API}${t}/avatar`}function Y(t,e){return fetch(`${a.CHAT_SERVER_API}getStatus?user=${t.username}&targetUser=${e}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.text()))}function Z(t,e,o){s&&F()?U(e,(()=>{fetch(`${a.USER_STATE_API}${t.username}?status=${e}`,{credentials:"include",method:"PUT"}).then((()=>{"function"==typeof o&&o(e)}))}),(()=>setTimeout((()=>Z(t,e,o)),a.REATTEMPT_PERIOD))):setTimeout((()=>Z(t,e,o)),a.REATTEMPT_PERIOD)}function tt(t,e){return e||(e=""),fetch(`${a.CHAT_SERVER_API}notification?user=${t.username}&withDetails=${e}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.json()))}function et(t,e,s,o,i){eXo||(eXo={}),eXo.chat||(eXo.chat={}),eXo.chat.userSettings||(eXo.chat.userSettings={}),document.addEventListener(a.EVENT_USER_SETTINGS_LOADED,(t=>{const s=t.detail;if(e)tt(s).then((t=>o(t)));else{let t="";i||(t=y(a.STORED_PARAM_TYPE_FILTER,a.TYPE_FILTER_DEFAULT)),nt().then((e=>ft(s,e,"",t))).then((t=>o(t)))}document.addEventListener(a.EVENT_ROOM_SELECTION_CHANGED,(t=>{const e=t.detail;e&&e.room&&N(a.STORED_PARAM_LAST_SELECTED_ROOM,e.room)})),Nt(t.detail).then((t=>{Ot(t),document.addEventListener(a.EVENT_MESSAGE_RECEIVED,z),document.addEventListener(a.EVENT_MESSAGE_UPDATED,z)}))})),it().then((t=>{eXo.chat.userSettings=t,st(0,t,s)})),document.addEventListener(a.EVENT_USER_STATUS_CHANGED,at)}function st(t,e,s){eXo||(eXo={}),eXo.chat||(eXo.chat={}),eXo.chat.userSettings||(eXo.chat.userSettings={});try{eXo.chat.userSettings=e,D(e),eXo.chat.userSettings.chatPage=Pt()+eXo.chat.userSettings.chatPage,s(e),document.dispatchEvent(new CustomEvent(a.EVENT_USER_SETTINGS_LOADED,{detail:e}))}catch(t){console.error("Error initializing chat settings",t),setTimeout((()=>st(status,e,s)),1e3)}}function ot(t){const e=document.title.replace(/\(\+?\d{1,2}\)/,"");document.title=t&&t>0&&t<=99?e.concat(`(${t})`):t>99?e.concat("(+99)"):e}function at(t){const e=t.detail,s=e.data?e.data.status:e.status,o=e.sender;if(o&&s){const t=$(`.uiProfileMenu .profileMenuNavHeader [data-userid='${o}'] i`);t.length&&function(t,e,s){t.removeClass("uiIconUserAvailable uiIconUserOnline uiIconUserInvisible uiIconUserOffline uiIconUserAway uiIconUserDonotdisturb"),"available"===e?t.addClass("uiIconUserAvailable"):"away"===e?t.addClass("uiIconUserAway"):"donotdisturb"===e?t.addClass("uiIconUserDonotdisturb"):"invisible"===e&&t.addClass("uiIconUserInvisible"),t.attr("data-original-title",s)}(t,s,eXo.chat.userSettings.statusLabels?eXo.chat.userSettings.statusLabels[s]:"")}}function it(){return fetch(`${a.PORTAL}/${a.PORTAL_REST}${a.CHAT_API}settings`,{credentials:"include"}).then((t=>t.json()))}function nt(){return fetch(`${a.PORTAL}/${a.PORTAL_REST}${a.CHAT_API}onlineUsers`,{credentials:"include"}).then((t=>t.text()))}function rt(t,e,s){const o={roomId:t,roomName:e,mentionedUsers:s,sender:eXo.chat.userSettings.username,senderFullName:eXo.chat.userSettings.fullName};return fetch(`${a.PORTAL}/${a.PORTAL_REST}${a.CHAT_API}mentionNotifications`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(o)}).then((t=>t.json()))}function ct(t,e,s,o){const i={roomId:t,roomName:e,message:s,sender:eXo.chat.userSettings.username,senderFullName:eXo.chat.userSettings.fullName,receivers:o};return fetch(`${a.PORTAL}/${a.PORTAL_REST}${a.CHAT_API}messageReceivedNotification`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(i)}).then((t=>t))}function lt(t){return fetch(`${a.PORTAL}/${a.PORTAL_REST}${a.CHAT_API}getUserState?user=${t}`,{credentials:"include"}).then((t=>t.json()))}function dt(t,e,s,o,i){return fetch(`${a.CHAT_SERVER_API}updateUser?user=${t.username}&targetUser=${e}&isDeleted=${s}&isEnabled=${o}&isExternal=${i}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.text()))}function mt(t,e,s){return fetch(`${a.CHAT_SERVER_API}setExternal?user=${t.username}&targetUser=${e}&isExternal=${s}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.text()))}function ht(t,e,s){return t&&t.trim().length||!e||!e.trim().length?fetch(`${a.CHAT_SERVER_API}toggleFavorite?user=${eXo.chat.userSettings.username}&targetUser=${t}&favorite=${s}`,{headers:{Authorization:`Bearer ${eXo.chat.userSettings.token}`}}).then((t=>t.text())):_t(eXo.chat.userSettings,e,"username").then((e=>(t=e,fetch(`${a.CHAT_SERVER_API}toggleFavorite?user=${eXo.chat.userSettings.username}&targetUser=${t}&favorite=${s}`,{headers:{Authorization:`Bearer ${eXo.chat.userSettings.token}`}}).then((t=>t.text())))))}function ut(t,e){return fetch(`${a.CHAT_SERVER_API}filterOutSilentUsers?roomId=${e}&user=${t.username}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.json()))}function pt(t,e,s,o){return o||(o=a.ROOMS_PER_PAGE),s||(s=""),fetch(`${a.CHAT_SERVER_API}whoIsOnline?user=${t.username}&onlineUsers=${e}&filter=${s}&limit=${o}&timestamp=${(new Date).getTime()}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.json()))}function ft(t,e,s,o,i,n){return n||(n=a.ROOMS_PER_PAGE),i||(i=a.DEFAULT_OFFSET),s||(s=""),o&&"All"!==o||(o=""),fetch(`${a.CHAT_SERVER_API}userRooms?user=${t.username}&onlineUsers=${e}&filter=${s}&offset=${i}&limit=${n}&roomType=${o}&timestamp=${(new Date).getTime()}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.json()))}function Et(t,e,s,o,i){return!o&&isNaN(o)&&(o=a.DEFAULT_USER_LIMIT),i=i&&!0===i,s||(s=""),fetch(`${a.CHAT_SERVER_API}users?user=${t.username}&room=${e.room}&onlineUsers=${s}&limit=${o}&onlineOnly=${i}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.json()))}function gt(t,e){return fetch(`${a.CHAT_SERVER_API}usersCount?user=${t.username}&room=${e.room}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.json()))}function vt(t,e,s){return fetch(`${a.CHAT_SERVER_API}users?user=${t.username}&room=${e.room}&filter=${s}&limit=10`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.json()))}function _t(t,e,s){return fetch(`${a.CHAT_SERVER_API}getRoom?targetUser=${e}&user=${t.username}&type=${s}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.text()))}function Ct(t,e){return fetch(`${a.CHAT_SERVER_API}getRoom?targetUser=${e}&user=${t.username}&withDetail=true&type=room-id`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.json()))}function St(t,e,s,o){return o||(o=""),s||(s=""),fetch(`${a.CHAT_SERVER_API}read?user=${t.username}&room=${e.room}&toTimestamp=${s}&limit=${o}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.json()))}function Tt(t,e,s,o,i){return fetch(`${a.CHAT_SERVER_API}setRoomNotificationTrigger?user=${t.username}&room=${e}&notifConditionType=${s}&notifCondition=${o}&time=${i}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.json()))}function At(t,e,s){let o="";e.forEach((t=>{o+=`&notifConditions=${t}`}));let i="";return s.forEach((t=>{i+=`&notifManners=${t}`})),fetch(`${a.CHAT_SERVER_API}setNotificationSettings?user=${t.username}${o}${i}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.json()))}function yt(t,e){return fetch(`${a.CHAT_SERVER_API}setPreferredNotification?user=${t.username}&notifManner=${e}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.json()))}function Nt(t){return fetch(`${a.CHAT_SERVER_API}getUserDesktopNotificationSettings?user=${t.username}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.json()))}function Ot(t){t&&t.userDesktopNotificationSettings&&(eXo.chat.desktopNotificationSettings=t.userDesktopNotificationSettings,eXo.chat.desktopNotificationSettings.preferredNotification?eXo.chat.desktopNotificationSettings.preferredNotification=JSON.parse(eXo.chat.desktopNotificationSettings.preferredNotification):eXo.chat.desktopNotificationSettings.preferredNotification=[],eXo.chat.desktopNotificationSettings.preferredNotificationTrigger?eXo.chat.desktopNotificationSettings.preferredNotificationTrigger=JSON.parse(eXo.chat.desktopNotificationSettings.preferredNotificationTrigger):eXo.chat.desktopNotificationSettings.preferredNotificationTrigger=[],eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger?eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger=JSON.parse(eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger):eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger=[])}function Mt(t,e,s){return s||(s=a.DEFAULT_USER_LIMIT),fetch(`${a.CHAT_SERVER_API}users?user=${t.username}&filter=${e}&limit=${s}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.json()))}function xt(t,e,s,o){const i={teamName:e,users:s,user:t.username,room:o};return fetch(`${a.CHAT_SERVER_API}saveTeamRoom`,{headers:{Authorization:`Bearer ${t.token}`,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},method:"post",body:decodeURI($.param(i))})}function Rt(t,e,s,o){const i={user:t.username,room:e,start:s,startTime:o};return fetch(`${a.CHAT_SERVER_API}updateRoomMeetingStatus`,{headers:{Authorization:`Bearer ${t.token}`,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},method:"post",body:decodeURI($.param(i))})}function It(t){return fetch(`${a.SOCIAL_USER_API}${t}`,{credentials:"include",method:"GET"}).then((t=>{if(t&&t.ok)return t.json()}))}function bt(t){return fetch(`${a.PORTAL}/${a.PORTAL_REST}${a.CHAT_API}getRoomParticipantsToSuggest`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when loading user list")}))}function wt(t){return fetch(`${a.PORTAL}/${a.PORTAL_REST}${a.CHAT_API}getModalParticipantsToSuggest`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when loading user list")}))}function $t(t){return`${a.PORTAL}/${a.PORTAL_NAME}/${a.PROFILE_PAGE_NAME}/${t}`}function Dt(t,e){return`${a.PORTAL}${a.PROFILE_SPACE_LINK}${t.replaceAll("/",":")}/${e}`}function kt(t){return fetch(`${a.SOCIAL_SPACE_API}${a.BY_PRETTY_NAME}${t}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"GET"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when loading space")}))}function Lt(t,e,s,o){const i={user:t.username,room:e,fromTimestamp:s,toTimestamp:o};return fetch(`${a.CHAT_SERVER_API}sendMeetingNotes`,{headers:{Authorization:`Bearer ${t.token}`,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},method:"post",body:decodeURI($.param(i))}).then((t=>t.text()))}function Pt(){const t=window.location.port&&80!==window.location.port?`:${window.location.port}`:"";return`${window.location.protocol}//${window.location.hostname}${t}`}function Ut(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function Ft(t){return t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')}function Gt(t,e,s){const o={user:t.username,spaceId:e,enabled:s};return fetch("/chatServer/updateRoomEnabled",{headers:{Authorization:`Bearer ${t.token}`,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},method:"post",body:decodeURI($.param(o))})}function Vt(t,e){return fetch(`/chatServer/isRoomEnabled?user=${t.username}&spaceId=${e}`,{headers:{Authorization:`Bearer ${t.token}`}}).then((t=>t.text()))}function Xt(t,e,s,o,a,i,n,r){var c,l="function"==typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=s,l._compiled=!0),o&&(l.functional=!0),i&&(l._scopeId="data-v-"+i),n?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),a&&a.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},l._ssrRegister=c):a&&(c=r?function(){a.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:a),c)if(l.functional){l._injectStyles=c;var d=l.render;l.render=function(t,e){return c.call(e),d(t,e)}}else{var m=l.beforeCreate;l.beforeCreate=m?[].concat(m,c):[c]}return{exports:t,options:l}}const Bt=Xt({data:()=>({contactList:[],userSettings:{username:"undefined"!=typeof eXo?eXo.env.portal.userName:"root"},connected:!1,loggedout:!1,contactOpened:!0,selectedContact:{},loadingContacts:!0,settingModal:!1,conversationArea:!1,participantsArea:!1,sideMenuArea:!1,composerApplications:[],roomActions:[]}),computed:{isSelectedRoomSilence(){return this.selectedContact&&K(this.selectedContact.room)||this.selectedContact.isRoomSilent},showMobileConversations(){return"mobile"===this.mq&&!0===this.conversationArea},showMobileParticipants(){return"mobile"===this.mq&&!0===this.participantsArea}},watch:{loadingContacts(){this.loadingContacts||this.$root.$applicationLoaded()}},created(){this.showHidePlatformAdminToolbar(),et(this.userSettings.username,!1,(t=>{this.initSettings(t),T(t),this.composerApplications=_,this.roomActions=E}),(t=>this.initChatRooms(t))),document.addEventListener(a.EVENT_ROOM_UPDATED,this.roomUpdated),document.addEventListener(a.EVENT_LOGGED_OUT,this.userLoggedout),document.addEventListener(a.EVENT_DISCONNECTED,this.changeUserStatusToOffline),document.addEventListener(a.EVENT_CONNECTED,this.connectionEstablished),document.addEventListener(a.EVENT_RECONNECTED,this.connectionEstablished),document.addEventListener(a.EVENT_USER_STATUS_CHANGED,this.userStatusChanged),document.addEventListener(a.EVENT_GLOBAL_UNREAD_COUNT_UPDATED,this.totalUnreadMessagesUpdated),document.addEventListener(a.ACTION_ROOM_SHOW_PARTICIPANTS,(()=>this.participantsArea=!0)),document.addEventListener(a.ACTION_ROOM_OPEN_CHAT,this.openRoom),I(),q(),this.$root.$on("refresh-contacts",(t=>{this.refreshContacts(t)}))},destroyed(){document.removeEventListener(a.EVENT_DISCONNECTED,this.changeUserStatusToOffline),document.removeEventListener(a.EVENT_CONNECTED,this.connectionEstablished),document.removeEventListener(a.EVENT_RECONNECTED,this.connectionEstablished),document.removeEventListener(a.EVENT_ROOM_UPDATED,this.roomUpdated),document.removeEventListener(a.EVENT_LOGGED_OUT,this.userLoggedout),document.removeEventListener(a.EVENT_USER_STATUS_CHANGED,this.userStatusChanged),document.removeEventListener(a.EVENT_GLOBAL_UNREAD_COUNT_UPDATED,this.totalUnreadMessagesUpdated),document.removeEventListener(a.ACTION_ROOM_OPEN_CHAT,this.openRoom),b(),j()},methods:{initSettings(t){this.userSettings=t,this.setStatus(this.userSettings.status);const e=this;this.userSettings.offlineDelay&&setInterval((function(){e.refreshContacts(!0)}),this.userSettings.offlineDelay)},initChatRooms(t){this.loadingContacts=!1,this.addRooms(t.rooms);const e=y(a.STORED_PARAM_LAST_SELECTED_ROOM);e&&this.setSelectedContact(e),ot(Math.abs(t.unreadOffline)+Math.abs(t.unreadOnline)+Math.abs(t.unreadSpaces)+Math.abs(t.unreadTeams)-Number(t.unreadSilentRooms))},setSelectedContact(t){"mobile"===this.mq&&(this.conversationArea=!0),t||(t={}),"string"==typeof t&&(t=this.contactList.find((e=>e.room===t||e.user===t))),t&&t.fullName&&(t.room||t.user)&&(eXo.chat.selectedContact=t,this.contactList.findIndex((e=>e.room===t.room||e.user===t.user))<0&&this.contactList.unshift(t),this.contactOpened=!1,gt(eXo.chat.userSettings,t).then((t=>{this.selectedContact.participantsCount=t.usersCount,this.selectedContact.activeParticipantsCount=t.activeUsersCount})),Et(eXo.chat.userSettings,t).then((e=>{this.selectedContact=t,this.selectedContact.participants=e.users,document.dispatchEvent(new CustomEvent(a.EVENT_ROOM_SELECTION_CHANGED,{detail:this.selectedContact}))})))},setStatus(t){Z(this.userSettings,t,(t=>{this.userSettings.status=t,this.userSettings.originalStatus=t}))},userLoggedout(){F()||(this.changeUserStatusToOffline(),this.loggedout=!0)},roomUpdated(t){const e=t.detail&&t.detail.data?t.detail.data:null;if(e&&(e.room||e.user)){const t=this.contactList.findIndex((t=>t.room===e.room||t.user===e.user));t<0?this.contactList.unshift(e):this.contactList.splice(t,1,e)}},totalUnreadMessagesUpdated(t){ot(t.detail?t.detail.data.totalUnreadMsg:t.totalUnreadMsg)},userStatusChanged(t){const e=t.detail;this.userSettings.username===e.sender&&(this.userSettings.status=e.status?e.status:e.data?e.data.status:null,this.userSettings.originalStatus=this.userSettings.status)},connectionEstablished(){eXo.chat.isOnline=!0,this.connected=!0,this.userSettings.originalStatus&&this.userSettings.originalStatus!==this.userSettings.status?this.setStatus(this.userSettings.originalStatus):this.userSettings&&this.userSettings.originalStatus&&(this.userSettings.status=this.userSettings.originalStatus)},addRooms(t,e){e||(this.contactList=[]);const s=this.contactList.slice(0);(t=t.filter((t=>t.fullName&&t.fullName.trim().length>0&&(t.room&&t.room.trim().length>0||t.user&&t.user.trim().length>0)&&!s.find((e=>e.room===t.room||e.user===t.user)))))&&t.length>0&&t.forEach((t=>{this.contactList.push(t)}))},loadMoreContacts(t){this.loadingContacts=!0,nt().then((e=>{ft(this.userSettings,e,"",t*a.DEFAULT_USER_LIMIT).then((t=>{this.addRooms(t.rooms,!0),this.loadingContacts=!1}))}))},searchContacts(t){this.loadingContacts=!0,nt().then((e=>{ft(this.userSettings,e,t).then((t=>{this.addRooms(t.rooms),this.loadingContacts=!1}))}))},changeFilter(t,e,s){let o=0;"All"===e&&(e=""),s&&(o=s*a.ROOMS_PER_PAGE),this.loadingContacts=!0,nt().then((a=>{ft(this.userSettings,a,t,e,o).then((t=>{this.addRooms(t.rooms,s),this.loadingContacts=!1}))}))},refreshContacts(t){const e=y(a.STORED_PARAM_TYPE_FILTER,a.TYPE_FILTER_DEFAULT),s=y(a.STORED_PARAM_TERM_FILTER,a.TERM_FILTER_DEFAULT);nt().then((o=>{ft(this.userSettings,o,s,e).then((e=>{if(this.addRooms(e.rooms),!t&&this.selectedContact){const t=this.contactList.find((t=>t.room===this.selectedContact.room||t.user===this.selectedContact.user));t?this.setSelectedContact(t):this.selectedContact={}}}))}))},changeUserStatusToOffline(){this.userSettings&&this.userSettings.status&&!this.userSettings.originalStatus&&(this.userSettings.originalStatus=this.userSettings.status),eXo.chat.isOnline=!1,this.connected=!1},openSettingModal(){this.settingModal=!0},setContactParticipants(t){this.selectedContact.participants=t,document.dispatchEvent(new CustomEvent(a.EVENT_ROOM_PARTICIPANTS_LOADED,{detail:this.selectedContact}))},reloadPage(){window.location.reload()},openRoom(t){const e=t.detail?t.detail.name:null,s=t.detail?t.detail.type:null;e&&e.trim().length&&_t(this.userSettings,e,s).then((t=>{this.contactList.some((e=>e.room===t||e.user===t))?this.setSelectedContact(t):nt().then((e=>{pt(this.userSettings,e).then((t=>{this.addRooms(t.rooms)})).then((()=>{this.setSelectedContact(t)}))}))}));const o=document.getElementById("tiptip_holder");o&&(o.style.display="none")},showHidePlatformAdminToolbar:()=>location.pathname==="/portal/".concat(eXo.env.portal.portalName).concat("/chat")?$("#PlatformAdminToolbarContainer").css("display","none")&&$("#UITopBarContainerParent").css("display","none"):$("#PlatformAdminToolbarContainer").css("display","block")&&$("#UITopBarContainerParent").css("display","block")}},A,[function(){var t=this,e=t._self._c;return e("div",{staticClass:"hide"},[e("audio",{attrs:{id:"chat-audio-notif",controls:""}},[e("source",{attrs:{src:"/chat/audio/notif.wav"}}),t._v(" "),e("source",{attrs:{src:"/chat/audio/notif.mp3"}}),t._v(" "),e("source",{attrs:{src:"/chat/audio/notif.ogg"}})])])}],!1,null,null,null).exports;var Ht=function(){var t=this,e=t._self._c;return e("div",{staticClass:"chat-contact"},[e("div",{staticClass:"chat-contact-avatar",class:t.statusStyle,style:`backgroundImage: url(${t.avatarUrl})`},[t.list||"t"===t.type||!t.isEnabled&&null!==t.isEnabled?t._e():e("a",{staticClass:"chat-contact-link",attrs:{href:t.contactUrl}}),t._v(" "),t.list&&"u"==t.type&&(t.isEnabled||null===t.isEnabled)?e("i",{staticClass:"uiIconStatus"}):t._e()]),t._v(" "),e("div",{staticClass:"contactDetail"},[e("div",{staticClass:"contactLabel",class:t.isActive},[e("span",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:t.escapedName,expression:"escapedName"}]}),t._v(" "),t.isExternal?e("span",{staticClass:"externalTagClass"},[t._v(t._s(t.externalTag))]):t._e(),t._v(" "),t._t("default")],2),t._v(" "),"u"!=t.type||t.list||t.isCurrentUser?t._e():e("div",{staticClass:"user-status",class:t.statusStyle},[t.isEnabled||null===t.isEnabled?e("i",{staticClass:"uiIconStatus"}):t._e(),t._v(" "),e("span",{staticClass:"user-status"},[t._v(t._s(t.getStatus))])]),t._v(" "),"u"==t.type&&!t.list&&t.isCurrentUser?e("exo-dropdown-select",{staticClass:"status-dropdown",attrs:{"toggler-class":"user-status"}},[e("div",{class:t.statusStyle,attrs:{slot:"toggle"},slot:"toggle"},[e("div",{staticClass:"statusMargin"},[e("i",{staticClass:"uiIconStatus"})]),t._v(" "),t.ap?t._e():e("div",{staticClass:"chat-title"},[t._v("Chat")]),t._v(" "),t.ap?e("span",{staticClass:"user-status"},[t._v(t._s(t.getStatus))]):t._e(),t._v(" "),t.chatDrawerContact?e("div",{staticClass:"chat-status-toggle"},[t.list||"t"===t.type||!t.isEnabled&&null!==t.isEnabled?t._e():e("a",{staticClass:"chat-contact-link"})]):t._e()]),t._v(" "),t._l(t.activeStatusMap,(function(s,o){return e("li",{key:o,class:`user-${o}`,attrs:{slot:"menu"},on:{click:function(e){return t.setStatus(o)}},slot:"menu"},[e("a",{staticClass:"status-link",attrs:{href:"#"}},[e("span",[e("i",{staticClass:"uiIconStatus"})]),t._v(t._s(s))])])}))],2):t._e(),t._v(" "),"u"!=t.type&&!t.list&&t.nbMembers>0?e("div",{staticClass:"room-number-members"},[t._v("\n      "+t._s(t.nbMembers)+" "+t._s(t.$t("exoplatform.chat.members"))+"\n    ")]):t._e(),t._v(" "),"mobile"===t.mq&&t.list&&t.lastMessage||t.chatDrawerContact?e("div",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:t.lastMessage,expression:"lastMessage"}],class:t.chatDrawerContact?"lastMessageDrawer last-message":"last-message"}):t._e()],1),t._v(" "),!t.isRoomSilent&&t.unreadTotal>0&&t.unreadTotal<=t.maxShowUnread?e("div",{class:["unreadMessages"]},[t._v("\n    "+t._s(t.unreadTotal)+"\n  ")]):t._e(),t._v(" "),!t.isRoomSilent&&t.unreadTotal>t.maxShowUnread?e("div",{class:["unreadMessages","maxUnread"]},[t._v("\n    +"+t._s(t.maxShowUnread)+"\n  ")]):t._e(),t._v(" "),e("div",[t.isRoomSilent?e("v-icon",{staticClass:"ml-2 mb-1",attrs:{color:"red darken-2",dense:""}},[t._v("\n      mdi-volume-off\n    ")]):t._e()],1)])};Ht._withStripped=!0;const qt=Xt({props:{prettyName:{type:String,default:""},groupId:{type:String,default:""},name:{type:String,default:""},userName:{type:String,default:""},status:{type:String,default:""},list:{type:Boolean,default:!1},isEnabled:{type:Boolean,default:!0},isExternal:{type:Boolean,default:!1},type:{type:String,default:"",required:!0},nbMembers:{type:Number,default:0},isCurrentUser:{type:Boolean,default:!1},lastMessage:{type:String,default:""},chatDrawerContact:{type:Boolean,default:!1},contactRoomId:{type:String,default:null},unreadTotal:{type:Number,default:null},isRoomSilent:{type:Boolean,default:!1}},data:function(){return{isOnline:!0,statusMap:{available:this.$t("exoplatform.chat.available"),away:this.$t("exoplatform.chat.away"),inactive:this.$t("exoplatform.chat.inactive"),donotdisturb:this.$t("exoplatform.chat.donotdisturb"),invisible:this.$t("exoplatform.chat.invisible"),offline:this.$t("exoplatform.chat.button.offline")},activeStatusMap:{available:this.$t("exoplatform.chat.available"),away:this.$t("exoplatform.chat.away"),donotdisturb:this.$t("exoplatform.chat.donotdisturb"),invisible:this.$t("exoplatform.chat.invisible")},maxShowUnread:99}},computed:{statusStyle:function(){return!this.isOnline||"invisible"===this.status&&!this.isCurrentUser?"user-offline":`user-${this.status}`},getStatus(){return this.isEnabled?!this.isOnline||"invisible"===this.status&&!this.isCurrentUser?this.statusMap.offline:this.statusMap[this.status]:this.statusMap.inactive},escapedName(){const t=Ut(this.name);return this.isEnabled||!0!==this.list?t:t.concat(" ").concat("(").concat(this.statusMap.inactive).concat(")")},externalTag(){return`(${this.$t("exoplatform.chat.external")})`},isActive(){return"u"!==this.type||this.isEnabled?"active":"inactive"},contactUrl(){return"u"===this.type?$t(this.userName):"s"===this.type&&this.groupId?Dt(this.groupId,this.prettyName):"#"},avatarUrl(){return"u"===this.type?J(this.userName):"s"===this.type?Q(this.prettyName):a.DEFAULT_ROOM_AVATAR}},created(){document.addEventListener(a.EVENT_DISCONNECTED,this.setOffline),document.addEventListener(a.EVENT_CONNECTED,this.setOnline),document.addEventListener(a.EVENT_RECONNECTED,this.setOnline)},destroyed(){document.removeEventListener(a.EVENT_DISCONNECTED,this.setOffline),document.removeEventListener(a.EVENT_CONNECTED,this.setOnline),document.removeEventListener(a.EVENT_RECONNECTED,this.setOnline)},methods:{setStatus(t){this.$emit("status-changed",t)},setOnline(){this.isOnline=!0},setOffline(){this.isOnline=!1}}},Ht,[],!1,null,null,null).exports;var jt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"contactListContainer",attrs:{role:"navigation"}},[t.ap?e("div",[e("div",{directives:[{name:"show",rawName:"v-show",value:"mobile"!==t.mq||t.contactSearchMobile,expression:"mq !== 'mobile' || contactSearchMobile"}],staticClass:"contactFilter"},["mobile"!==t.mq?e("i",{staticClass:"uiIconSearchLight"}):t._e(),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchTerm,expression:"searchTerm"}],ref:"contactSearch",attrs:{placeholder:t.$t("exoplatform.chat.contact.search.placeholder"),type:"text"},domProps:{value:t.searchTerm},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.closeContactSearch.apply(null,arguments)},input:function(e){e.target.composing||(t.searchTerm=e.target.value)}}}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:""!==t.searchTerm,expression:"searchTerm !== ''"}],staticClass:"contact-search-close",on:{click:t.closeContactSearch}},[e("i",{staticClass:"uiIconClose"})])]),t._v(" "),e("div",{staticClass:"listHeader"},["mobile"===t.mq?e("div",{staticClass:"hamburger-menu",on:{click:function(e){return t.$emit("open-side-menu")}}},[e("i",{staticClass:"uiIconMenu"})]):t._e(),t._v(" "),"mobile"!==t.mq?e("exo-dropdown-select",[e("span",{attrs:{slot:"toggle"},slot:"toggle"},[t._v(t._s(t.sortByDate[t.sortFilter]))]),t._v(" "),e("i",{staticClass:"uiIconArrowDownMini",attrs:{slot:"toggle"},slot:"toggle"}),t._v(" "),e("div",{staticClass:"dropdown-category",attrs:{slot:"menu"},slot:"menu"},[t._v(t._s(t.$t("exoplatform.chat.contact.filter.sort")))]),t._v(" "),t._l(t.sortByDate,(function(s,o){return e("li",{key:o,attrs:{slot:"menu"},on:{click:function(e){return t.selectSortFilter(o)}},slot:"menu"},[e("a",{attrs:{href:"#"}},[e("i",{staticClass:"uiIconTick",class:{"not-filter":t.sortFilter!==o}}),t._v(t._s(s))])])})),t._v(" "),e("div",{staticClass:"dropdown-category",attrs:{slot:"menu"},slot:"menu"},[t._v(t._s(t.$t("exoplatform.chat.contact.filter.actions")))]),t._v(" "),e("li",{attrs:{slot:"menu"},on:{click:t.markAllAsRead},slot:"menu"},[e("a",{attrs:{href:"#"}},[e("i",{staticClass:"uiIconTick not-filter"}),t._v(t._s(t.$t("exoplatform.chat.contact.mark.read")))])])],2):t._e(),t._v(" "),"mobile"!==t.mq?e("exo-dropdown-select",[e("span",{attrs:{slot:"toggle"},slot:"toggle"},[t._v(t._s(t.filterByType[t.typeFilter]))]),t._v(" "),e("i",{staticClass:"uiIconArrowDownMini",attrs:{slot:"toggle"},slot:"toggle"}),t._v(" "),t._l(t.filterByType,(function(s,o){return e("li",{key:o,attrs:{slot:"menu"},on:{click:function(e){return t.selectTypeFilter(o)}},slot:"menu"},[e("a",{attrs:{href:"#"}},[e("i",{staticClass:"uiIconTick",class:{"not-filter":t.typeFilter!==o}}),t._v(t._s(s))])])}))],2):t._e(),t._v(" "),t.externalUser?t._e():e("div",{staticClass:"room-actions"},["mobile"===t.mq?e("div",{staticClass:"filter-action",on:{click:function(e){t.filterMenuClosed=!1}}},[e("i",{staticClass:"uiIconFilter"})]):t._e(),t._v(" "),e("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.top",value:t.$t("exoplatform.chat.create.team"),expression:"$t('exoplatform.chat.create.team')",modifiers:{top:!0}}],staticClass:"add-room-action",on:{click:t.openCreateRoomModal}},[e("i",{staticClass:"uiIconSimplePlus"})]),t._v(" "),"mobile"===t.mq?e("div",{on:{click:t.selectContactSearch}},[e("i",{staticClass:"uiIconSearch"})]):t._e()])],1)]):t._e(),t._v(" "),e("div",{staticClass:"contactList isList",attrs:{id:"chat-users"}},[t.filteredContacts.length>0?e("transition-group",{attrs:{name:"chat-contact-list"}},t._l(t.filteredContacts,(function(s){return e("div",{directives:[{name:"hold-tap",rawName:"v-hold-tap",value:t.openContactActions,expression:"openContactActions"}],key:s.user,staticClass:"contact-list-item contact-list-room-item",class:{selected:"mobile"!==t.mq&&t.selected&&s&&t.selected.user===s.user,currentContactMenu:"mobile"===t.mq&&t.contactMenu&&t.contactMenu.user===s.user,hasUnreadMessages:s.unreadTotal>0,"has-not-sent-messages":s.hasNotSentMessages},attrs:{title:t.contactTooltip(s)},on:{click:function(e){return t.selectContact(s)}}},[e("exo-chat-contact",{attrs:{"is-external":"true"===s.isExternal,"is-enabled":"true"===s.isEnabledUser||"null"===s.isEnabledUser,list:!0,type:s.type,"user-name":s.user,"pretty-name":s.prettyName,"group-id":s.groupId,name:s.fullName,status:s.status,"unread-total":s.unreadTotal,"contact-room-id":s.room,"is-room-silent":s.isRoomSilent,"last-message":t.getLastMessage(s.lastMessage,s.type)}},["mobile"===t.mq?e("div",{staticClass:"uiIcon favorite",class:{"is-fav":s.isFavorite}}):t._e(),t._v(" "),"mobile"===t.mq||t.drawerStatus?e("div",{class:[t.drawerStatus?"last-message-time-drawer last-message-time":"last-message-time"]},[t._v("\n            "+t._s(t.getLastMessageTime(s))+"\n          ")]):t._e()]),t._v(" "),t.drawerStatus?t._e():e("i",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.top.body",value:t.$t("exoplatform.chat.msg.notDelivered"),expression:"$t('exoplatform.chat.msg.notDelivered')",modifiers:{top:!0,body:!0}}],staticClass:"uiIconNotification"}),t._v(" "),"mobile"!==t.mq?e("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.top.body",value:t.favoriteTooltip(s),expression:"favoriteTooltip(contact)",modifiers:{top:!0,body:!0}}],staticClass:"uiIcon favorite my-auto pb-1",class:{"is-fav":s.isFavorite},on:{click:function(e){return e.stopPropagation(),t.toggleFavorite(s)}}}):t._e()],1)})),0):t._e(),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.loadingContacts,expression:"loadingContacts"}],staticClass:"contact-list-item isList"},[e("div",{staticClass:"seeMoreContacts"},[t._v("\n        "+t._s(t.$t("exoplatform.chat.loading"))+"\n      ")])]),t._v(" "),0===t.filteredContacts.length?e("div",[e("div",{staticClass:"center"},[e("div",{staticClass:"noResultFilter"},[t._m(0),t._v(" "),e("span",{staticClass:"text"},[t._v("\n            "+t._s(t.noResultFilterMessage)+"\n            "),t.isExternal?t._e():e("v-icon",{staticClass:"my-auto",attrs:{size:16},on:{click:t.openQuickCreateChatDiscussionDrawer}},[t._v("\n              fa-plus\n            ")])],1)])])]):t._e(),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.hasMoreContacts,expression:"hasMoreContacts"}],staticClass:"contact-list-item isList",on:{click:function(e){return t.loadMore()}}},[e("div",{staticClass:"seeMoreContacts"},[e("a",{attrs:{href:"#"}},[e("u",[t._v(t._s(t.$t("exoplatform.chat.seeMore")))])]),t._v(" "),e("i",{staticClass:"uiIconArrowDownMini"})])]),t._v(" "),"mobile"==t.mq&&null!==t.contactMenu?e("div",{directives:[{name:"show",rawName:"v-show",value:!t.contactMenuClosed,expression:"!contactMenuClosed"}],staticClass:"uiPopupWrapper chat-modal-mask",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.closeContactActions.apply(null,arguments)}}},[e("ul",{staticClass:"mobile-options"},[e("li",[e("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.toggleFavorite(t.contactMenu)}}},[t._v(t._s(!1===t.contactMenu.isFavorite?t.$t("exoplatform.chat.add.favorites"):t.$t("exoplatform.chat.remove.favorites")))])]),t._v(" "),e("li",{directives:[{name:"show",rawName:"v-show",value:"t"!=t.contactMenu.type,expression:"contactMenu.type != 't'"}],on:{click:function(t){t.stopPropagation()}}},[e("a",{attrs:{href:t.getProfileLink()}},[t._v(t._s(t.$t("exoplatform.chat.contact.profile")))])])])]):t._e(),t._v(" "),"mobile"==t.mq?e("div",{directives:[{name:"show",rawName:"v-show",value:!t.filterMenuClosed,expression:"!filterMenuClosed"}],staticClass:"uiPopupWrapper chat-modal-mask"},[e("ul",{staticClass:"mobile-options filter-options"},[e("li",{staticClass:"options-category"},[e("i",{staticClass:"uiIconClose",on:{click:t.cancelFilterMobile}}),t._v(" "),e("span",[e("i",{staticClass:"uiIconFilter"}),t._v(t._s(t.$t("exoplatform.chat.contact.filter")))]),t._v(" "),e("div",{on:{click:t.saveFilterMobile}},[t._v(t._s(t.$t("exoplatform.chat.contact.filter.save")))])]),t._v(" "),e("li",{staticClass:"options-category"},[t._v(t._s(t.$t("exoplatform.chat.contact.filter.sort")))]),t._v(" "),t._l(t.sortByDate,(function(s,o){return e("li",{key:o,attrs:{slot:"menu"},on:{click:function(e){t.sortFilterMobile=o}},slot:"menu"},[e("a",{attrs:{href:"#"}},[e("i",{staticClass:"uiIconTick",class:{"not-filter":t.sortFilterMobile!==o}}),t._v(t._s(s))])])})),t._v(" "),e("li",{staticClass:"options-category"},[t._v(t._s(t.$t("exoplatform.chat.contact.filter.by")))]),t._v(" "),t._l(t.filterByType,(function(s,o){return e("li",{key:o,on:{click:function(e){t.typeFilterMobile=o}}},[e("a",{attrs:{href:"#"}},[e("i",{staticClass:"uiIconTick",class:{"not-filter":t.typeFilterMobile!==o}}),t._v(t._s(s))])])})),t._v(" "),e("li",{on:{click:function(e){t.allAsReadFilterMobile=!t.allAsReadFilterMobile}}},[e("a",{attrs:{href:"#"}},[e("i",{staticClass:"uiIconTick",class:{"not-filter":!t.allAsReadFilterMobile}}),t._v(t._s(t.$t("exoplatform.chat.contact.mark.read")))])])],2)]):t._e()],1),t._v(" "),e("exo-chat-room-form-modal",{attrs:{show:t.createRoomModal,selected:t.newRoom},on:{"room-saved":t.roomSaved,"modal-closed":t.closeModal}})],1)};function Kt(t){const e=new Date(t);return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}function zt(t){return Kt(t).toLocaleDateString(eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.language?eXo.env.portal.language.replace("_","-"):"en")}function Wt(t){let e=new Date;return t&&(e=new Date(t)),e.setSeconds(0),e.setMilliseconds(0),e}function Jt(t,e){return Kt(t).getTime()===Kt(e).getTime()}function Qt(t,e){let s=new Date;t&&(s=new Date(t));let o="",a=s.getHours();const i=s.getMinutes();let n="";if(s.getTimezoneOffset()>60){const t=12;n="AM",a>t?(n="PM",a-=t):a===t&&(n="PM")}if(a<10&&(o="0"),o+=`${a}:`,i<10&&(o+="0"),o+=i,""!==n&&(o+=` ${n}`),e){const t=(new Date).toLocaleDateString(),e=s.toLocaleDateString();t!==e&&(o=`${e} ${o}`)}return o}jt._withStripped=!0;const Yt=Xt({props:{unreadMessages:{type:Array,default:function(){return[{}]}},drawerStatus:{type:Boolean,default:!1},contacts:{type:Array,default:function(){return[]}},contactsLoaded:{type:Boolean,default:function(){return!1}},loadingContacts:{type:Boolean,default:function(){return!1}},selected:{type:Object,default:function(){return{}}},searchWord:{type:String,default:""},isChatDrawer:{type:Boolean,default:!1}},data:function(){return{sortByDate:{Recent:this.$t("exoplatform.chat.contact.recent"),Unread:this.$t("exoplatform.chat.contact.unread")},sortFilter:a.SORT_FILTER_DEFAULT,sortFilterMobile:null,filterByType:{All:this.$t("exoplatform.chat.contact.all"),u:this.$t("exoplatform.chat.people"),t:this.$t("exoplatform.chat.teams"),s:this.$t("exoplatform.chat.spaces"),Favorites:this.$t("exoplatform.chat.favorites")},typeFilter:a.TYPE_FILTER_DEFAULT,typeFilterMobile:null,allAsReadFilterMobile:!1,contactSearchMobile:!1,externalUser:!1,createRoomModal:!1,searchTerm:"",newRoom:{name:"",participants:[]},contactMenu:null,contactMenuClosed:!0,filterMenuClosed:!0,contactsToDisplay:[],inactive:this.$t("exoplatform.chat.inactive"),external:this.$t("exoplatform.chat.external"),nbrePages:0,contactList:[],isExternal:!1}},computed:{noResultFilterMessage(){return this.isExternal?this.$t("exoplatform.chat.no.results.filter.external.message"):this.$t("exoplatform.chat.no.results.filter.message")},statusStyle(){return"inline"===this.contactStatus?"user-available":"user-invisible"},filteredContacts:function(){const t=this.contactList.slice(0).filter((t=>(t.room||t.user)&&t.fullName)),e=this;return"Unread"!==this.sortFilter||this.isChatDrawer?t.sort((function(t,s){return t.timestamp<s.timestamp?e.compareSilentsForSort(t,s,1):t.timestamp>s.timestamp?e.compareSilentsForSort(t,s,-1):e.compareSilentsForSort(t,s,0)})):t.sort((function(t,s){return 0==s.unreadTotal-t.unreadTotal?t.timestamp<s.timestamp?e.compareSilentsForSort(t,s,1):t.timestamp>s.timestamp?e.compareSilentsForSort(t,s,-1):e.compareSilentsForSort(t,s,0):t.unreadTotal<s.unreadTotal?e.compareSilentsForSort(t,s,1):t.unreadTotal>s.unreadTotal?e.compareSilentsForSort(t,s,-1):e.compareSilentsForSort(t,s,0)})),t.slice(0,this.contactsToDisplay.length)},hasMoreContacts(){return Math.floor(this.filteredContacts.length/a.ROOMS_PER_PAGE)>this.nbrePages}},watch:{contacts(){this.contactList=this.contacts.slice(),this.contactsToDisplay=this.contacts.slice()},searchTerm(t){this.searchTerm=t,this.nbrePages=0,N(a.STORED_PARAM_TERM_FILTER,this.searchTerm),this.$emit("change-filter-type",this.searchTerm,this.typeFilter,this.nbrePages)},searchWord(t){this.searchTerm=t,nt().then((t=>{ft(eXo.chat.userSettings,t,this.searchTerm).then((t=>{this.contactList=t.rooms}))}))}},created(){this.$userService.getUser(eXo.env.portal.userName).then((t=>{this.isExternal="true"===t.external})),document.addEventListener(a.EVENT_ROOM_MEMBER_LEFT,this.leftRoom),document.addEventListener(a.EVENT_ROOM_DELETED,this.leftRoom),document.addEventListener(a.EVENT_ROOM_MEMBER_JOINED,this.joinedToNewRoom),document.addEventListener(a.EVENT_ROOM_FAVORITE_ADDED,this.favoriteAdded),document.addEventListener(a.EVENT_ROOM_FAVORITE_REMOVED,this.favoriteRemoved),document.addEventListener(a.EVENT_MESSAGE_RECEIVED,this.messageReceived),document.addEventListener(a.EVENT_MESSAGE_SENT,this.messageSent),document.addEventListener(a.EVENT_USER_STATUS_CHANGED,this.contactStatusChanged),document.addEventListener(a.EVENT_MESSAGE_READ,this.markRoomMessagesRead),document.addEventListener(a.ACTION_ROOM_EDIT,this.editRoom),document.addEventListener(a.ACTION_ROOM_LEAVE,this.leaveRoom),document.addEventListener(a.ACTION_ROOM_DELETE,this.deleteRoom),document.addEventListener(a.ACTION_ROOM_SELECT,this.selectContact),document.addEventListener(a.EVENT_ROOM_SELECTION_CHANGED,this.contactChanged),document.addEventListener(a.EVENT_MESSAGE_NOT_SENT,this.messageNotSent),document.addEventListener(a.ROOM_NOTIFICATION_SETTINGS_UPDATED,this.refreshNotificationSettings),this.typeFilter=y(a.STORED_PARAM_TYPE_FILTER,a.TYPE_FILTER_DEFAULT),this.sortFilter=y(a.STORED_PARAM_SORT_FILTER,a.SORT_FILTER_DEFAULT),this.initFilterMobile(),It(eXo.env.portal.userName).then((t=>{this.externalUser=t&&"true"===t.external})),this.contactList=this.contacts.slice(),this.contactsToDisplay=this.contacts.slice(),this.$root.$on("quick-chat-discussion-saved",(t=>this.roomSaved(t)))},destroyed(){document.removeEventListener(a.EVENT_ROOM_MEMBER_LEFT,this.leftRoom),document.removeEventListener(a.EVENT_ROOM_DELETED,this.leftRoom),document.removeEventListener(a.EVENT_ROOM_MEMBER_JOINED,this.joinedToNewRoom),document.removeEventListener(a.EVENT_ROOM_FAVORITE_ADDED,this.favoriteAdded),document.removeEventListener(a.EVENT_ROOM_FAVORITE_REMOVED,this.favoriteRemoved),document.removeEventListener(a.EVENT_MESSAGE_RECEIVED,this.messageReceived),document.removeEventListener(a.EVENT_MESSAGE_SENT,this.messageSent),document.removeEventListener(a.EVENT_USER_STATUS_CHANGED,this.contactStatusChanged),document.removeEventListener(a.EVENT_MESSAGE_READ,this.markRoomMessagesRead),document.removeEventListener(a.ACTION_ROOM_EDIT,this.editRoom),document.removeEventListener(a.ACTION_ROOM_LEAVE,this.leaveRoom),document.removeEventListener(a.ACTION_ROOM_DELETE,this.deleteRoom),document.removeEventListener(a.ACTION_ROOM_SELECT,this.selectContact),document.removeEventListener(a.EVENT_ROOM_SELECTION_CHANGED,this.contactChanged),document.removeEventListener(a.EVENT_MESSAGE_NOT_SENT,this.messageNotSent),document.removeEventListener(a.ROOM_NOTIFICATION_SETTINGS_UPDATED,this.refreshNotificationSettings)},methods:{compareSilentsForSort:(t,e,s)=>t.isRoomSilent&&0!==e.unreadTotal&&!e.isRoomSilent?1:!t.isRoomSilent&&e.isRoomSilent&&0!==t.unreadTotal?-1:s,refreshNotificationSettings(t){const e=t.detail.data.targetRoom;this.filteredContacts.filter((s=>{s.room===e&&("silence"===t.detail.data.notificationTrigger?s.isRoomSilent=!0:s.isRoomSilent=!1)}))},normalizeText:t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),selectContact(t){t||(t={}),t.detail&&(t=t.detail),t||t.room||!t.user||(t=t.user),t.type&&"u"===t.type&&"null"===t.isEnabledUser&&""===t.isExternal&&lt(t.user).then((e=>{dt(eXo.chat.userSettings,t.user,e.isDeleted,e.isEnabled,e.isExternal),this.selected.isEnabledUser=!e.isDeleted&&e.isEnabled?"true":"false",t.isEnabledUser=this.selected.isEnabledUser,t.isExternal=e.isExternal})),eXo.chat.selectedContact=t,this.contactChanged(t),this.$emit("contact-selected",t)},contactChanged(t){const e=t;e&&e.room&&H(e.room)},markAllAsRead(){H(),this.unreadMessages.shift()},toggleFavorite(t){ht(t.room,t.user,!t.isFavorite).then((()=>{t.isFavorite=!t.isFavorite,this.$emit("refresh-contacts",!0),this.sortFilter=y(a.STORED_PARAM_SORT_FILTER,a.SORT_FILTER_DEFAULT)}))},selectSortFilter(t){this.sortFilter=t,N(a.STORED_PARAM_SORT_FILTER,this.sortFilter)},selectTypeFilter(t){this.typeFilter=t,N(a.STORED_PARAM_TYPE_FILTER,this.typeFilter),this.nbrePages=0,this.$emit("change-filter-type",this.searchTerm,this.typeFilter,this.nbrePages),this.$emit("refresh-contacts",!0)},initFilterMobile(){this.typeFilterMobile=this.typeFilter,this.sortFilterMobile=this.sortFilter},saveFilterMobile(){this.filterMenuClosed=!0,this.selectTypeFilter(this.typeFilterMobile),this.selectSortFilter(this.sortFilterMobile),this.allAsReadFilterMobile&&this.markAllAsRead(),this.allAsReadFilterMobile=!1},cancelFilterMobile(){this.filterMenuClosed=!0,this.allAsReadFilterMobile=!1,this.initFilterMobile()},selectContactSearch(){this.contactSearchMobile=!0,this.$nextTick((()=>this.$refs.contactSearch.focus()))},closeContactSearch(){this.contactSearchMobile=!1,this.searchTerm=""},openCreateRoomModal(){this.newRoom={},this.createRoomModal=!0},messageNotSent(t){const e=this.findContact(t.detail.room);e&&(e.hasNotSentMessages=!0,this.$forceUpdate())},removeObjectIfExists(t,e){const s=t.findIndex((t=>t.room===e));s>-1&&t.splice(s,1)},pushObjectIfNotExists(t,e){const s=t.findIndex((t=>t.msgId===e.msgId));return-1===s?(t.push(e),!0):(t[s]=e,!1)},messageReceived(){this.$emit("refresh-contacts",!0),this.$forceUpdate()},messageSent(t){const e=t.detail,s=this.findContactByRoomOrUser(e.room,e.data?e.data.user:e.sender);if(s&&(s.lastMessage||(s.lastMessage={}),s.lastMessage=e.data,s.timestamp=e.data.timestamp,eXo.env.portal.userName===e.sender)){const t=s.room,o=e.data.options&&e.data.options.type||"message",i=("u"===s.type?"user":"s"===s.type&&"space")||"t"===s.type&&"team"||null,n=e.data.msg&&e.data.msg.length||0,r="u"===s.type?1:s.participantsCount,c="u"===s.type?1:s.activeParticipantsCount,l={module:"chat",subModule:"chat-message",operation:"sendChatMessage",userName:eXo.env.portal.userName,spacePrettyName:s.prettyName,portalUri:eXo.env.server.portalBaseURL,parameters:{participantsCount:r,activeParticipantsCount:c,chatRoomId:t,chatRoomType:i,chatMessageType:o,chatMessageLength:n}};document.dispatchEvent(new CustomEvent(a.EVENT_MESSAGE_STATISTIC,{detail:l}))}},roomSaved(t){this.createRoomModal=!1,this.selectContact(t)},editRoom(){Et(eXo.chat.userSettings,this.selected).then((t=>{this.selected.participants=t.users,this.newRoom=JSON.parse(JSON.stringify(this.selected)),this.createRoomModal=!0}))},leaveRoom(){this.selected&&"t"===this.selected.type&&G(this.selected.room)},deleteRoom(){this.selected&&"t"===this.selected.type&&V(this.selected.room)},closeModal(){this.createRoomModal=!1,this.newRoom={}},markRoomMessagesRead(t){const e=t.detail;if(e&&e.room){const t=this.findContact(e.room);t&&(t.unreadTotal=0,t.hasNotSentMessages=!1,this.removeObjectIfExists(this.unreadMessages,e.room))}else this.contactsToDisplay.forEach((t=>{t.unreadTotal=0})),this.$emit("refresh-contacts",!0),this.$forceUpdate()},leftRoom(t){const e=t.detail?t.detail:t,s=e.data&&e.data.sender?e.data.sender:e.sender;if("room-member-left"===e.event&&s!==eXo.chat.userSettings.username)return;const o=e.data&&e.data.room?e.data.room:e.room,a=this.contactsToDisplay.findIndex((t=>t.room===o));a>=0&&(this.contactsToDisplay.splice(a,1),this.selected&&this.selected.room===o&&(this.contactsToDisplay&&0!==this.contactsToDisplay.length&&this.filteredContacts&&this.filteredContacts.length?this.selectContact(this.filteredContacts[0]):this.selectContact()))},joinedToNewRoom(t){this.findContact(t.detail.room)||this.contactsToDisplay.push(t.detail.data)},favoriteAdded(t){const e=t.room?t.room:t.detail&&t.detail.room?t.detail.room:null,s=this.findContact(e);s&&(s.isFavorite=!0)},favoriteRemoved(t){const e=t.room?t.room:t.detail&&t.detail.room?t.detail.room:null,s=this.findContact(e);s&&(s.isFavorite=!1)},findContact(t,e){e||(e="room");const s=new URL(location.href).searchParams.get("roomId");if(s){window.history.replaceState(null,null,window.location.pathname);const t=this.findContact(s);this.selectContact(t)}return this.contactsToDisplay.find((s=>s[e]===t))},findContactByRoomOrUser(t,e){let s=null;return t&&t.trim().length&&(s=this.findContact(t,"room")),!s&&e&&e.trim().length&&(s=this.findContact(e,"user")),s},loadMore(){this.nbrePages++,this.$emit("load-more-contacts",this.searchTerm,this.typeFilter,this.nbrePages)},favoriteTooltip(t){return!0===t.isFavorite?this.$t("exoplatform.chat.remove.favorites"):this.$t("exoplatform.chat.add.favorites")},contactTooltip(t){let e=t.fullName;return"true"===t.isExternal&&(e=`${e} (${this.external})`),"true"===t.isEnabledUser||"null"===t.isEnabledUser?e:`${e} (${this.inactive})`},getLastMessage(t,e){if(t){if(t.isSystem){let e="";return _.forEach((s=>{t.options.type===s.type&&(e=`<span><i class="${s.iconClass||""}"></i>${this.$t(s.nameKey||s.labelKey||"")}</span>`)})),e}{const s=this.filterLastMessage(t.msg);return"u"===e?t.msg:`${t.fullname}: ${s}`}}return""},getLastMessageTime(t){const e=t.lastMessage&&t.lastMessage.timestamp?t.lastMessage.timestamp:t.timestamp;return e?Jt(e,(new Date).getTime())?Qt(e):-1===e?"":zt(e):""},decodeHtml:t=>(new DOMParser).parseFromString(t,"text/html").documentElement.textContent,filterLastMessage(t){return t===a.DELETED_MESSAGE?this.$t("exoplatform.chat.deleted"):t.indexOf("<br/>")>=0?t.replace(t.slice(t.indexOf("<br/>")),"..."):this.decodeHtml(t)},contactStatusChanged(t){const e=t.detail;if(e.data&&e.data.status&&e.sender&&e.sender.trim().length&&eXo.chat.userSettings.username!==e.sender){const t=this.findContactByRoomOrUser(null,e.sender);t&&(t.status=e.data.status)}},openContactActions(t){const e=this.contactsToDisplay.find((e=>e.user===t));this.contactMenuClosed=!1,this.contactMenu=e},closeContactActions(){this.contactMenuClosed=!0,this.contactMenu=null},getProfileLink(){return"u"===this.contactMenu.type?$t(this.contactMenu.user):"s"===this.contactMenu.type?Dt(this.contactMenu.fullName):"#"},openQuickCreateChatDiscussionDrawer(){this.$root.$emit(a.ACTION_CHAT_OPEN_QUICK_CREATE_DISCUSSION_DRAWER)}}},jt,[function(){var t=this._self._c;return t("div",[t("img",{staticClass:"mb-2",attrs:{alt:"",loading:"lazy",src:"/chat/img/no-result-filter.png"}})])}],!1,null,null,null).exports;var Zt=function(){var t=this,e=t._self._c;return t.contact&&0!==Object.keys(t.contact).length&&"u"!=t.contact.type?e("div",{staticClass:"uiRoomUsersContainerArea"},[e("div",{ref:"roomParticipants",staticClass:"room-participants",class:{collapsed:t.isCollapsed&&"mobile"!==t.mq}},["mobile"!==t.mq?e("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.left.body",value:t.tooltipCollapse,expression:"tooltipCollapse",modifiers:{left:!0,body:!0}}],staticClass:"room-users-collapse-btn",on:{click:t.toggleCollapsed}},[e("i",{staticClass:"uiIcon"})]):t._e(),t._v(" "),e("div",{staticClass:"room-participants-header no-user-selection"},["mobile"==t.mq?e("div",{on:{click:t.backToConversation}},[e("i",{staticClass:"uiIconGoBack"})]):t._e(),t._v(" "),e("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.left.body",value:t.tooltipParticipants,expression:"tooltipParticipants",modifiers:{left:!0,body:!0}}],staticClass:"room-participants-filter"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isCollapsed&&"mobile"!==t.mq,expression:"isCollapsed && mq !== 'mobile'"}],staticClass:"actionIcon",on:{click:t.toggleParticipantFilter}},[e("i",{staticClass:"uiIconChatMember uiIconChatLightGray",class:{"all-participants":t.participantFilterClass}})])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isCollapsed||"mobile"===t.mq,expression:"!isCollapsed || mq === 'mobile'"}],staticClass:"room-participants-title"},[t._v("\n        "+t._s(t.$t("exoplatform.chat.participants.label"))+"\n        "),e("span",{directives:[{name:"show",rawName:"v-show",value:t.participantsCount>0,expression:"participantsCount > 0"}],staticClass:"nb-participants"},[t._v("("+t._s(t.participantsCount)+")")])]),t._v(" "),e("exo-dropdown-select",{directives:[{name:"show",rawName:"v-show",value:!t.isCollapsed||"mobile"===t.mq,expression:"!isCollapsed || mq === 'mobile'"}],attrs:{position:"right"}},[e("span",{attrs:{slot:"toggle"},slot:"toggle"},[t._v(t._s(t.filterByStatus[t.participantFilter]))]),t._v(" "),e("i",{staticClass:"uiIconArrowDownMini",attrs:{slot:"toggle"},slot:"toggle"}),t._v(" "),t._l(t.filterByStatus,(function(s,o){return e("li",{key:o,attrs:{slot:"menu"},on:{click:function(e){return t.selectParticipantFilter(o)}},slot:"menu"},[e("a",{attrs:{href:"#"}},[e("i",{staticClass:"uiIconTick",class:{"not-filter":t.participantFilter!==o}}),t._v(t._s(s))])])}))],2)],1),t._v(" "),e("div",{ref:"roomParticipantsList",staticClass:"room-participants-list isList"},[t._l(t.participants,(function(t){return e("div",{key:t.name,staticClass:"contact-list-item"},[e("exo-chat-contact",{attrs:{"is-external":"true"===t.isExternal,"is-enabled":"true"===t.isEnabled||"null"===t.isEnabled,list:!0,"user-name":t.name,name:t.fullname,status:t.status,type:"u"}})],1)})),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isCollapsed||"mobile"===t.mq,expression:"!isCollapsed || mq === 'mobile'"}],staticClass:"room-participants-title"},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.hiddenParticipantsCount>0,expression:"hiddenParticipantsCount > 0"}],staticClass:"nb-participants"},[t._v("++ "+t._s(t.hiddenParticipantsCount)+" "+t._s(t.$t("exoplatform.chat.participants.more.label")))])])],2)])]):t._e()};Zt._withStripped=!0;const te=Xt({data:function(){return{isCollapsed:!0,filterByStatus:{All:this.$t("exoplatform.chat.contact.all"),Online:this.$t("exoplatform.chat.online")},participantFilter:a.STATUS_FILTER_DEFAULT,contact:null,participants:[],participantsCount:0,displayedParticipantsCount:0}},computed:{hiddenParticipantsCount(){return this.participantsCount-this.displayedParticipantsCount},onlineUsersOnly(){return"All"!==this.participantFilter},participantFilterClass(){return"All"===this.participantFilter},tooltipParticipants(){return"All"===this.participantFilter?this.$t("exoplatform.chat.hide.users"):this.$t("exoplatform.chat.show.users")},tooltipCollapse(){return!0===this.isCollapsed?this.$t("exoplatform.chat.expand.users"):this.$t("exoplatform.chat.reduce.users")}},created(){document.addEventListener(a.EVENT_ROOM_SELECTION_CHANGED,this.contactChanged),document.addEventListener(a.EVENT_USER_STATUS_CHANGED,this.contactStatusChanged),document.addEventListener(a.ACTION_ROOM_SHOW_PARTICIPANTS,this.showParticipants),document.addEventListener(a.EVENT_ROOM_MEMBER_LEFT,this.leftRoom),this.participantFilter=y(a.STORED_PARAM_STATUS_FILTER,a.STATUS_FILTER_DEFAULT)},destroyed(){document.removeEventListener(a.ACTION_ROOM_SHOW_PARTICIPANTS,this.showParticipants),document.removeEventListener(a.EVENT_ROOM_SELECTION_CHANGED,this.contactChanged),document.removeEventListener(a.EVENT_USER_STATUS_CHANGED,this.contactStatusChanged),document.removeEventListener(a.EVENT_ROOM_MEMBER_LEFT,this.leftRoom)},methods:{showParticipants(){this.isCollapsed=!1},toggleCollapsed(){this.isCollapsed=!this.isCollapsed},selectParticipantFilter(t){N(a.STORED_PARAM_STATUS_FILTER,t),this.participantFilter=t,this.calculateDisplayedContacts(),this.loadRoomParticipants(this.contact,this.onlineUsersOnly)},toggleParticipantFilter(){"All"===this.participantFilter?this.selectParticipantFilter("Online"):this.selectParticipantFilter("All")},leftRoom(t){const e=t.detail?t.detail:t,s=e.data&&e.data.sender?e.data.sender:e.sender;if((e.data&&e.data.room?e.data.room:e.room)!==this.contact.room)return;const o=this.participants.findIndex((t=>t.name===s));o>=0&&this.participants.splice(o,1),this.loadRoomParticipants(this.contact,this.onlineUsersOnly)},contactChanged(t){const e=t.detail;this.contact=e,this.participants=[],this.calculateDisplayedContacts(),null!==e&&e.type&&"u"!==e.type&&this.loadRoomParticipants(e,this.onlineUsersOnly)},calculateDisplayedContacts(){if(this.displayedParticipantsCount=50,this.$refs.roomParticipants&&this.contact.type&&"t"!==this.contact.type){const t=70,e=20,s=(this.$refs.roomParticipants.clientHeight-t-e)/36;this.displayedParticipantsCount=Math.round(s)}},loadRoomParticipants(t,e){nt().then((s=>{gt(eXo.chat.userSettings,t).then((t=>this.participantsCount=t.usersCount-1)),Et(eXo.chat.userSettings,t,s,this.displayedParticipantsCount,e).then((t=>{this.participants=t.users.map((t=>("null"===t.isEnabled&&lt(t.name).then((e=>{dt(eXo.chat.userSettings,t.name,e.isDeleted,e.isEnabled,e.isExternal),t.isEnabled=e.isEnabled,t.isDeleted=e.isDeleted,t.isExternal=e.isExternal})),s.indexOf(t.name)<0&&(t.status="offline"),t))),this.$emit("participants-loaded",this.participants);const e=["invisible","offline"];return this.displayedParticipantsCount=this.participants.length,this.participants.sort(((t,s)=>{if("away"===t.status&&"available"===s.status||"donotdisturb"===t.status&&"available"===s.status||"donotdisturb"===t.status&&"away"===s.status||e.indexOf(t.status)>-1&&e.indexOf(s.status)<0)return 1}))}))}))},contactStatusChanged(t){const e=t.detail,s=this.participants.find((t=>t.name===e.sender));s&&(s.status=e.data.status)},backToConversation(){this.$emit("back-to-conversation")}}},Zt,[],!1,null,null,null).exports;var ee=function(){var t=this,e=t._self._c;return e("v-app",[e("div",{staticClass:"room-detail",attrs:{id:"room-detail"}},["mobile"==t.mq?e("div",{on:{click:t.backToContactList}},[e("i",{staticClass:"uiIconGoBack"})]):t._e(),t._v(" "),t.showMeetingDrawer?t._e():e("exo-chat-contact",{attrs:{"is-external":"true"===t.contact.isExternal,"is-enabled":"true"===t.contact.isEnabledUser||"null"===t.contact.isEnabledUser,type:t.contact.type,"user-name":t.contact.user,"pretty-name":t.contact.prettyName,"group-id":t.contact.groupId,name:t.contact.fullName,status:t.contact.status,"nb-members":t.nbMembers}},["mobile"!==t.mq?e("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom.body",value:t.favoriteTooltip,expression:"favoriteTooltip",modifiers:{bottom:!0,body:!0}}],staticClass:"uiIcon favorite",class:{"is-fav":t.contact.isFavorite},on:{click:function(e){return e.stopPropagation(),t.toggleFavorite(t.contact)}}}):t._e(),t._v(" "),t.isRoomNotificationSilence?e("v-icon",{attrs:{color:"red darken-2",dense:""}},[t._v("\n        mdi-volume-off\n      ")]):t._e()],1),t._v(" "),e("div",{staticClass:"room-actions-container",class:{"search-active":t.showSearchRoom}},[e("div",{staticClass:"room-search"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],ref:"searchRoom",attrs:{type:"text",placeholder:"search here"},domProps:{value:t.searchText},on:{blur:t.closeSearchRoom,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.closeSearchRoom.apply(null,arguments)},input:function(e){e.target.composing||(t.searchText=e.target.value)}}}),t._v(" "),e("i",{staticClass:"uiIconCloseLight",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.closeSearchRoom.apply(null,arguments)}}})]),t._v(" "),e("div",{staticClass:"room-action-menu"},["null"===t.contact.isEnabledUser||"true"===t.contact.isEnabledUser?e("div",{staticClass:"room-action-components"},t._l(t.enabledRoomActionComponents,(function(s){return e("div",{key:s.key,ref:s.key,refInFor:!0,class:`${s.appClass} ${s.typeClass}`},[s.component?e("div",[e(s.component.name,t._b({directives:[{name:"dynamic-events",rawName:"v-dynamic-events",value:s.component.events,expression:"action.component.events"}],tag:"component"},"component",s.component.props?s.component.props:{},!1))],1):s.element?e("div",{domProps:{innerHTML:t._s(s.element.outerHTML)}}):s.html?e("div",{domProps:{innerHTML:t._s(s.html)}}):t._e()])})),0):t._e(),t._v(" "),e("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom",value:t.$t("exoplatform.chat.search"),expression:"$t('exoplatform.chat.search')",modifiers:{bottom:!0}}],staticClass:"room-search-btn",on:{click:t.openSearchRoom}},[e("i",{staticClass:"uiIconSearchLight"})]),t._v(" "),t.displayMenu?e("exo-dropdown-select",{staticClass:"room-settings-dropdown chat-team-button-dropdown",attrs:{position:"right"},nativeOn:{click:function(e){return t.checkMeetingStatus.apply(null,arguments)}}},[e("i",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom",value:t.$t("exoplatform.chat.moreActions"),expression:"$t('exoplatform.chat.moreActions')",modifiers:{bottom:!0}}],staticClass:"uiIconVerticalDots",attrs:{slot:"toggle"},slot:"toggle"}),t._v(" "),t._l(t.enabledSettingActions,(function(s){return e("li",{key:s.key,class:`room-setting-action-${s.key}`,attrs:{slot:"menu"},on:{click:function(e){return e.stopPropagation(),t.executeAction(s)}},slot:"menu"},[e("a",{attrs:{href:"#"}},[e("i",{staticClass:"uiIconRoomSetting",class:s.class}),t._v("\n              "+t._s(t.$t(s.labelKey))+"\n            ")])])}))],2):t._e()],1)]),t._v(" "),e("exo-chat-room-notification-modal",{attrs:{room:t.contact.room,"room-name":t.contact.fullName,show:t.openNotificationSettings},on:{"modal-closed":t.closeNotificationSettingsModal}}),t._v(" "),e("exo-chat-modal",{directives:[{name:"show",rawName:"v-show",value:t.showConfirmModal,expression:"showConfirmModal"}],attrs:{title:t.$t(t.confirmTitle)},on:{"modal-closed":function(e){t.showConfirmModal=!1}}},[e("div",{staticClass:"modal-body"},[e("p",[e("span",{staticClass:"confirmationIcon",attrs:{id:"team-delete-window-chat-name"},domProps:{innerHTML:t._s(t.unescapeHTML(t.$t(t.confirmMessage,{0:t.escapeHTML(t.contact.fullName)})))}})])]),t._v(" "),e("div",{staticClass:"uiAction uiActionBorder"},[e("a",{staticClass:"btn btn-primary",attrs:{id:"team-delete-button-ok",href:"#"},on:{click:function(e){t.confirmAction(t.contact),t.leaveRoomAndRemoveFavorite(t.contact)}}},[t._v(t._s(t.$t(t.confirmOKMessage)))]),t._v(" "),e("a",{staticClass:"btn",attrs:{id:"team-delete-button-cancel",href:"#"},on:{click:function(e){t.showConfirmModal=!1}}},[t._v(t._s(t.$t(t.confirmKOMessage)))])])])],1)])};ee._withStripped=!0;const se=Xt({props:{contact:{type:Object,default:()=>({})},showMeetingDrawer:{type:Boolean,default:!1},isRoomNotificationSilence:{type:Boolean,default:()=>!1},roomActions:{type:Array,default:function(){return[{}]}}},data:()=>({settingActions:[],meetingStarted:!1,nbMembers:0,showSearchRoom:!1,searchText:"",openNotificationSettings:!1,showConfirmModal:!1,confirmTitle:"",confirmMessage:"",confirmOKMessage:"",confirmKOMessage:"",confirmAction(){},roomActionComponents:g,settingKey:""}),computed:{isAdmin(){return this.contact.admins&&this.contact.admins.indexOf(eXo.chat.userSettings.username)>=0},favoriteTooltip(){return!0===this.contact.isFavorite?this.$t("exoplatform.chat.remove.favorites"):this.$t("exoplatform.chat.add.favorites")},displayMenu(){return"s"===this.contact.type||"t"===this.contact.type},enabledSettingActions(){return this.settingActions&&this.settingActions.filter((t=>this.displayItem(t)))||[]},enabledRoomActionComponents(){return this.roomActionComponents&&this.roomActionComponents.filter((t=>t.enabled))||[]}},watch:{searchText(t){document.dispatchEvent(new CustomEvent(a.ACTION_MESSAGE_SEARCH,{detail:t}))},contact(t){this.nbMembers=t&&t.participantsCount?t.participantsCount.length:0,this.meetingStarted=t.meetingStarted}},created(){this.settingActions=this.roomActions,document.addEventListener(a.ACTION_ROOM_START_MEETING,this.startMeeting),document.addEventListener(a.ACTION_ROOM_STOP_MEETING,this.stopMeeting),document.addEventListener(a.ACTION_ROOM_OPEN_SETTINGS,this.openNotificationSettingsModal),document.addEventListener(a.EVENT_ROOM_PARTICIPANTS_LOADED,this.participantsLoaded),document.addEventListener(a.ACTION_ROOM_FAVORITE_ADD,this.addToFavorite),document.addEventListener(a.ACTION_ROOM_FAVORITE_REMOVE,this.removeFromFavorite),this.meetingStarted=this.contact&&this.contact.meetingStarted},mounted(){this.initRoomActionComponents()},destroyed(){document.removeEventListener(a.ACTION_ROOM_START_MEETING,this.startMeeting),document.removeEventListener(a.ACTION_ROOM_STOP_MEETING,this.stopMeeting),document.removeEventListener(a.ACTION_ROOM_OPEN_SETTINGS,this.openNotificationSettingsModal),document.removeEventListener(a.EVENT_ROOM_PARTICIPANTS_LOADED,this.participantsLoaded),document.removeEventListener(a.ACTION_ROOM_FAVORITE_ADD,this.addToFavorite),document.removeEventListener(a.ACTION_ROOM_FAVORITE_REMOVE,this.removeFromFavorite)},methods:{addToFavorite(t){const e=t.detail;ht(e.room,e.user,!0).then((()=>{e.isFavorite=!0,this.$root.$emit("refresh-contacts",!0)}))},removeFromFavorite(t){const e=t.detail;ht(e.room,e.user,!1).then((()=>{e.isFavorite=!1,this.$root.$emit("refresh-contacts",!0)}))},toggleFavorite(t){ht(t.room,t.user,!t.isFavorite).then((()=>{t.isFavorite=!t.isFavorite,this.$root.$emit("refresh-contacts",!0)}))},openSearchRoom(){this.showSearchRoom=!0,this.$nextTick((()=>this.$refs.searchRoom.focus()))},closeSearchRoom(t){"blur"===t.type&&""!==this.searchText||(this.showSearchRoom=!1,this.searchText="")},openNotificationSettingsModal(){this.openNotificationSettings=!0},closeNotificationSettingsModal(){this.openNotificationSettings=!1},executeAction(t){t.confirm?(this.confirmTitle=t.confirm.title,this.confirmMessage=t.confirm.message,this.confirmOKMessage=t.confirm.okMessage,this.confirmKOMessage=t.confirm.koMessage,this.confirmAction=t.confirm.confirmed,this.showConfirmModal=!0,this.settingKey=t.key):document.dispatchEvent(new CustomEvent(`exo-chat-setting-${t.key}-requested`,{detail:this.contact})),this.$children[1]&&this.$children[1].$el&&this.$children[1].$el.classList&&this.$children[1].$el.classList.remove("open")},leaveRoomAndRemoveFavorite(t){"leaveRoom"===this.settingKey&&(t&&t.isFavorite&&ht(t.room,t.user,!1).then(t.isFavorite=!1),this.$root.$emit("refresh-contacts",!1)),this.showConfirmModal=!1},checkMeetingStatus(){Ct(eXo.chat.userSettings,this.contact.room).then((t=>{this.meetingStarted=t.meetingStarted}))},startMeeting(){const t=this.contact.room,e=(new Date).getTime().toString();Rt(eXo.chat.userSettings,t,!0,e),this.sendMeetingMessage(!0)},stopMeeting(){const t=this.contact.room;let e="";Ct(eXo.chat.userSettings,this.contact.room).then((t=>{e=t.startTime})),this.sendMeetingMessage(!1,e),Rt(eXo.chat.userSettings,t,!1,"")},sendMeetingMessage(t,e){const s=t?"type-meeting-start":"type-meeting-stop",o={message:this.newMessage,room:this.contact.room,clientId:(new Date).getTime().toString(),timestamp:Date.now(),user:eXo.chat.userSettings.username,isSystem:!0,options:{type:s,fromUser:eXo.chat.userSettings.username,fromFullname:eXo.chat.userSettings.fullName,fromTimestamp:e}};document.dispatchEvent(new CustomEvent(a.ACTION_MESSAGE_SEND,{detail:o}))},displayItem(t){return(!t.enabled||t.enabled(this))&&(!t.type||t.type===this.contact.type)},unescapeHTML:t=>unescape(t),escapeHTML:t=>Ut(t),participantsLoaded(){this.nbMembers=this.contact&&this.contact.participantsCount&&"u"!==this.contact.type?this.contact.participantsCount:0},backToContactList(){document.dispatchEvent(new CustomEvent(a.EVENT_ROOM_SELECTION_CHANGED,{detail:{}})),this.$emit("back-to-contact-list")},initRoomActionComponents(){for(const t of this.roomActionComponents)if(t.init&&t.enabled){let e=this.$refs[t.key];e&&e.length>0&&(e=e[0]),t.init(e,eXo.chat)}}}},ee,[],!1,null,null,null).exports;var oe=function(){var t=this,e=t._self._c;return e("div",{staticClass:"uiRightContainerArea message-list",attrs:{id:"message-scroll"}},[t.contact&&0!==Object.keys(t.contact).length?e("div",{ref:"messagesListContainer",staticClass:"chat-message-list",class:{"chat-no-conversation muted":!(t.messages&&t.messages.length||t.newMessagesLoading)},attrs:{id:"chats"},on:{wheel:function(e){t.loadMoreMessages(),t.checkResetUnreadMessage()},scroll:function(e){t.loadMoreMessages(),t.checkResetUnreadMessage()}}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.newMessagesLoading,expression:"newMessagesLoading"}],staticClass:"center"},[e("img",{staticClass:"chatLoading",attrs:{src:"/chat/img/sync.gif",width:"64px"}})]),t._v(" "),t._l(t.messagesMap,(function(s,o){return e("div",{key:o,staticClass:"chat-message-day"},[e("div",{staticClass:"day-separator"},[e("span",[t._v(t._s(o))])]),t._v(" "),t._l(s,(function(s){return e("exo-chat-message-detail",{key:s,attrs:{highlight:t.searchKeyword,room:t.contact.room,"room-fullname":t.contact.fullName,message:s,"hide-time":s.hideTime,"hide-avatar":s.hideAvatar,"mini-chat":t.miniChat,"download-document-enabled":t.downloadDocumentEnabled},on:{"edit-message":t.editMessage}})}))],2)})),t._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:!(t.newMessagesLoading||t.messages&&t.messages.length),expression:"!newMessagesLoading && (!messages || !messages.length)"}],staticClass:"text"},[t._v(t._s(t.$t("exoplatform.chat.no.messages")))])],2):t._e(),t._v(" "),e("exo-chat-message-composer",{attrs:{"composers-applications":t.composerApplications,contact:t.contact,"mini-chat":t.miniChat,"user-settings":t.userSettings},on:{"message-written":t.messageWritten}}),t._v(" "),t.miniChat?t._e():e("exo-chat-modal",{directives:[{name:"show",rawName:"v-show",value:t.showEditMessageModal,expression:"showEditMessageModal"}],attrs:{title:t.$t("exoplatform.chat.msg.edit"),"modal-class":"edit-message-modal"},on:{"modal-closed":t.closeModal}},[t.showEditMessageModal?e("exo-content-editable",{ref:"editMessageComposerArea",attrs:{id:"editMessageComposerArea",name:"editMessageComposerArea",autofocus:""},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.preventDefault.apply(null,arguments)},keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.preventDefault.apply(null,arguments)},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.saveEditMessage.apply(null,arguments)}},model:{value:t.messageToEdit.msg,callback:function(e){t.$set(t.messageToEdit,"msg",e)},expression:"messageToEdit.msg"}}):t._e(),t._v(" "),e("div",{staticClass:"uiAction uiActionBorder"},[e("div",{staticClass:"btn btn-primary",on:{click:function(e){return t.saveEditMessage(!1)}}},[t._v(t._s(t.$t("exoplatform.chat.save")))]),t._v(" "),e("div",{staticClass:"btn",on:{click:t.closeModal}},[t._v(t._s(t.$t("exoplatform.chat.cancel")))])])],1)],1)};oe._withStripped=!0;const ae=Xt({props:{composersApplications:{type:Object,default:function(){return{}}},miniChat:{type:Boolean,default:!1},isOpenedContact:{type:Boolean,default:!1},isOpenedContactApps:{type:Boolean,default:!1},minimized:{type:Boolean,default:!1},userSettings:{type:Object,default:function(){return{}}}},data:()=>({messages:[],scrollToBottom:!0,contact:{},messageToEdit:{},showEditMessageModal:!1,totalMessagesToLoad:0,searchKeyword:"",windowFocused:!0,newMessagesLoading:!1,downloadDocumentEnabled:!1,composerApplications:[]}),mounted(){this.composerApplications=this.composersApplications},computed:{messagesMap(){const t={};let e=null;return this.messages.forEach((s=>{const o=zt(s.timestamp);t[o]||(t[o]=[]),s.hideTime=this.isHideTime(e,s),s.hideAvatar=this.isHideAvatar(e,s),t[o].push(s),e=s})),t},hasMoreMessages(){return this.totalMessagesToLoad<=this.messages.length}},updated(){this.scrollToEnd(),this.composerApplications=this.composersApplications},created(){document.addEventListener(a.EVENT_MESSAGE_UPDATED,this.messageReceived),document.addEventListener(a.EVENT_MESSAGE_DELETED,this.messageDeleted),document.addEventListener(a.EVENT_MESSAGE_RECEIVED,this.messageReceived),document.addEventListener(a.EVENT_MESSAGE_READ,this.messageSent),document.addEventListener(a.EVENT_ROOM_SELECTION_CHANGED,this.contactChanged),document.addEventListener(a.ACTION_MESSAGE_EDIT_LAST,this.editLastMessage),document.addEventListener(a.ACTION_MESSAGE_SEARCH,this.searchMessage),$(window).focus(this.chatFocused),$(window).blur(this.chatFocused),this.$transferRulesService?.getTransfertRulesDownloadDocumentStatus().then((t=>{this.downloadDocumentEnabled=t}))},destroyed(){document.removeEventListener(a.EVENT_MESSAGE_UPDATED,this.messageReceived),document.removeEventListener(a.EVENT_MESSAGE_DELETED,this.messageDeleted),document.removeEventListener(a.EVENT_MESSAGE_RECEIVED,this.messageReceived),document.removeEventListener(a.EVENT_MESSAGE_READ,this.messageSent),document.removeEventListener(a.EVENT_ROOM_SELECTION_CHANGED,this.contactChanged),document.removeEventListener(a.ACTION_MESSAGE_EDIT_LAST,this.editLastMessage),document.removeEventListener(a.ACTION_MESSAGE_SEARCH,this.searchMessage)},methods:{messageWritten(t){!function(t){if(!t)return;const e=t.sender?t.sender:t.data&&t.data.sender?t.data.sender:t.user?t.user:t.data?t.data.user:null,s=t.clientId?t.clientId:t.data?t.data.clientId:null,o=t.room?t.room:t.data?t.data.room:null;if(e!==eXo.chat.userSettings.username||!o||!s)return;const i=O(e);i&&i[s]||(t.notSent=!0,i[s]=t,N(`${a.STORED_PARAM_PENDING_MESSAGES}-${e}`,JSON.stringify(i)))}(t),this.addOrUpdateMessageToList(t),this.setScrollToBottom(),document.dispatchEvent(new CustomEvent(a.ACTION_MESSAGE_SEND,{detail:t}))},messageModified(t){this.addOrUpdateMessageToList(t),this.setScrollToBottom(),t.room=this.contact.room,document.dispatchEvent(new CustomEvent(a.ACTION_MESSAGE_SEND,{detail:t}))},messageReceived(t){const e=t.detail,s=e.data;this.unifyMessageFormat(e,s),this.addOrUpdateMessageToList(s)},messageSent(t){const e=t.detail.data;e&&(this.setScrollToBottom(),this.addOrUpdateMessageToList(e))},chatFocused(t){this.windowFocused="focus"===t.type},contactChanged(t){this.messages=[],this.totalMessagesToLoad=0,this.newMessagesLoading=!1,this.contact=t.detail,this.contact&&(this.contact.room?this.retrieveRoomMessages():this.contact.user&&_t(this.userSettings,this.contact.user,"username").then((t=>{t&&(this.contact.room=t,this.retrieveRoomMessages())})))},setScrollToBottom:function(){this.scrollToBottom=!0},scrollToEnd:function(t){if(t||this.scrollToBottom){const e=$(this.$refs.messagesListContainer);e.scrollTop(e.prop("scrollHeight")),t||(this.scrollToBottom=!1)}},isScrollPositionAtEnd(){const t=$(this.$refs.messagesListContainer);return!(!t||!t.length)&&t[0].scrollHeight-t.scrollTop()-t.height()<a.MAX_SCROLL_POSITION_FOR_AUTOMATIC_SCROLL},loadMoreMessages(){this.newMessagesLoading||$(this.$refs.messagesListContainer).scrollTop()>0||!this.hasMoreMessages||this.retrieveRoomMessages(!0)},retrieveRoomMessages(t){if(!this.contact||!this.contact.room||!this.contact.room.trim().length)return void(this.messages=[]);if(this.newMessagesLoading)return;let e;this.messages&&this.messages.length?e=this.messages[0].timestamp:(e="",this.totalMessagesToLoad=0);const s=a.MESSAGES_PER_PAGE;return this.newMessagesLoading=!0,St(this.userSettings,this.contact,e,s).then((e=>{if(this.contact.room===e.room){document.dispatchEvent(new CustomEvent(a.ACTION_ROOM_SET_READ,{detail:this.contact.room})),this.scrollToBottom=!t;const o=function(t,e){const s=[];if(e&&t){const o=function(t){const e=O(t);if(e){const t=Object.keys(e),s=[];return t.length>1&&(t.forEach((t=>s.push(e[t]))),s.sort(((t,e)=>t.timestamp-e.timestamp))),s}return[]}(t);o&&o.length&&o.forEach((t=>{t&&t.room===e&&s.push(t)}))}return s}(this.userSettings.username,this.contact.room),i=new RegExp("^/rest/");e.messages.concat(o).forEach((t=>{this.messages.find((e=>e.msgId&&e.msgId===t.msgId||e.clientId&&e.clientId===t.clientId))||(t.options&&t.options.type&&t.options.type===a.FILE_MESSAGE&&(t.options.restPath=t.options.restPath.replace(i,"/portal/rest/"),t.options.thumbnailUrl=t.options.thumbnailUrl.replace(i,"/portal/rest/"),t.options.thumbnailURL=t.options.thumbnailURL.replace(i,"/portal/rest/"),t.options.downloadLink=t.options.downloadLink.replace(i,"/portal/rest/")),this.messages.unshift(t))})),this.messages.sort(((t,e)=>t.timestamp-e.timestamp)),this.totalMessagesToLoad+=s}this.newMessagesLoading=!1})).catch((t=>{this.newMessagesLoading=!1,console.error(t)}))},findMessage(t,e){return this.messages.find((s=>s[t]===e))},getPrevMessage:(t,e)=>t<=0&&e.length>=t?null:e[t-1],isHideTime(t,e){return null!==t&&"mobile"!==this.mq&&(!e.timestamp||(s=t.timestamp,o=e.timestamp,Wt(s).getTime()===Wt(o).getTime()));var s,o},isHideAvatar:(t,e)=>null!==t&&t.user===e.user&&t.timestamp&&e.timestamp&&Jt(t.timestamp,e.timestamp),addOrUpdateMessageToList(t){if(!t||!t.room||!this.contact.room||t.room!==this.contact.room||!t.clientId&&!t.msgId)return;this.ap||this.isOpenedContact||H(this.contact.room),this.ap&&!this.isOpenedContactApps&&H(this.contact.room),this.isScrollPositionAtEnd()&&this.setScrollToBottom();const e=this.messages.findIndex((e=>e.clientId&&e.clientId===t.clientId||e.msgId&&e.msgId===t.msgId));e>-1?(t.fullname||(t.fullname=this.messages[e].fullname),this.messages[e].notSent?(this.messages.splice(e,1),this.messages.push(t)):this.messages.splice(e,1,t)):this.messages.push(t)},messageDeleted(t){const e=t.detail,s=e.data;if(s.notSent){const t=this.messages.findIndex((t=>t.clientId===s.clientId&&!t.msgId));t>0&&this.messages.splice(t,1)}else this.unifyMessageFormat(e,s),this.addOrUpdateMessageToList(s)},unifyMessageFormat(t,e){!e.room&&t.room&&(e.room=t.room),e.user||!t.user&&!t.sender||(e.user=t.user?t.user:t.sender)},editLastMessage(){if(!this.messages||!this.messages.length)return;let t=null,e=this.messages.length-1;for(;!t&&e>=0;){const s=this.messages[e];!s||s.isDeleted||s.type===a.DELETED_MESSAGE||s.isSystem||s.user!==this.userSettings.username||(t=s),e--}t&&this.editMessage(t)},editMessage(t){this.messageToEdit=JSON.parse(JSON.stringify(t)),this.messageToEdit.msg=this.messageToEdit.msg||this.messageToEdit.message||"",this.messageToEdit.msg=this.messageToEdit.msg.replace(/&#92/g,"\\").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/<br( *)\/?>/g,"\n").replace(/&#38/g,"&"),this.showEditMessageModal=!0,this.$nextTick((()=>{this.$refs.editMessageComposerArea&&(document.execCommand("selectAll",!1,null),document.getSelection().collapseToEnd())}))},saveEditMessage(t){if(!t||t.keyCode===a.ENTER_CODE_KEY)if(t&&(t.ctrlKey||t.altKey||t.shiftKey)){const t=$(this.$refs.editMessageComposerArea);t.insertAtCaret("\n"),this.messageToEdit.msg=t.val()}else this.messageToEdit.msg=this.messageToEdit.msg.trim(),this.messageToEdit.msg=this.messageToEdit.msg.replace(/^(\s+<br( \/)?>)*|(<br( \/)?>\s)*$/gm,""),this.messageModified(this.messageToEdit),this.showEditMessageModal=!1},closeModal(){this.showEditMessageModal=!1},searchMessage(t){this.searchKeyword=t.detail.trim()},preventDefault(t){t.keyCode===a.ENTER_CODE_KEY&&(t.stopPropagation(),t.preventDefault())},checkResetUnreadMessage(){this.isScrollPositionAtEnd()&&(this.contact.unreadTotal=0)}}},oe,[],!1,null,null,null).exports;var ie=function(){var t=this,e=t._self._c;return e("div",{ref:"message",staticClass:"chat-message-box",class:{"chat-message-not-sent":t.message.notSent,"is-same-contact":t.hideAvatar,"is-current-user":t.isCurrentUser},attrs:{id:t.messageId}},[e("div",{staticClass:"chat-sender-avatar"},[!t.displayUserInformation||t.message.isEnabledUser&&"true"!==t.message.isEnabledUser?t.displayUserInformation?e("div",{staticClass:"chat-contact-avatar",style:`backgroundImage: url(${t.avatarUrl}`}):t._e():e("a",{staticClass:"chat-contact-avatar",style:`backgroundImage: url(${t.avatarUrl}`,attrs:{href:t.getProfileLink(t.message.user)}})]),t._v(" "),e("div",{directives:[{name:"hold-tap",rawName:"v-hold-tap",value:t.openMessageActions,expression:"openMessageActions"}],staticClass:"chat-message-bubble"},[!t.displayUserInformation||t.message.isEnabledUser&&"true"!==t.message.isEnabledUser?t.displayUserInformation?e("div",{staticClass:"sender-name",class:t.statusStyle},[t._v("\n      "+t._s(t.attendeeFullname)+" "+t._s(t.disabledStatus)+":\n    ")]):t._e():e("div",{staticClass:"sender-name"},[e("a",{attrs:{href:t.getProfileLink(t.message.user)}},[t._v(t._s(t.attendeeFullname))]),t._v(" :")]),t._v(" "),t.messageType===t.chatConstants.DELETED_MESSAGE?e("div",{staticClass:"message-content"},[e("em",{staticClass:"muted"},[t._v(t._s(t.$t("exoplatform.chat.deleted")))])]):t.messageOptionsType===t.chatConstants.FILE_MESSAGE?e("div",{staticClass:"message-content"},[e("b",[e("a",{attrs:{href:t.message.options.restPath,target:"_blank"}},[t._v(t._s(t.message.options.title))])]),t._v(" "),e("span",{staticClass:"message-file-size"},[t._v(t._s(t.message.options.sizeLabel))]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.message.options.thumbnailURL,expression:"message.options.thumbnailURL"}],staticClass:"attachmentContainer",attrs:{id:`${t.messageId}-attachmentContainer`}},[e("div",{staticClass:"attachmentContentImage"},[e("div",{staticClass:"imageAttachmentBox"},[e("a",{staticClass:"imgAttach"},[e("img",{attrs:{src:t.message.options.thumbnailURL,alt:t.message.options.title},on:{error:t.deleteThumbnail}})]),t._v(" "),e("div",{staticClass:"actionAttachImg"},[e("p",[e("a",{attrs:{href:t.message.options.restPath,target:"_blank"}},[e("i",{staticClass:"uiIconSearch uiIconWhite"})])]),t._v(" "),t.downloadDocumentEnabled?e("p",[e("a",{attrs:{href:t.message.options.downloadLink,target:"_blank"}},[e("i",{staticClass:"uiIconDownload uiIconWhite"})])]):t._e()])])])])]):t.message.isSystem?t.messageOptionsType===t.chatConstants.ADD_TEAM_MESSAGE?e("div",{staticClass:"message-content"},[e("span",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:t.$t("exoplatform.chat.team.msg.adduser",t.roomAddOrDeleteI18NParams),expression:"$t('exoplatform.chat.team.msg.adduser', roomAddOrDeleteI18NParams)"}]})]):t.messageOptionsType===t.chatConstants.ROOM_MEMBER_LEFT?e("div",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:t.unescapeHTML(t.$t("exoplatform.chat.team.msg.leaveroom",{0:"<b>"+t.message.options.fullName+"</b>"})),expression:"unescapeHTML($t('exoplatform.chat.team.msg.leaveroom', {0: '<b>' + message.options.fullName + '</b>'}))"}],staticClass:"message-content"}):t.messageOptionsType===t.chatConstants.REMOVE_TEAM_MESSAGE?e("div",{staticClass:"message-content"},[e("span",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:t.$t("exoplatform.chat.team.msg.removeuser",t.roomAddOrDeleteI18NParams),expression:"$t('exoplatform.chat.team.msg.removeuser', roomAddOrDeleteI18NParams)"}]})]):t.messageOptionsType===t.chatConstants.EVENT_MESSAGE?e("div",{staticClass:"message-content"},[e("b",[t._v(t._s(t.message.options.summary))]),t._v(" "),e("div",{staticClass:"custom-message-item"},[e("i",{staticClass:"uiIconChatClock"}),t._v(" "),e("span",[t._v(t._s(t.$t("exoplatform.chat.from"))+" ")]),t._v(" "),e("b",[t._v(t._s(t.message.options.startDate)+" "+t._s(t.message.options.startAllDay?this.$t("exoplatform.chat.all.day"):t.message.options.startTime))]),t._v(" "),e("span",[t._v(" "+t._s(t.$t("exoplatform.chat.to"))+" ")]),t._v(" "),e("b",[t._v(t._s(t.message.options.endDate)+" "+t._s(t.message.options.endAllDay?this.$t("exoplatform.chat.all.day"):t.message.options.endTime))])]),t._v(" "),t.message.options.location?e("div",{staticClass:"custom-message-item"},[e("i",{staticClass:"uiIconChatCheckin"}),t._v("\n        "+t._s(t.message.options.location)+"\n      ")]):t._e()]):t.messageOptionsType===t.chatConstants.LINK_MESSAGE?e("div",{directives:[{name:"autolinker",rawName:"v-autolinker",value:t.message.options.link,expression:"message.options.link"}],staticClass:"message-content"}):t.messageOptionsType===t.chatConstants.RAISE_HAND||t.messageOptionsType===t.chatConstants.QUESTION_MESSAGE?e("div",{staticClass:"message-content"},[e("b",[t._v(t._s(t.messageContent))])]):t.isSpecificMessageType?e("div",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:t.specificMessageContent,expression:"specificMessageContent"}],staticClass:"message-content"}):t._e():e("div",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:t.messageFiltered,expression:"messageFiltered"}],staticClass:"message-content"}),t._v(" "),e("div",{staticClass:"message-description"},[t.isEditedMessage?e("i",{staticClass:"uiIconChatEdit"}):t.message.options&&t.messageOptionsType===t.chatConstants.RAISE_HAND?e("i",{staticClass:"uiIconChatRaiseHand"}):t.message.options&&t.messageOptionsType===t.chatConstants.QUESTION_MESSAGE?e("i",{staticClass:"uiIconChatQuestion"}):t.message.options&&t.messageOptionsType===t.chatConstants.LINK_MESSAGE?e("i",{staticClass:"uiIconChatLink"}):t.message.options&&t.messageOptionsType===t.chatConstants.FILE_MESSAGE?e("i",{staticClass:"uiIconChatUpload"}):t.message.options&&t.messageOptionsType===t.chatConstants.EVENT_MESSAGE?e("i",{staticClass:"uiIconChatCreateEvent"}):!t.message.options||t.messageOptionsType!==t.chatConstants.MEETING_START_MESSAGE&&t.messageOptionsType!==t.chatConstants.MEETING_STOP_MESSAGE&&t.messageOptionsType!==t.chatConstants.NOTES_MESSAGE?t.isSpecificMessageType&&t.specificMessageClass?e("i",{class:t.specificMessageClass}):t._e():e("i",{staticClass:"uiIconChatMeeting"}),t._v(" "),e("i",{staticClass:"uiIcon16x16 primary--text clickable mdi mdi-refresh",class:!t.message.notSent&&"hidden",on:{click:function(e){return t.sendFailedMessage()}}}),t._v(" "),e("i",{staticClass:"uiIcon16x16 delete-message-icon clickable mdi mdi-delete",class:!t.message.notSent&&"hidden",on:{click:function(e){return t.deleteFailedMessage()}}})])]),t._v(" "),e("div",{staticClass:"chat-message-action"},[t.displayActions&&"mobile"!==t.mq?e("exo-dropdown-select",{staticClass:"message-actions",attrs:{position:"right"}},[e("i",{staticClass:"uiIconDots",attrs:{slot:"toggle"},on:{click:t.setActionsPosition},slot:"toggle"}),t._v(" "),e("li",{attrs:{slot:"menu"},slot:"menu"},t._l(t.messageActions,(function(s){return e("a",{key:t.message.msgId+s.key,staticClass:"actions-link",class:s.class,attrs:{id:t.message.msgId+s.key,href:"#"},on:{click:function(e){return t.executeAction(s)}}},[t._v("\n          "+t._s(t.$t(s.labelKey))+"\n        ")])})),0)]):t.displayActions?e("div",{directives:[{name:"show",rawName:"v-show",value:t.displayActionMobile,expression:"displayActionMobile"}],staticClass:"uiPopupWrapper chat-modal-mask",on:{click:function(e){t.displayActionMobile=!1}}},[e("ul",{staticClass:"mobile-options filter-options"},t._l(t.messageActions,(function(s){return e("li",{key:s.key},[e("a",{class:s.class,attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.executeAction(s)}}},[t._v("\n            "+t._s(t.$t(s.labelKey))+"\n          ")])])})),0)]):e("i",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.top",value:t.$t("exoplatform.chat.msg.notDelivered"),expression:"$t('exoplatform.chat.msg.notDelivered')",modifiers:{top:!0}}],staticClass:"uiIconNotification"}),t._v(" "),t.hideTime?t._e():e("div",{staticClass:"message-time"},[t._v(t._s(t.dateString))])],1),t._v(" "),e("exo-chat-modal",{directives:[{name:"show",rawName:"v-show",value:t.showConfirmModal,expression:"showConfirmModal"}],attrs:{title:t.$t(t.confirmTitle)},on:{"modal-closed":function(e){t.showConfirmModal=!1}}},[e("div",{staticClass:"modal-body"},[e("p",[e("span",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:t.unescapeHTML(t.$t(t.confirmMessage)),expression:"unescapeHTML($t(confirmMessage))"}],staticClass:"confirmationIcon",attrs:{id:"team-delete-window-chat-name"}})])]),t._v(" "),e("div",{staticClass:"uiAction uiActionBorder"},[e("a",{staticClass:"btn btn-primary",attrs:{id:"team-delete-button-ok",href:"#"},on:{click:function(e){t.confirmAction(t.message),t.showConfirmModal=!1}}},[t._v(t._s(t.$t(t.confirmOKMessage)))]),t._v(" "),e("a",{staticClass:"btn",attrs:{id:"team-delete-button-cancel",href:"#"},on:{click:function(e){t.showConfirmModal=!1}}},[t._v(t._s(t.$t(t.confirmKOMessage)))])])])],1)};function ne(t,e,s){if(!t||!t.trim().length)return t;let o="";const a=t.split(/<br\s*\/?>/);return a.forEach(((t,i)=>{(t=$("<div />").html(t).text()).split(/\s|&nbsp;/g).forEach((t=>{if(0===t.indexOf("http:")||0===t.indexOf("https:")||0===t.indexOf("ftp:"))try{const e=new URL(t);e&&(t=t.endsWith(".jpg")||t.endsWith(".png")||t.endsWith(".gif")||t.endsWith(".JPG")||t.endsWith(".PNG")||t.endsWith(".GIF")?e.host!==window.location.host?`<a href="${t}" target='_blank'><img src="${t}" alt="${t}"/></a>`:`<a href="${t}"><img src="${t}" alt="${t}"/></a>`:e.host!==window.location.host?`<a href="${t}" target='_blank'>${t}</a>`:`<a href="${t}">${t}</a>`)}catch(t){console.error(t)}else if(""!==e&&t.indexOf(e)>=0)t=t.replace(e,`<span class="search-highlight">${e}</span>`);else{const e=t.replace(/\.|\?|!/,""),o=e.toLowerCase(),a=s.find((t=>t.keys.indexOf(o)>=0));a&&(t=t.replace(e,`<span class="chat-emoticon ${a.class}"><span>${e}</span></span>`))}o+=`${t} `})),i!==a.length-1&&(o+="<br>")})),o.indexOf("[quote=")>-1&&(o=le(o)),o}ie._withStripped=!0;const re="[quote=",ce="[/quote]";function le(t){let e=t.slice(t.lastIndexOf(re));return e=e.slice(0,e.indexOf(ce)+ce.length),t=t.replace(e,function(t){return`<blockquote><span class="quote-user-name">${t.slice(re.length,t.indexOf("]"))}:</span>${t.slice(t.indexOf("]")+1,t.indexOf(ce)).trim()}</blockquote>`}(e)),t.indexOf("[quote=")>-1&&(t=le(t)),t}const de=Xt({props:{miniChat:{type:Boolean,default:!1},message:{type:Object,default:function(){return{fullname:null,isSystem:!1,msg:null,msgId:null,options:null,timestamp:0,type:null,user:null,isEnabledUser:null}}},room:{type:String,default:""},roomFullname:{type:String,default:""},hideAvatar:{type:Boolean,default:!1},highlight:{type:String,default:""},hideTime:{type:Boolean,default:!1},downloadDocumentEnabled:{type:Boolean,default:!1}},data:function(){return{chatConstants:a,showConfirmModal:!1,displayActionMobile:!1,external:this.$t("exoplatform.chat.external"),confirmTitle:"",confirmMessage:"",confirmOKMessage:"",confirmKOMessage:"",confirmAction(){}}},computed:{isCurrentUser(){return eXo.chat.userSettings.username===this.message.user},messageType(){return this.message&&this.message.type},attendeeFullname(){return this.message&&"true"===this.message.isExternal?`${this.message.fullname} (${this.external})`:this.message.fullname},messageOptionsType(){return this.message&&this.message.options&&this.message.options.type},messageActions(){return C.filter((t=>!t.enabled||t.enabled(this)))},displayUserInformation(){return this.messageOptionsType!==a.ROOM_MEMBER_LEFT&&this.messageOptionsType!==a.REMOVE_TEAM_MESSAGE&&this.messageOptionsType!==a.ADD_TEAM_MESSAGE&&!this.hideAvatar&&!this.isCurrentUser},displayActions(){return!this.miniChat&&this.messageType!==a.DELETED_MESSAGE&&this.messageActions&&this.messageActions.length},messageId(){return this.message.clientId?this.message.clientId:this.message.msgId},dateString(){return Qt(this.message.timestamp)},isEditedMessage(){return this.messageType===a.EDITED_MESSAGE},roomAddOrDeleteI18NParams(){return{0:`<b>${this.message.options.fullname}</b>`,1:`<b>${this.message.options.users}</b>`}},messageContent(){return this.message.message?this.message.message:this.message.msg},messageFiltered(){return ne(this.messageContent,this.highlight,m)},isSpecificMessageType(){return this.specificMessageObj},specificMessageObj(){return this.messageOptionsType&&f&&f.find((t=>t.type===this.messageOptionsType))},specificMessageContent(){return this.specificMessageObj&&this.specificMessageObj.html?this.specificMessageObj.html(this.message,this.$t.bind(this)):""},specificMessageClass(){return this.specificMessageObj?this.specificMessageObj.iconClass:""},statusStyle:function(){return"false"!==this.message.isEnabledUser||this.isCurrentUser?"":"user-disabled"},disabledStatus(){return"false"===this.message.isEnabledUser?"(".concat("",this.$t("exoplatform.chat.inactive")).concat(")"):""},avatarUrl(){return J(this.message.user)}},created(){document.addEventListener(a.ACTION_MESSAGE_EDIT,this.editMessage),document.addEventListener("exo-chat-message-action-delete-requested",this.deleteMessage)},destroyed(){document.removeEventListener(a.ACTION_MESSAGE_EDIT,this.editMessage),document.removeEventListener("exo-chat-message-action-delete-requested",this.deleteMessage)},methods:{deleteThumbnail(){$(`#${this.messageId}-attachmentContainer`).remove()},executeAction(t){t.confirm?(this.confirmTitle=t.confirm.title,this.confirmMessage=t.confirm.message,this.confirmOKMessage=t.confirm.okMessage,this.confirmKOMessage=t.confirm.koMessage,this.confirmAction=e=>document.dispatchEvent(new CustomEvent(`exo-chat-message-action-${t.key}-requested`,{detail:e})),this.showConfirmModal=!0):document.dispatchEvent(new CustomEvent(`exo-chat-message-action-${t.key}-requested`,{detail:this.message}))},editMessage(t){t&&t.detail&&t.detail.msgId&&t.detail.msgId===this.message.msgId&&this.$emit("edit-message",this.message)},deleteMessage(t){t&&t.detail&&t.detail.msgId&&t.detail.msgId===this.message.msgId&&document.dispatchEvent(new CustomEvent(a.ACTION_MESSAGE_DELETE,{detail:{room:this.room,msgId:this.message.msgId}}))},unescapeHTML:t=>unescape(t),setActionsPosition(){const t=$(this.$refs.message),e=t.find(".dropdown"),s=t.find(".dropdown-menu"),o=$(".room-detail").outerHeight();t.offset().top+s.outerHeight()+20>$("#chats").outerHeight()+o?e.addClass("top"):e.removeClass("top")},openMessageActions(){this.displayActionMobile=!0},getProfileLink:t=>$t(t),sendFailedMessage(){document.dispatchEvent(new CustomEvent(a.RESEND_FAILED_MESSAGE,{detail:{user:eXo.chat.userSettings.username,message:this.message}}))},deleteFailedMessage(){document.dispatchEvent(new CustomEvent(a.DELETE_FAILED_MESSAGE,{detail:{user:eXo.chat.userSettings.username,clientId:this.message.clientId}}))}}},ie,[],!1,null,null,null).exports;var me=function(){var t=this,e=t._self._c;return!t.contact||0===Object.keys(t.contact).length||"true"!==t.contact.isEnabledUser&&"true"!==t.contact.isEnabledRoom?t._e():e("div",{staticClass:"chat-message-composer",class:{"is-apps-closed":t.appsClosed}},[t.miniChat?t._e():e("div",[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.appsClosed,expression:"!appsClosed"}],staticClass:"apps-container justify-center"},t._l(t.composerApplications,(function(s){return e("div",{key:s.key,staticClass:"apps-item",on:{click:function(e){return t.openAppModal(s)}}},[e("div",{staticClass:"apps-item-icon"},[e("i",{class:s.iconClass})]),t._v(" "),"desktop"===t.mq?e("div",{staticClass:"apps-item-label"},[t._v(t._s(t.$t(s.labelKey)))]):t._e()])})),0)]),t._v(" "),e("div",{staticClass:"composer-container"},[e("div",{staticClass:"composer-box"},[t.miniChat?t._e():e("div",{staticClass:"composer-action"},[e("div",{staticClass:"action-emoji"},[e("i",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.top",value:t.$t("exoplatform.chat.emoji.tip"),expression:"$t('exoplatform.chat.emoji.tip')",modifiers:{top:!0}}],staticClass:"uiIconChatSmile",on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.showEmojiPanel=!t.showEmojiPanel}}}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showEmojiPanel,expression:"showEmojiPanel"}],staticClass:"composer-emoji-panel popover top"},[e("div",{staticClass:"arrow"}),t._v(" "),t._l(t.getEmoticons,(function(s){return e("span",{key:s.keys[0],staticClass:"chat-emoticon",class:s.class,on:{click:function(e){return t.selectEmoji(s)}}})}))],2)]),t._v(" "),e("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.top",value:t.$t("exoplatform.chat.collaborative.actions.tip"),expression:"$t('exoplatform.chat.collaborative.actions.tip')",modifiers:{top:!0}}],staticClass:"action-apps",on:{click:function(e){t.appsClosed=!t.appsClosed}}},[e("i",{staticClass:"uiIconPlusCircled"})])]),t._v(" "),t.miniChat?e("input",{ref:"messageComposerArea",attrs:{id:"messageComposerArea",name:"messageComposerArea",type:"text",autofocus:""},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.preventDefault.apply(null,arguments)},keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.preventDefault.apply(null,arguments)},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessageWithKey.apply(null,arguments)}}}):e("div",{ref:"messageComposerArea",attrs:{id:"messageComposerArea",contenteditable:"true",name:"messageComposerArea"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.preventDefault.apply(null,arguments)},keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.preventDefault.apply(null,arguments)},keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessageWithKey.apply(null,arguments)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?null:t.editLastMessage.apply(null,arguments)},function(e){return t.resizeTextarea(e)}],paste:t.paste}}),t._v(" "),t.miniChat?t._e():e("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.top",value:t.$t("exoplatform.chat.send"),expression:"$t('exoplatform.chat.send')",modifiers:{top:!0}}],staticClass:"composer-action"},[e("div",{staticClass:"action-send",on:{click:t.sendMessage}},[e("i",{staticClass:"uiIconSend"})])])])]),t._v(" "),t.appsModal.isOpned?e("exo-chat-apps-modal",{attrs:{app:t.appsModal.app,title:t.appsModal.title,contact:t.contact,"room-id":t.contact.room},on:{"modal-closed":function(e){t.appsModal.isOpned=!1}}}):t._e()],1)};me._withStripped=!0;const he=Xt({props:{composersApplications:{type:Object,default:function(){return{}}},miniChat:{type:Boolean,default:!1},contact:{type:Object,default:function(){return{}}},userSettings:{type:Object,default:function(){return{}}}},data:()=>({appsModal:{title:"",isOpned:!1},appsClosed:!0,composerApplications:[],showEmojiPanel:!1,participants:[],mentionedUsers:[],userAvatar:""}),computed:{getEmoticons:()=>eXo&&eXo.chat&&eXo.chat.room&&eXo.chat.room.extraEmoticons?m.concat(eXo.chat.room.extraEmoticons):m||[]},watch:{userSettings(){this.composerApplications=this.composersApplications}},updated(){this.composerApplications=this.composersApplications,this.contact&&("true"!==this.contact.isEnabledUser&&"null"!==this.contact.isEnabledUser||this.$nextTick((()=>{this.$refs.messageComposerArea.focus(),this.composerApplications.forEach((t=>{t.mount&&t.mount($,o)})),this.initSuggester()})))},created(){document.addEventListener("keyup",this.closeApps),document.addEventListener("click",this.closeEmojiPanel),document.addEventListener(a.ACTION_MESSAGE_SEND,this.putFocusOnComposer),document.addEventListener(a.ACTION_MESSAGE_DELETE,this.putFocusOnComposer),document.addEventListener(a.ACTION_MESSAGE_QUOTE,this.quoteMessage)},destroyed(){document.removeEventListener("keyup",this.closeApps),document.removeEventListener("click",this.closeEmojiPanel),document.removeEventListener(a.ACTION_MESSAGE_SEND,this.putFocusOnComposer),document.removeEventListener(a.ACTION_MESSAGE_DELETE,this.putFocusOnComposer),document.removeEventListener(a.ACTION_MESSAGE_QUOTE,this.quoteMessage)},methods:{initSuggester(){const t=$("#messageComposerArea"),e=this,s={type:"mix",create:!1,createOnBlur:!1,highlight:!1,openOnFocus:!1,sourceProviders:["exo:chatuser"],valueField:"name",labelField:"fullname",searchField:["fullname","name"],closeAfterSelect:!0,dropdownParent:"body",hideSelected:!0,renderMenuItem:function(t){return`<img src="${J(t.name)}" onerror="this.src='/chat/img/room-default.jpg'" width="20px" height="20px">\n                      ${Ut(t.fullname)}<span style="float: right" class="chat-status-task chat-status-'+item.status+'"></span>`},renderItem:'<div class="uiMention">@${fullname}      <span class="remove"><i class="uiIconClose"></i></span>      </div>',providers:{"exo:chatuser":function(t,s){if(!t||!t.trim().length)return s();vt(eXo.chat.userSettings,e.contact,t).then((function(t){t&&t.users&&bt(t.users).then((t=>{for(let s=0;s<t.length;s++)-1===e.participants.findIndex((e=>e.name===t[s].name))&&e.participants.push(t[s]);s(t.filter((t=>t.name!==eXo.chat.userSettings.username)))}))}))}}};t.suggester(s)},closeApps(t){27===t.keyCode&&(this.appsClosed=!0)},closeEmojiPanel(){this.showEmojiPanel=!1},selectEmoji(t){let e=t.keys[0];e=` ${e} `,$(this.$refs.messageComposerArea).insertAtCaret(e),this.closeEmojiPanel()},preventDefault(t){t.keyCode===a.ENTER_CODE_KEY&&(t.stopPropagation(),t.preventDefault())},appendAlternativeToImage:(t,e,s)=>t.substring(0,e)+s+t.substring(e,t.length)||"",sendMessage(){let t=this.$refs.messageComposerArea.innerHTML;if(t.indexOf("@")>-1&&(t=this.checkMention(t)),!t||!t.trim())return;const e=t.match(/<img (alt(="")?)?[^>]*>/g);if(e){const s=t.split(/<img (alt(="")?)?[^>]*>/g);e.forEach((t=>{let e=t.match(/alt="" /g)?t.replace(/alt="" /g,""):t;const o=e.match(/alt="([^"]*)"/g);e=o?this.appendAlternativeToImage(e,e.indexOf("src"),`${o} `):e,s[s.findIndex((t=>!t))]=e})),t=s.join("").toString().replaceAll(/<img (alt(="")?)? *src="/g,`<img alt="${this.$t("exoplatform.chat.team.msg.img.alt")}" src="`)}const s={message:t.trim().replace(/(&nbsp;|<br>|<br \/>)$/g,""),room:this.contact.room,clientId:(new Date).getTime().toString(),timestamp:Date.now(),user:eXo.chat.userSettings.username};t=t.replace(/<img src="data:image\/.*;base64[^>]*>/g,"");let a=!1;this.miniChat||this.composerApplications.forEach((e=>{e.shortcutMatches&&e.shortcutMatches(t)&&(e.shortcutCallback?(a=!0,e.shortcutCallback(o,$,t,this.contact)):e.shortcutTriggeredEvent&&(a=!0,document.dispatchEvent(new CustomEvent(e.shortcutTriggeredEvent,{detail:{msg:t,contact:this.contact}}))))})),a||this.$emit("message-written",s),ut(this.userSettings,this.contact.room).then((t=>{ct(this.contact.room,this.contact.fullName,s.message,t)})),this.$refs.messageComposerArea.innerHTML=""},sendMessageWithKey(t){t&&t.keyCode===a.ENTER_CODE_KEY&&(t.ctrlKey||t.altKey||t.shiftKey?$(this.$refs.messageComposerArea).insertAtCaret("\n"):this.sendMessage())},quoteMessage(t){const e=t.detail,s=$(this.$refs.messageComposerArea);if(!e)return;let o=e.msg?e.msg:e.message;o&&(o=o.replace(/<br\/>/g,"\n"),o=$("<div />").html(o).text(),o=`[quote=${e.fullname}] ${o} [/quote]`,s.insertAtCaret(o))},openAppModal(t){this.appsClosed=!0,this.appsModal.app=t,this.appsModal.title=this.$t(t.labelKey),this.appsModal.isOpned=!0},editLastMessage(){const t=this.$refs.messageComposerArea.innerHTML;t&&t.trim().length||(this.$refs.messageComposerArea.innerHTML="",document.dispatchEvent(new CustomEvent(a.ACTION_MESSAGE_EDIT_LAST)))},putFocusOnComposer(){this.$refs.messageComposerArea.focus()},resizeTextarea(t){if("mobile"!==this.mq)return;const e=t.target;e.style.height="40px",e.style.height=`${e.scrollHeight+2}px`,e.scrollTop=e.scrollHeight},checkMention(t){t=(t=$("<div />").html(t).text()).replace(/\s\s+/g," "),t=this.encodeHTMLEntities(t);for(let e=0;e<this.participants.length;e++)if(t.includes(`@${this.participants[e].fullname}`)){this.mentionedUsers.push(this.participants[e].name);const s=`<a href='${$t(this.participants[e].name)}' target='_blank'>@${this.participants[e].fullname}</a>`;t=t.replace(`@${this.participants[e].fullname}`,s)}return rt(this.contact.room,this.contact.fullName,this.mentionedUsers),this.mentionedUsers=[],t},encodeHTMLEntities(t){const e=document.createElement("p");return e.innerText=t,e.innerHTML},paste(t){const e=t.clipboardData.items[0];if(0===e.type.indexOf("image")){const t=e.getAsFile(),s=new FileReader;s.onload=function(t){$("#messageComposerArea").src=t.target.result},s.readAsDataURL(t)}else t.preventDefault(),this.text=this.encodeHTMLEntities((t.originalEvent||t).clipboardData.getData("text/plain")),$(this.$refs.messageComposerArea).insertAtCaret(this.text)}}},me,[],!1,null,null,null).exports;var ue=function(){var t=this,e=t._self._c;return t.spaceChatEnabled?e("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:o}){return[e("div",t._g(t._b({},"div",o,!1),s),[e("v-btn",{attrs:{ripple:!1,icon:"",color:"primary"},on:{click:function(e){return t.openChatDrawer(e)}}},[e("v-icon",{attrs:{size:"18"}},[t._v("fas fa-comments")])],1)],1)]}}],null,!1,2109128765)},[t._v(" "),e("span",[t._v("\n    "+t._s(t.$t("exoplatform.chat.send.message"))+"\n  ")])]):t._e()};ue._withStripped=!0;const pe=Xt({props:{identityType:{type:String,default:""},identityId:{type:String,default:""}},data:()=>({spaceChatEnabled:!0}),created(){"space"===this.identityType&&it().then((t=>{this.userSettings=t,Vt(this.userSettings,this.identityId).then((t=>{this.spaceChatEnabled="true"===t}))}))},methods:{openChatDrawer(t){t.preventDefault(),t.stopPropagation();const e="space"===this.identityType?"space-id":"username",s=this.identityId;document.dispatchEvent(new CustomEvent(a.ACTION_ROOM_OPEN_CHAT,{detail:{name:s,type:e}}))}}},ue,[],!1,null,null,null).exports;var fe=function(){var t=this,e=t._self._c;return e("exo-chat-modal",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],attrs:{id:"chatPreferences",title:t.$t("exoplatform.chat.settings.button.tip"),"modal-class":"chatPreferences"},on:{"modal-closed":t.closeModal}},[e("section",[e("h4",[t._v(t._s(t.$t("exoplatform.chat.desktopNotif.global.notifications")))]),t._v(" "),e("div",{staticClass:"notification-item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.chatPreferences.notifyDonotdisturb,expression:"chatPreferences.notifyDonotdisturb"}],ref:"notifyDonotdisturb",attrs:{id:"notifyDonotdisturb",type:"checkbox"},domProps:{checked:Array.isArray(t.chatPreferences.notifyDonotdisturb)?t._i(t.chatPreferences.notifyDonotdisturb,null)>-1:t.chatPreferences.notifyDonotdisturb},on:{change:function(e){var s=t.chatPreferences.notifyDonotdisturb,o=e.target,a=!!o.checked;if(Array.isArray(s)){var i=t._i(s,null);o.checked?i<0&&t.$set(t.chatPreferences,"notifyDonotdisturb",s.concat([null])):i>-1&&t.$set(t.chatPreferences,"notifyDonotdisturb",s.slice(0,i).concat(s.slice(i+1)))}else t.$set(t.chatPreferences,"notifyDonotdisturb",a)}}}),t._v(" "),e("div",{staticClass:"notification-description"},[e("b",[t._v(" "+t._s(t.$t("exoplatform.chat.desktopNotif.global.donotdist"))+" ")]),t._v(" "),e("em",[t._v(" "+t._s(t.$t("exoplatform.chat.desktopNotif.global.donotdist.description"))+" ")])])])]),t._v(" "),e("section",[e("h4",[t._v(t._s(t.$t("exoplatform.chat.desktopNotif.global.notifyme")))]),t._v(" "),e("div",{staticClass:"notification-item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.chatPreferences.notifyDesktop,expression:"chatPreferences.notifyDesktop"}],ref:"notifyDesktop",attrs:{id:"notifyDesktop",type:"checkbox"},domProps:{checked:Array.isArray(t.chatPreferences.notifyDesktop)?t._i(t.chatPreferences.notifyDesktop,null)>-1:t.chatPreferences.notifyDesktop},on:{change:function(e){var s=t.chatPreferences.notifyDesktop,o=e.target,a=!!o.checked;if(Array.isArray(s)){var i=t._i(s,null);o.checked?i<0&&t.$set(t.chatPreferences,"notifyDesktop",s.concat([null])):i>-1&&t.$set(t.chatPreferences,"notifyDesktop",s.slice(0,i).concat(s.slice(i+1)))}else t.$set(t.chatPreferences,"notifyDesktop",a)}}}),t._v(" "),e("div",{staticClass:"notification-description"},[e("b",[t._v(t._s(t.$t("exoplatform.chat.desktopNotif.global.desktop")))]),t._v(" "),e("em",[t._v(t._s(t.$t("exoplatform.chat.desktopNotif.global.desktop.description")))])])]),t._v(" "),e("div",{staticClass:"notification-item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.chatPreferences.notifyOnSite,expression:"chatPreferences.notifyOnSite"}],ref:"notifyOnSite",attrs:{id:"notifyOnSite",type:"checkbox"},domProps:{checked:Array.isArray(t.chatPreferences.notifyOnSite)?t._i(t.chatPreferences.notifyOnSite,null)>-1:t.chatPreferences.notifyOnSite},on:{change:function(e){var s=t.chatPreferences.notifyOnSite,o=e.target,a=!!o.checked;if(Array.isArray(s)){var i=t._i(s,null);o.checked?i<0&&t.$set(t.chatPreferences,"notifyOnSite",s.concat([null])):i>-1&&t.$set(t.chatPreferences,"notifyOnSite",s.slice(0,i).concat(s.slice(i+1)))}else t.$set(t.chatPreferences,"notifyOnSite",a)}}}),t._v(" "),e("div",{staticClass:"notification-description"},[e("b",[t._v(t._s(t.$t("exoplatform.chat.desktopNotif.global.onsite")))]),t._v(" "),e("em",[t._v(t._s(t.$t("exoplatform.chat.desktopNotif.global.onsite.description")))])])]),t._v(" "),e("div",{staticClass:"notification-item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.chatPreferences.notifyBip,expression:"chatPreferences.notifyBip"}],ref:"notifyBip",attrs:{id:"notifyBip",type:"checkbox"},domProps:{checked:Array.isArray(t.chatPreferences.notifyBip)?t._i(t.chatPreferences.notifyBip,null)>-1:t.chatPreferences.notifyBip},on:{change:function(e){var s=t.chatPreferences.notifyBip,o=e.target,a=!!o.checked;if(Array.isArray(s)){var i=t._i(s,null);o.checked?i<0&&t.$set(t.chatPreferences,"notifyBip",s.concat([null])):i>-1&&t.$set(t.chatPreferences,"notifyBip",s.slice(0,i).concat(s.slice(i+1)))}else t.$set(t.chatPreferences,"notifyBip",a)}}}),t._v(" "),e("div",{staticClass:"notification-description"},[e("b",[t._v(t._s(t.$t("exoplatform.chat.desktopNotif.global.beep")))]),t._v(" "),e("em",[t._v(t._s(t.$t("exoplatform.chat.desktopNotif.global.beep.description")))])])])]),t._v(" "),e("div",{staticClass:"uiAction uiActionBorder"},[e("div",{staticClass:"btn btn-primary",on:{click:t.saveNotificationSettings}},[t._v(" "+t._s(t.$t("exoplatform.chat.user.popup.confirm"))+" ")]),t._v(" "),e("div",{staticClass:"btn",on:{click:t.closeModal}},[t._v(" "+t._s(t.$t("exoplatform.chat.cancel"))+" ")])])])};fe._withStripped=!0;const Ee=Xt({props:{show:{type:Boolean,default:()=>!1}},data:()=>({chatPreferences:{notifyDonotdisturb:!1,notifyDesktop:!0,notifyOnSite:!0,notifyBip:!0},originalChatPreferences:{notifyDonotdisturb:!1,notifyDesktop:!0,notifyOnSite:!0,notifyBip:!0},checkboxesEnhanced:!1}),watch:{show(){if(this.show){if(eXo&&eXo.chat&&eXo.chat.desktopNotificationSettings){const t=eXo.chat.desktopNotificationSettings;this.$refs.notifyDonotdisturb.checked=this.chatPreferences.notifyDonotdisturb=!(t.preferredNotificationTrigger.indexOf(a.NOT_DISTURB_NOTIF)<0),this.$refs.notifyOnSite.checked=this.chatPreferences.notifyOnSite=!(t.preferredNotification.indexOf(a.ON_SITE_NOTIF)<0),this.$refs.notifyDesktop.checked=this.chatPreferences.notifyDesktop=!(t.preferredNotification.indexOf(a.DESKTOP_NOTIF)<0),this.$refs.notifyBip.checked=this.chatPreferences.notifyBip=!(t.preferredNotification.indexOf(a.BIP_NOTIF)<0)}this.originalChatPreferences=JSON.parse(JSON.stringify(this.chatPreferences)),this.checkboxesEnhanced||($.iphoneStyle&&$("#chatPreferences :checkbox").iphoneStyle({disabledClass:"switchBtnDisabled",containerClass:"uiSwitchBtn",labelOnClass:"switchBtnLabelOn",labelOffClass:"switchBtnLabelOff",handleClass:"switchBtnHandle"}),this.checkboxesEnhanced=!0)}}},methods:{saveNotificationSettings(){const t=eXo.chat.userSettings,e=[],s=[];this.chatPreferences.notifyDonotdisturb=this.$refs.notifyDonotdisturb.checked,this.chatPreferences.notifyDesktop=this.$refs.notifyDesktop.checked,this.chatPreferences.notifyOnSite=this.$refs.notifyOnSite.checked,this.chatPreferences.notifyBip=this.$refs.notifyBip.checked,this.originalChatPreferences.notifyDonotdisturb!==this.chatPreferences.notifyDonotdisturb&&e.push(a.NOT_DISTURB_NOTIF),this.originalChatPreferences.notifyDesktop!==this.chatPreferences.notifyDesktop&&s.push(a.DESKTOP_NOTIF),this.originalChatPreferences.notifyOnSite!==this.chatPreferences.notifyOnSite&&s.push(a.ON_SITE_NOTIF),this.originalChatPreferences.notifyBip!==this.chatPreferences.notifyBip&&s.push(a.BIP_NOTIF),(e.length||s.length)&&At(t,s,e).then((t=>{Ot(t),this.originalChatPreferences=this.chatPreferences})),this.closeModal()},closeModal(){this.$emit("close-modal")}}},fe,[],!1,null,null,null).exports;var ge=function(){var t=this,e=t._self._c;return e("exo-chat-modal",{attrs:{title:t.title,"modal-class":"apps-composer-modal"},on:{"modal-closed":t.closeModal}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.errorCode,expression:"errorCode"}],staticClass:"alert alert-error"},[t._v(t._s(t.errorMessage()))]),t._v(" "),e("form",{ref:"appComposerForm",attrs:{id:"appComposerForm",onsubmit:"return false;",action:"",method:"post",enctype:"multipart/form-data","accept-charset":"utf-8"}},[t.sendingMessage?e("div",{staticClass:"chat-loading-mask"},[e("img",{staticClass:"chat-loading",attrs:{src:"/chat/img/sync.gif"}})]):t._e(),t._v(" "),e("div",{class:t.app.appClass,domProps:{innerHTML:t._s(t.appHtml)}}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!0!==t.app.hideModalActions,expression:"app.hideModalActions !== true"}],staticClass:"uiAction uiActionBorder"},[e("button",{staticClass:"btn btn-primary",attrs:{type:"submit"},on:{click:t.saveAppModal}},[t._v("\n        "+t._s(t.$t(t.saveLabelKey))+"\n      ")]),t._v(" "),e("div",{staticClass:"btn",on:{click:t.closeModal}},[t._v(t._s(t.$t("exoplatform.chat.cancel")))])])])])};ge._withStripped=!0;const ve=Xt({props:{app:{type:Object,default:function(){return{}}},title:{type:String,default:""},roomId:{type:String,default:""},contact:{type:Object,default:function(){return{}}}},data:()=>({errorCode:!1,errorOpts:{},sendingMessage:!1}),computed:{appHtml(){const t=this.$t.bind(this);return this.app.html(t)},saveLabelKey(){return this.app.saveLabelKey?this.app.saveLabelKey:"exoplatform.chat.post"}},mounted(){this.app.init&&this.app.init(this.contact)},created(){document.addEventListener(a.ACTION_APPS_CLOSE,this.closeModal),this.app&&this.app.htmlAdded&&this.$nextTick((()=>this.app.htmlAdded($,o)))},destroyed(){document.removeEventListener(a.ACTION_APPS_CLOSE,this.closeModal)},methods:{closeModal(){this.$emit("modal-closed")},saveAppModal(){if(this.errorCode="",!this.$refs.appComposerForm.checkValidity())return;this.sendingMessage=!0;const t=$("#appComposerForm").serializeFormJSON(),e={msg:"",room:this.roomId,clientId:(new Date).getTime().toString(),user:eXo.chat.userSettings.username,isSystem:!0,options:t};if(e.options.fromUser=eXo.chat.userSettings.username,e.options.fromFullname=eXo.chat.userSettings.fullName,e.options.type=this.app.type,this.app.validate&&(this.errorCode=this.app.validate(t),this.errorCode))return void(this.sendingMessage=!1);let s;s=this.app.submit?this.app.submit(o,e,t,this.contact):{ok:!0},s?s.then?s.then((t=>{this.processResult(t,e)})):this.processResult(s,e):(this.errorCode="UknownError",this.sendingMessage=!1)},processResult(t,e){t.errorCode?this.errorCode=t.errorCode:t.ok?(document.dispatchEvent(new CustomEvent(a.ACTION_MESSAGE_SEND,{detail:e})),this.closeModal()):t.hide?this.closeModal():this.errorCode="UknownError",this.sendingMessage=!1},errorMessage(){if(this.errorCode)return this.$t(`exoplatform.chat.${this.errorCode}`,this.errorOpts)}}},ge,[],!1,null,null,null).exports;var _e=function(){var t=this,e=t._self._c;return e("exo-chat-modal",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],attrs:{title:t.title,"modal-class":"room-notification-modal"},on:{"modal-closed":t.closeModal}},[e("div",{staticClass:"chat-room-config"},[e("span",{staticClass:"uiRadio"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedOption,expression:"selectedOption"}],attrs:{type:"radio",value:"normal"},domProps:{checked:t._q(t.selectedOption,"normal")},on:{change:function(e){t.selectedOption="normal"}}}),t._v(" "),e("span",{on:{click:function(e){t.selectedOption="normal"}}},[t._v(" "+t._s(t.$t("exoplatform.chat.desktopNotif.local.normal.label")))])]),t._v(" "),e("em",{staticClass:"notif-description"},[t._v(" "+t._s(t.$t("exoplatform.chat.desktopNotif.local.normal")))]),t._v(" "),e("span",{staticClass:"uiRadio"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedOption,expression:"selectedOption"}],attrs:{type:"radio",value:"silence"},domProps:{checked:t._q(t.selectedOption,"silence")},on:{change:function(e){t.selectedOption="silence"}}}),t._v(" "),e("span",{on:{click:function(e){t.selectedOption="silence"}}},[t._v(" "+t._s(t.$t("exoplatform.chat.desktopNotif.local.silence.label")))])]),t._v(" "),e("em",{staticClass:"notif-description"},[t._v(t._s(t.$t("exoplatform.chat.desktopNotif.local.silence")))]),t._v(" "),e("span",{staticClass:"uiRadio"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedOption,expression:"selectedOption"}],attrs:{type:"radio",value:"keywords"},domProps:{checked:t._q(t.selectedOption,"keywords")},on:{change:function(e){t.selectedOption="keywords"}}}),t._v(" "),e("span",{on:{click:function(e){t.selectedOption="keywords"}}},[t._v(" "+t._s(t.$t("exoplatform.chat.desktopNotif.local.alerton.label"))+" :")])]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.keywords,expression:"keywords"}],staticClass:"notif-keyword",attrs:{disabled:t.disableAdvancedFilter,placeholder:t.$t("exoplatform.chat.desktopNotif.local.alerton.placeholder"),type:"text"},domProps:{value:t.keywords},on:{input:function(e){e.target.composing||(t.keywords=e.target.value)}}}),t._v(" "),e("span",{staticClass:"notif-description"},[t._v(t._s(t.$t("exoplatform.chat.desktopNotif.local.alerton")))])]),t._v(" "),e("div",{staticClass:"uiAction uiActionBorder"},[e("div",{staticClass:"btn btn-primary",on:{click:t.saveSettings}},[t._v(t._s(t.$t("exoplatform.chat.user.popup.confirm")))]),t._v(" "),e("div",{staticClass:"btn",on:{click:t.closeModal}},[t._v(t._s(t.$t("exoplatform.chat.cancel")))])])])};_e._withStripped=!0;const Ce=Xt({props:{show:{type:Boolean,default:()=>!1},room:{type:String,default:()=>""},roomName:{type:String,default:()=>""}},data:()=>({selectedOption:"normal",keywords:""}),computed:{disableAdvancedFilter(){return"keywords"!==this.selectedOption},title(){return this.$t("exoplatform.chat.team.notifications",{0:this.roomName})}},watch:{show(){this.show&&this.getPreferredNotification()}},created(){this.getPreferredNotification()},methods:{closeModal(){this.$emit("modal-closed")},saveSettings(){Tt(eXo.chat.userSettings,this.room,this.selectedOption,"keywords"===this.selectedOption?this.keywords:"",(new Date).getTime().toString()).then((t=>{Ot(t)})),this.closeModal()},getPreferredNotification(){eXo.chat.desktopNotificationSettings&&eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger&&eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger[this.room]?(this.selectedOption=eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger[this.room].notifCond,this.keywords=eXo.chat.desktopNotificationSettings.preferredRoomNotificationTrigger[this.room].keywords):(this.selectedOption="normal",this.keywords="")}}},_e,[],!1,null,null,null).exports;var Se=function(){var t=this,e=t._self._c;return e("div",[e("exo-chat-modal",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],attrs:{title:t.title,"display-close":!0,"modal-class":"create-room-modal"},on:{"modal-closed":t.closeModal}},[e("meta",{attrs:{charset:"utf-8"}}),t._v(" "),e("div",{staticClass:"add-room-form"},[e("label",[t._v(t._s(t.$t("exoplatform.chat.team.name")))]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.fullName,expression:"fullName"}],staticClass:"add-room-name",attrs:{type:"text"},domProps:{value:t.fullName},on:{input:function(e){e.target.composing||(t.fullName=e.target.value)}}}),t._v(" "),e("label",[t._v(t._s(t.$t("exoplatform.chat.team.people")))]),t._v(" "),e("exo-identity-suggester",{key:t.participants,ref:"invitedPeopleAutoComplete",attrs:{"search-options":{},name:"invitePeople",multiple:"","include-users":""},model:{value:t.participants,callback:function(e){t.participants=e},expression:"participants"}}),t._v(" "),e("span",{staticClass:"team-add-user-label"},[t._v(t._s(t.$t("exoplatform.chat.team.help")))])],1),t._v(" "),e("div",{staticClass:"uiAction uiActionBorder"},[e("button",{staticClass:"btn btn-primary",attrs:{disabled:t.disableSave},on:{click:t.saveRoom}},[t._v("\n        "+t._s(t.$t("exoplatform.chat.save"))+"\n      ")]),t._v(" "),e("button",{staticClass:"btn",on:{click:t.closeModal}},[t._v(t._s(t.$t("exoplatform.chat.cancel")))])])]),t._v(" "),e("exo-chat-modal",{directives:[{name:"show",rawName:"v-show",value:t.showErrorModal,expression:"showErrorModal"}],attrs:{title:t.errorModalTitle,"display-close":!0},on:{"modal-closed":function(e){t.showErrorModal=!1}}},[e("ul",{staticClass:"singleMessage popupMessage resizable"},[e("li",[e("span",{staticClass:"errorIcon"},[t._v(t._s(t.errorModalMessage))])])]),t._v(" "),e("div",{staticClass:"uiAction uiActionBorder"},[e("button",{staticClass:"btn btn-primary",on:{click:function(e){t.showErrorModal=!1}}},[t._v(t._s(t.$t("exoplatform.chat.close")))])])])],1)};Se._withStripped=!0;const Te=Xt({props:{selected:{type:Object,default:function(){return{}}},show:{type:Boolean,default:function(){return!1}}},data:()=>({participants:[],fullName:"",showErrorModal:!1,errorModalTitle:"",errorModalMessage:""}),computed:{title(){const t=this.selected&&this.selected.room?"exoplatform.chat.team.edit":"exoplatform.chat.team.add.title";return this.$t(t)},validNewRoomName(){return this.fullName&&this.fullName.trim().length},disableSave(){return!this.validNewRoomName}},watch:{show(t){this.selected&&t&&(this.fullName=this.selected.fullName,this.participants=this.selected.participants?this.mapParticipants(this.selected.participants):[])}},created(){this.selected&&(this.fullName=this.selected.fullName,this.participants=this.selected.participants?this.mapParticipants(this.selected.participants):[])},methods:{saveRoom(){if(this.fullName){let t=this.participants.map((t=>t.remoteId||t.name));t.indexOf(eXo.chat.userSettings.username)<0&&t.unshift(eXo.chat.userSettings.username),t=t.join(","),xt(eXo.chat.userSettings,this.fullName,t,this.selected.room).then((t=>200===t.status?t.json():t.text())).then((t=>{t&&t.room?(this.$emit("room-saved",t.room),this.closeModal()):"roomAlreadyExists.creator"===t?(this.errorModalTitle=this.$t("exoplatform.chat.ErrorRoomCreationTitle"),this.errorModalMessage=this.$t("exoplatform.chat.CreatorErrorRoomCreationMessage"),this.showErrorModal=!0):"roomAlreadyExists.notCreator"===t&&(this.errorModalTitle=this.$t("exoplatform.chat.ErrorRoomCreationTitle"),this.errorModalMessage=this.$t("exoplatform.chat.NotCreatorErrorRoomCreationMessage"),this.showErrorModal=!0)}))}},mapParticipants:t=>t.map((t=>({id:t.name,profile:{fullName:t.fullname,external:t.isExternal,avatarUrl:J(t.name)},remoteId:t.name}))),closeModal(){this.$emit("modal-closed")}}},Se,[],!1,null,null,null).exports;var Ae=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dropdown"},[e("div",{staticClass:"dropdown-toggle",class:t.togglerClass,attrs:{"data-toggle":"dropdown"}},[t._t("toggle")],2),t._v(" "),e("ul",{staticClass:"dropdown-menu",class:t.positionClass},[t._t("menu")],2)])};Ae._withStripped=!0;const ye=Xt({props:{position:{type:String,default:"left"},togglerClass:{type:String,default:""}},computed:{positionClass(){return"right"===this.position?"pull-right":""}}},Ae,[],!1,null,null,null).exports;var Ne=function(){var t=this,e=t._self._c;return e("div",{staticClass:"chat-modal-mask uiPopupWrapper"},[e("div",{staticClass:"uiPopup chat-modal",class:t.modalClass},[e("div",{staticClass:"popupHeader"},[e("span",{staticClass:"PopupTitle popupTitle"},[t._v(t._s(t.title))]),t._v(" "),t.displayClose?e("a",{staticClass:"uiIconClose pull-right",on:{click:t.closeModal}}):t._e()]),t._v(" "),e("div",{staticClass:"PopupContent popupContent"},[t._t("default")],2)])])};Ne._withStripped=!0;const Oe=Xt({props:{displayClose:{type:Boolean,default:!0},title:{type:String,default:""},modalClass:{type:String,default:""}},methods:{closeModal(){this.$emit("modal-closed")}}},Ne,[],!1,null,null,null).exports;var Me=function(){var t=this,e=t._self._c;return e("div",{staticClass:"VuetifyApp"},[t.ap?t._e():e("v-app",{staticClass:"miniChatDrawer",attrs:{id:"miniChatDrawer"}},[e("exo-drawer",{ref:"chatDrawer",staticClass:"chatDrawer",attrs:{"body-classes":"hide-scroll",right:""},on:{closed:t.resetSelectedContact}},[t.showSearch?t._e():e("template",{slot:"title"},[e("div",{staticClass:"leftHeaderDrawer flex-shrink-1 text-truncate"},[t.selectedContact||t.showSearch?t._e():e("span",{staticClass:"chatContactDrawer"},[e("exo-chat-contact",{attrs:{"chat-drawer-contact":t.showChatDrawer,"user-name":t.userSettings.username,status:t.userSettings.status,"is-current-user":!0,type:"u"},on:{"status-changed":function(e){return t.setStatus(e)}}})],1),t._v(" "),e("v-icon",{directives:[{name:"show",rawName:"v-show",value:t.selectedContact,expression:"selectedContact"}],staticClass:"my-auto backButton",on:{click:function(e){return t.backChat()}}},[t._v("\n            mdi-keyboard-backspace\n          ")]),t._v(" "),t.selectedContact&&t.avatarUrl?e("span",[e("img",{staticClass:"chatAvatar",attrs:{src:t.avatarUrl,alt:"avatar of discussion"}}),t._v(" "),e("span",{staticClass:"user-status",class:t.statusStyle},["u"!=t.selectedContact.type||!t.selectedContact.isEnabledUser&&null!==t.selectedContact.isEnabledUser?t._e():e("i",{staticClass:"uiIconStatus"}),t._v(" "),e("span",{attrs:{title:t.getName}},[t._v(t._s(t.getName))])])]):t._e()],1)]),t._v(" "),t.showChatDrawer&&!t.selectedContact?e("template",{slot:"title"},[e("input",{directives:[{name:"show",rawName:"v-show",value:t.showSearch,expression:"showSearch"},{name:"model",rawName:"v-model",value:t.searchTerm,expression:"searchTerm"}],ref:"contactSearch",staticClass:"searchDrawer",attrs:{placeholder:t.$t("exoplatform.chat.contact.search.placeholder"),type:"text"},domProps:{value:t.searchTerm},on:{input:function(e){e.target.composing||(t.searchTerm=e.target.value)}}})]):t._e(),t._v(" "),e("template",{slot:"titleIcons"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.selectedContact&&(t.selectedContact.isEnabledUser||null===t.selectedContact.isEnabledUser),expression:"selectedContact && (selectedContact.isEnabledUser || selectedContact.isEnabledUser === null)"}],staticClass:"title-action-component"},t._l(t.enabledTitleActionComponents,(function(s){return e("div",{key:s.key,ref:s.key,refInFor:!0,class:`${s.appClass} ${s.typeClass}`},[s.component?e("div",[e(s.component.name,t._b({directives:[{name:"dynamic-events",rawName:"v-dynamic-events",value:s.component.events,expression:"action.component.events"}],tag:"component"},"component",s.component.props?s.component.props:{},!1))],1):s.element?e("div",{domProps:{innerHTML:t._s(s.element.outerHTML)}}):s.html?e("div",{domProps:{innerHTML:t._s(s.html)}}):t._e(),t._v("\n            "+t._s(t.initTitleActionComponent(s))+"\n          ")])})),0),t._v(" "),e("v-icon",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom",value:t.$t("exoplatform.chat.quick.create.discussion"),expression:"$t('exoplatform.chat.quick.create.discussion')",modifiers:{bottom:!0}},{name:"show",rawName:"v-show",value:!t.isExternal&&!t.showSearch&&!t.selectedContact,expression:"!isExternal && !showSearch && !selectedContact"}],staticClass:"my-auto",on:{click:t.openQuickCreateChatDiscussionDrawer}},[t._v("\n          mdi-plus\n        ")]),t._v(" "),e("v-icon",{directives:[{name:"show",rawName:"v-show",value:t.showSearch&&!t.selectedContact,expression:"showSearch && !selectedContact"}],staticClass:"my-auto",on:{click:t.closeContactSearch}},[t._v("\n          mdi-filter-remove\n        ")]),t._v(" "),e("v-icon",{directives:[{name:"show",rawName:"v-show",value:!t.showSearch&&!t.selectedContact,expression:"!showSearch && !selectedContact"}],staticClass:"my-auto",attrs:{id:"chatFilter"},on:{click:t.openContactSearch}},[t._v("\n          mdi-filter\n        ")]),t._v(" "),e("v-icon",{directives:[{name:"show",rawName:"v-show",value:"mobile"!==t.mq&&!t.showSearch,expression:"mq !=='mobile' && !showSearch"}],staticClass:"my-auto",attrs:{title:t.$t("exoplatform.chat.open.chat"),id:"openChat"},on:{click:t.navigateTo}},[t._v("\n          mdi-open-in-new\n        ")])],1),t._v(" "),e("template",{slot:"content"},[e("div",{class:t.selectedContact?"contentDrawerOfList":"contentDrawer "},[e("exo-chat-contact-list",{directives:[{name:"show",rawName:"v-show",value:!t.selectedContact&&t.contactList.length>0,expression:"!selectedContact && contactList.length > 0"}],attrs:{"is-chat-drawer":!0,"search-word":t.searchTerm,"drawer-status":t.showChatDrawer,contacts:t.contactList,selected:t.selectedContact,"loading-contacts":t.loadingContacts},on:{"load-more-contacts":t.loadMoreContacts,"contact-selected":t.setSelectedContact,"refresh-contacts":function(e){return t.refreshContacts(e)}}}),t._v(" "),e("exo-chat-message-list",{directives:[{name:"show",rawName:"v-show",value:t.selectedContact,expression:"selectedContact"}],attrs:{"composers-applications":t.composerApplications,contact:t.selectedContact,"user-settings":t.userSettings,"is-opened-contact":!t.selectedContact}})],1)])],2),t._v(" "),e("exo-chat-quick-create-discussion-drawer")],1),t._v(" "),t._m(0)],1)};Me._withStripped=!0;const xe=Xt({name:"ExoChatDrawer",data(){return{composerApplications:[],contactList:[],showSearch:!1,loadingContacts:!0,selectedContact:[],userSettings:{username:"undefined"!=typeof eXo?eXo.env.portal.userName:""},showChatDrawer:!1,fullNameOfUser:"",isOnline:!0,searchTerm:"",totalUnreadMsg:0,external:this.$t("exoplatform.chat.external"),chatLink:`/portal/${eXo.env.portal.portalName}/chat`,titleActionComponents:v,isExternal:!1}},computed:{enabledTitleActionComponents(){return this.titleActionComponents&&this.titleActionComponents.filter((t=>t.enabled))||[]},statusClass(){return"invisible"===this.userSettings.status?"user-offline":`user-${this.userSettings.status}`},statusStyle:function(){return this.selectedContact?void 0!==this.selectedContact?this.isOnline&&"invisible"!==this.selectedContact.status?`user-${this.selectedContact.status}`:"user-offline":"":this.isOnline&&"invisible"!==this.userSettings.status?`user-${this.userSettings.status}`:"user-offline"},getName(){return this.selectedContact?"true"===this.selectedContact.isExternal?`${this.selectedContact.fullName} (${this.external})`:this.selectedContact.fullName:this.userSettings.username},avatarUrl(){return"u"===this.selectedContact.type?J(this.selectedContact.user):"s"===this.selectedContact.type?Q(this.selectedContact.prettyName):a.DEFAULT_ROOM_AVATAR}},watch:{totalUnreadMsg(){ot(this.totalUnreadMsg)}},created(){it(this.userSettings.username).then((t=>{this.initSettings(t);const e=new URLSearchParams(window.location.search);e.has("chatRoomId")&&this.openRoomWithId(e.get("chatRoomId")),T(t),this.composerApplications=_})),this.$userService.getUser(eXo.env.portal.userName).then((t=>{this.isExternal="true"===t.external})),document.addEventListener(a.EVENT_MESSAGE_RECEIVED,this.messageReceived),document.addEventListener(a.EVENT_ROOM_UPDATED,this.roomUpdated),document.addEventListener(a.EVENT_LOGGED_OUT,this.userLoggedout),document.addEventListener(a.EVENT_DISCONNECTED,this.changeUserStatusToOffline),document.addEventListener(a.EVENT_CONNECTED,this.connectionEstablished),document.addEventListener(a.EVENT_RECONNECTED,this.connectionEstablished),document.addEventListener(a.EVENT_USER_STATUS_CHANGED,this.userStatusChanged),document.addEventListener(a.EVENT_GLOBAL_UNREAD_COUNT_UPDATED,this.totalUnreadMessagesUpdated),document.addEventListener(a.ACTION_ROOM_OPEN_CHAT,this.openRoom),I(),q()},destroyed(){document.removeEventListener(a.EVENT_MESSAGE_RECEIVED,this.messageReceived),document.removeEventListener(a.EVENT_ROOM_UPDATED,this.roomUpdated),document.removeEventListener(a.EVENT_LOGGED_OUT,this.userLoggedout),document.removeEventListener(a.EVENT_DISCONNECTED,this.changeUserStatusToOffline),document.removeEventListener(a.EVENT_CONNECTED,this.connectionEstablished),document.removeEventListener(a.EVENT_RECONNECTED,this.connectionEstablished),document.removeEventListener(a.EVENT_USER_STATUS_CHANGED,this.userStatusChanged),document.removeEventListener(a.EVENT_GLOBAL_UNREAD_COUNT_UPDATED,this.totalUnreadMessagesUpdated),document.removeEventListener(a.ACTION_ROOM_OPEN_CHAT,this.openRoom),document.removeEventListener(a.ACTION_CHAT_OPEN_DRAWER,this.openDrawer),b(),j()},mounted(){document.addEventListener(a.ACTION_CHAT_OPEN_DRAWER,this.openDrawer),this.composerApplications=_},methods:{messageReceived(t){const e=t.detail,s=e.room;if(!s)return;const o=this.findContactByRoomOrUser(s,e.data?e.data.user:e.sender);o?(o.lastMessage||(o.lastMessage={}),o.lastMessage=e.data,o.timestamp=e.ts):Ct(eXo.chat.userSettings,s).then((t=>{t&&t.user&&t.user.length&&"undefined"!==t.user&&this.contactList.unshift(t)}))},findContactByRoomOrUser(t,e){let s=null;return t&&t.trim().length&&(s=this.findContact(t,"room")),!s&&e&&e.trim().length&&(s=this.findContact(e,"user")),s},findContact(t,e){return e||(e="room"),this.contactList.find((s=>s[e]===t))},openDrawer(){this.$refs.chatDrawer.startLoading(),this.contactList=[],et(this.userSettings.username,!1,(t=>this.initSettings(t)),(t=>{this.contactList=t.rooms.slice(),this.initChatRooms(t),this.$nextTick(this.$refs.chatDrawer.endLoading)}),!this.ap),this.$refs.chatDrawer.open(),this.showChatDrawer=!0,this.selectedContact=null,window.setTimeout(this.$refs.chatDrawer.endLoading,a.LOADING_ANIMATION_DURATION)},navigateTo(){window.open(this.chatLink,"_blank")},resetSelectedContact(){this.showChatDrawer=!1,this.closeContactSearch(),this.selectedContact=null},setStatus(t){Z(this.userSettings,t,(t=>{this.userSettings.status=t,this.userSettings.originalStatus=t}))},userLoggedout(){F()||this.changeUserStatusToOffline()},totalUnreadMessagesUpdated(t){const e=t.detail?t.detail.data.totalUnreadMsg:t.totalUnreadMsg;e>=0&&(this.totalUnreadMsg=e)},userStatusChanged(t){const e=t.detail;this.userSettings.username===e.sender&&(this.userSettings.status=e.status?e.status:e.data?e.data.status:null,this.userSettings.originalStatus=this.userSettings.status)},connectionEstablished(){eXo.chat.isOnline=!0,this.userSettings.originalStatus&&this.userSettings.originalStatus!==this.userSettings.status?this.setStatus(this.userSettings.originalStatus):this.userSettings&&this.userSettings.originalStatus&&(this.userSettings.status=this.userSettings.originalStatus)},roomUpdated(t){const e=t.detail&&t.detail.data?t.detail.data:null;if(e&&(e.room||e.user)){const t=this.contactList.findIndex((t=>t.room===e.room||t.user===e.user));t<0?this.contactList.unshift(e):this.contactList.splice(t,1,e)}},addRooms(t){this.contactList.forEach((e=>{const s=t.findIndex((t=>t.room===e.room||t.user===e.user));s>=0&&t[s].unreadTotal!==e.unreadTotal&&(e.unreadTotal=t[s].unreadTotal)}));const e=this.contactList.slice(0);(t=t.filter((t=>t.fullName&&t.fullName.trim().length>0&&(t.room&&t.room.trim().length>0||t.user&&t.user.trim().length>0)&&!e.find((e=>e.room===t.room||e.user===t.user)))))&&t.length>0&&t.forEach((t=>{this.contactList.push(t)}))},initSettings(t){this.userSettings=t,st(t.userName,t,(t=>{tt(t).then((t=>this.totalUnreadMsg=t.total)).finally((()=>this.$root.$applicationLoaded()))}));const e=this;this.userSettings.offlineDelay&&setInterval((function(){e.refreshContacts(!0)}),this.userSettings.offlineDelay)},initChatRooms(t){this.loadingContacts=!1;const e=Math.abs(t.unreadOffline)+Math.abs(t.unreadOnline)+Math.abs(t.unreadSpaces)+Math.abs(t.unreadTeams)-Number(t.unreadSilentRooms);e>=0&&(this.totalUnreadMsg=e),ot(e)},loadMoreContacts(t,e,s){let o=0;("All"===e||this.ap)&&(e=""),s&&(o=s*a.ROOMS_PER_PAGE),this.loadingContacts=!0,nt().then((a=>{ft(this.userSettings,a,t,e,o).then((t=>{this.addRooms(t.rooms,s),this.loadingContacts=!1}))}))},setSelectedContact(t){if(t||0!==t.length()||(t={}),"string"==typeof t&&(t=this.contactList.find((e=>e.room===t||e.user===t))),t&&t.fullName&&(t.room||t.user)){eXo.chat.selectedContact=t;const e=this.contactList.findIndex((e=>e.room===t.room||e.user===t.user));e<0?this.contactList.unshift(t):this.contactList.splice(e,1,t)}this.selectedContact=t,Et(eXo.chat.userSettings,t).then((t=>{this.selectedContact.participants=t.users,document.dispatchEvent(new CustomEvent(a.EVENT_ROOM_SELECTION_CHANGED,{detail:this.selectedContact}))})),this.showSearch=!1},refreshContacts(t){nt().then((e=>{ft(this.userSettings,e).then((e=>{if(this.addRooms(e.rooms),!t&&this.selectedContact){const t=this.contactList.find((t=>t.room===this.selectedContact.room||t.user===this.selectedContact.user||t.room===this.selectedContact));t&&this.setSelectedContact(t)}}))}))},searchContacts(t){this.loadingContacts=!0,nt().then((e=>{ft(this.userSettings,e,t).then((t=>{this.addRooms(t.rooms),this.loadingContacts=!1}))}))},changeUserStatusToOffline(){this.userSettings&&this.userSettings.status&&!this.userSettings.originalStatus&&(this.userSettings.originalStatus=this.userSettings.status),eXo.chat.isOnline=!1},reloadPage(){window.location.reload()},openRoom(t){const e=t.detail?t.detail.name:null,s=t.detail?t.detail.type:null;e&&e.trim().length&&_t(this.userSettings,e,s).then((t=>Ct(this.userSettings,t).then((t=>{this.openDrawer(),this.setSelectedContact(t)}))));const o=document.getElementById("tiptip_holder");o&&(o.style.display="none")},openContactSearch(){this.showSearch=!0,this.$nextTick((()=>this.$refs.contactSearch.focus()))},closeContactSearch(){this.showSearch=!1,this.searchTerm=""},openQuickCreateChatDiscussionDrawer(){this.$root.$emit(a.ACTION_CHAT_OPEN_QUICK_CREATE_DISCUSSION_DRAWER)},selectContactSearch(){this.showSearch=!1,this.$nextTick((()=>this.$refs.contactSearch.focus()))},canShowOnSiteNotif:()=>!(eXo&&eXo.chat&&eXo.chat.desktopNotificationSettings)||-1!==eXo.chat.desktopNotificationSettings.preferredNotification.indexOf("on-site"),backChat(){this.selectedContact=null},initTitleActionComponent(t){if(t.init&&!t.isInited&&t.enabled){let e=this.$refs[t.key];e&&(t.isInited=!0,e&&e.length>0&&(e=e[0]),t.init(e,eXo.chat))}},openRoomWithId(t){Ct(this.userSettings,t).then((t=>{this.openDrawer(),this.setSelectedContact(t)})).catch((()=>{this.openDrawer()}));const e=document.getElementById("tiptip_holder");e&&(e.style.display="none")}}},Me,[function(){var t=this,e=t._self._c;return e("div",{staticClass:"hide"},[e("audio",{attrs:{id:"chat-audio-notif",controls:"",hidden:"hidden"}},[e("source",{attrs:{src:"/chat/audio/notif.wav"}}),t._v(" "),e("source",{attrs:{src:"/chat/audio/notif.mp3"}}),t._v(" "),e("source",{attrs:{src:"/chat/audio/notif.ogg"}})])])}],!1,null,null,null).exports;var Re=function(){return this._self._c,this._m(0)};Re._withStripped=!0;const Ie=Xt({props:{value:{type:String,default:null}}},Re,[function(){var t=this;return(0,t._self._c)("div",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:t.value,expression:"value"}],attrs:{contenteditable:"true"},on:{input:function(e){return t.$emit("input",e.target.innerHTML)}}})}],!1,null,null,null).exports;var be=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"QuickCreateDiscussionDrawer",attrs:{id:"QuickCreateDiscussionDrawer",right:""},on:{closed:t.close}},[e("template",{slot:"title"},[e("span",{staticClass:"PopupTitle"},[e("v-icon",{attrs:{left:""},on:{click:t.close}},[t._v("mdi-arrow-left")]),t._v(t._s(t.$t("exoplatform.chat.quick.create.discussion")))],1)]),t._v(" "),e("template",{slot:"content"},[e("v-form",{ref:"Quicksuggester",staticClass:"pa-2 ms-2 mt-4",attrs:{id:"Quicksuggester"}},[e("div",{staticClass:"d-flex flex-column flex-grow-1"},[e("div",{staticClass:"d-flex flex-column mb-2"},[e("label",{staticClass:"d-flex flex-row font-weight-bold my-2"},[t._v(t._s(t.$t("exoplatform.chat.quick.create.discussion.add.people")))]),t._v(" "),e("div",{staticClass:"d-flex flex-row"},[e("v-flex",{staticClass:"user-suggester text-truncate"},[e("exo-identity-suggester",{ref:"invitedPeopleAutoCompleteToRoom",attrs:{"search-options":{},labels:t.suggesterLabels,"include-users":""},model:{value:t.participants,callback:function(e){t.participants=e},expression:"participants"}}),t._v(" "),t.participantItem?e("div",{staticClass:"identitySuggester no-border mt-0"},t._l(t.participantItem,(function(s){return e("exo-chat-quick-discussion-participant-item",{key:s.identity.id,attrs:{attendee:s},on:{"remove-attendee":t.removeAttendee}})})),1):t._e()],1)],1),t._v(" "),e("div",{staticClass:"caption font-weight-light ps-1 muted font-italic"},[e("span",{staticClass:"mr-2"},[e("v-icon",{attrs:{small:""}},[t._v("info")])],1),t._v(t._s(t.$t("exoplatform.chat.quick.create.discussion.info"))+".\n          ")])]),t._v(" "),t.displayQuickDiscussionInputName?e("div",{staticClass:"d-flex flex-column mb-2"},[e("label",{staticClass:"d-flex flex-row font-weight-bold my-2"},[t._v(t._s(t.$t("exoplatform.chat.team.name")))]),t._v(" "),e("div",{staticClass:"d-flex flex-row"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.fullName,expression:"fullName"}],staticClass:"input-block-level ignore-vuetify-classes my-3",attrs:{placeholder:t.$t("exoplatform.chat.quick.create.discussion.room.placeholder"),type:"text"},domProps:{value:t.fullName},on:{input:function(e){e.target.composing||(t.fullName=e.target.value)}}})])]):t._e()])])],1),t._v(" "),e("template",{slot:"footer"},[e("div",{staticClass:"d-flex my-2 flex-row justify-end"},[e("button",{staticClass:"mx-5 px-8 btn",on:{click:function(e){return t.close()}}},[t._v(t._s(t.$t("exoplatform.chat.cancel")))]),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{disabled:t.disabledSaveButton},on:{click:t.quickCreateChatDiscussion}},[t._v("\n        "+t._s(t.$t("exoplatform.chat.quick.discussion.add"))+"\n      ")])])])],2)};be._withStripped=!0;const we=Xt({name:"ExoChatDrawer",components:{},data:()=>({participants:[],participantItem:[],fullName:""}),computed:{validNewRoomName(){return this.fullName&&this.fullName.trim().length},suggesterLabels(){return{placeholder:this.$t("exoplatform.chat.team.help")}},displayQuickDiscussionInputName(){return null!==this.participantItem&&this.participantItem.length>1},disabledSaveButton(){return!(this.participantItem&&1===this.participantItem.length&&!this.validNewRoomName||this.participantItem&&this.participantItem.length>1&&this.validNewRoomName)}},watch:{participants(){if(!this.participants)return void this.$nextTick(this.$refs.invitedPeopleAutoCompleteToRoom.$refs.selectAutoComplete.deleteCurrentItem);this.participantItem||(this.participantItem=[]);const t=this.participantItem?.find((t=>t.identity.remoteId===this.participants.remoteId&&t.identity.providerId===this.participants.providerId));t||this.participantItem.push({identity:this.participants}),this.participants=null}},created(){this.$root.$on(a.ACTION_CHAT_OPEN_QUICK_CREATE_DISCUSSION_DRAWER,this.openDrawer)},methods:{openDrawer(){this.$refs.QuickCreateDiscussionDrawer.open()},close(){this.participants=null,this.participantItem=[],this.fullName="",this.$refs.QuickCreateDiscussionDrawer.close()},removeAttendee(t){const e=this.participantItem.findIndex((e=>t.identity.remoteId===e.identity.remoteId&&t.identity.providerId===e.identity.providerId));e>=0&&this.participantItem.splice(e,1)},openRoomQuickDiscussion(){if(this.fullName){let t=this.participantItem.map((t=>t.identity.remoteId||t.identity.name));t.indexOf(eXo.chat.userSettings.username)<0&&t.unshift(eXo.chat.userSettings.username),t=t.join(","),xt(eXo.chat.userSettings,this.fullName,t,null).then((t=>200===t.status?t.json():t.text())).then((t=>{t&&t.room?(this.$root.$emit("quick-chat-discussion-saved",t.room),this.close(),this.displayAlert(this.$t("exoplatform.chat.quick.create.discussion.success.notification"))):"roomAlreadyExists.creator"===t?this.displayAlert(this.$t("exoplatform.chat.CreatorErrorRoomCreationMessage"),"error"):"roomAlreadyExists.notCreator"===t&&this.displayAlert(this.$t("exoplatform.chat.NotCreatorErrorRoomCreationMessage"),"error")}))}},displayAlert(t,e){document.dispatchEvent(new CustomEvent("notification-alert",{detail:{message:t,type:e||"success"}}))},openOneToOneQuickDiscussion(){const t=this.participantItem[0].identity.remoteId;this.close(),document.dispatchEvent(new CustomEvent(a.ACTION_ROOM_OPEN_CHAT,{detail:{name:t,type:"username"}}))},quickCreateChatDiscussion(){this.validNewRoomName?this.openRoomQuickDiscussion():this.openOneToOneQuickDiscussion()}}},be,[],!1,null,null,null).exports;var $e=function(){var t=this,e=t._self._c;return e("v-chip",{staticClass:"identitySuggesterItem me-4 mt-4",attrs:{close:""},on:{"click:close":function(e){return t.$emit("remove-attendee",t.attendee)}}},[e("v-avatar",{attrs:{left:""}},[e("v-img",{attrs:{src:t.avatarUrl}})],1),t._v(" "),e("span",{staticClass:"text-truncate"},[t._v("\n    "+t._s(t.displayName)+"\n  ")])],1)};$e._withStripped=!0;const De=Xt({props:{attendee:{type:Object,default:()=>({})}},computed:{avatarUrl(){const t=this.attendee.identity&&this.attendee.identity.profile;return t&&(t.avatarUrl||t.avatar||"/portal/rest/v1/social/users/default-image/avatar")},displayName(){const t=this.attendee.identity&&this.attendee.identity.profile,e=t&&(t.displayName||t.fullName);return this.isExternal?`${e} (${this.$t("profile.External")})`:e},isExternal(){const t=this.attendee.identity&&this.attendee.identity.profile;return t&&(t.dataEntity&&"true"===t.dataEntity.external||t.external)}}},$e,[],!1,null,null,null).exports;var ke=function(){var t=this,e=t._self._c;return e("v-app",[t.displayed?[t.displayed?e("v-card",{staticClass:"border-radius",attrs:{id:"chatSpaceSetting",flat:""}},[e("v-list",[e("v-list-item",[e("v-list-item-content",[e("v-list-item-title",{staticClass:"title text-color"},[t._v("\n              "+t._s(t.$t("exoplatform.chat.spaceSettings.external.component.title"))+"\n            ")]),t._v(" "),e("v-list-item-subtitle",[t._v("\n              "+t._s(t.$t("exoplatform.chat.spaceSettings.external.component.description"))+"\n            ")])],1),t._v(" "),e("v-list-item-action",[e("v-switch",{on:{change:t.enableDisableChat},model:{value:t.spaceChatEnabled,callback:function(e){t.spaceChatEnabled=e},expression:"spaceChatEnabled"}})],1)],1)],1)],1):t._e()]:t._e()],2)};ke._withStripped=!0;const Le={"exo-chat-app":Bt,"exo-chat-modal":Oe,"exo-chat-contact":qt,"exo-chat-contact-list":Yt,"exo-chat-room-participants":te,"exo-chat-room-detail":se,"exo-chat-message-list":ae,"exo-chat-global-notification-modal":Ee,"exo-dropdown-select":ye,"exo-chat-room-form-modal":Te,"exo-chat-apps-modal":ve,"exo-chat-message-detail":de,"exo-chat-message-composer":he,"exo-chat-room-notification-modal":Ce,"exo-content-editable":Ie,"exo-chat-drawer":xe,"popover-chat-button":pe,"exo-chat-space-settings":Xt({data:()=>({id:`ChatApp${parseInt(1e4*Math.random())}`,spaceChatEnabled:!1,displayed:!0}),created(){it().then((t=>{this.userSettings=t,Vt(this.userSettings,eXo.env.portal.spaceId).then((t=>{this.spaceChatEnabled="true"===t}))})),document.addEventListener("hideSettingsApps",(t=>{t&&t.detail&&this.id!==t.detail&&(this.displayed=!1)})),document.addEventListener("showSettingsApps",(()=>this.displayed=!0))},methods:{enableDisableChat(){Gt(this.userSettings,eXo.env.portal.spaceId,this.spaceChatEnabled)}}},ke,[],!1,null,null,null).exports,"exo-chat-quick-create-discussion-drawer":we,"exo-chat-quick-discussion-participant-item":De};for(const t in Le)Vue.component(t,Le[t]);const Pe="undefined"!=typeof eXo?eXo.env.portal.language:"en",Ue=`${a.PORTAL}/${a.PORTAL_REST}/i18n/bundle/locale.portlet.chat.Resource-${Pe}.json`;Vue.use(Vuetify);const Fe=new Vuetify(eXo.env.portal.vuetifyPreset);if(Vue.directive("exo-tooltip",(function(t,e){const s=$(t),o=Object.keys(e.modifiers)[0],a=Object.keys(e.modifiers)[1];s.attr("data-original-title",e.value),o&&s.attr("data-placement",o),a&&s.attr("data-container",a),s.tooltip()})),Vue.directive("hold-tap",(function(t,e,s){if("mobile"===s.context.mq){const o=e.value;$(t).off("taphold").on("taphold",(()=>o(s.key)))}})),extensionRegistry){const t=extensionRegistry.loadComponents("chat");t&&t.length>0&&t.forEach((t=>{Vue.component(t.componentName,t.componentOptions)}))}function Ge(){const t=$("#chatApplication").length,e=$("#chatNotification").length,s=t?"Chat":"Chat Topbar";(t||e)&&document.dispatchEvent(new CustomEvent("vue-app-loading-start",{detail:s})),exoi18n.loadLanguageAsync(Pe,Ue,"sync").then((o=>{!function(t){const e={id:"profile-chat",title:t,icon:"uiIconBannerChat",class:"fas fa-comments",additionalClass:"mt-1",order:10,enabled:()=>!0,click:t=>{const e=t.groupId?"space-id":"username",s=t.prettyName?t.id:t.username;document.dispatchEvent(new CustomEvent(a.ACTION_ROOM_OPEN_CHAT,{detail:{name:s,type:e}}))}};extensionRegistry&&extensionRegistry.registerExtension("profile-extension","action",e),document.dispatchEvent(new CustomEvent("profile-extension-updated",{detail:e})),extensionRegistry.registerComponent("SpacePopover","space-popover-action",{id:"chat",vueComponent:Vue.options.components["popover-chat-button"],rank:40}),extensionRegistry.registerComponent("UserPopover","user-popover-action",{id:"chat",vueComponent:Vue.options.components["popover-chat-button"],rank:40})}(o.messages[Pe]["exoplatform.chat.open.chat"]),extensionRegistry&&extensionRegistry.registerComponent("SpaceSettings","space-settings-components",{id:"chat-space-setting",vueComponent:Vue.options.components["exo-chat-space-settings"],rank:10}),t?Vue.createApp({template:"<exo-chat-app></exo-chat-app>",i18n:o,vuetify:Fe},"#chatApplication",s):e&&Vue.createApp({template:"<exo-chat-drawer></exo-chat-drawer>",i18n:o,vuetify:Fe},"#chatNotification",s)}))}return Vue.mixin({data:function(){return{mq:"",ap:!1}},created(){this.handleMediaQuery(),window.addEventListener("resize",this.handleMediaQuery),location.pathname==="/portal/".concat(eXo.env.portal.portalName).concat("/chat")?this.ap=!0:this.ap=!1},methods:{handleMediaQuery(){window.matchMedia("(max-width: 767px)").matches?this.mq="mobile":window.matchMedia("(max-width: 1024px)").matches?this.mq="tablet":this.mq="desktop"}}}),function(t){t.fn.extend({insertAtCaret(e){this.each(((s,o)=>{if(o.focus(),"\n"===e&&window.getSelection()){const e=window.getSelection(),s=e.getRangeAt(0),o=document.createElement("br"),a=document.createTextNode("");s.deleteContents(),s.insertNode(o),s.collapse(!1),s.insertNode(a),s.selectNodeContents(a),e.removeAllRanges(),e.addRange(s);const i=t("#messageComposerArea");i.scrollTop(i.prop("scrollHeight"))}else if(document.getSelection){const t=document.getSelection().getRangeAt(0),s=document.createElement("div");s.innerHTML=e;const o=document.createDocumentFragment();let a,i;for(;a=s.firstChild;)i=o.appendChild(a);t.insertNode(o),i&&(t.setStartAfter(i),t.collapse(!1))}else o.innerHTML+=e,o.focus()}))},serializeFormJSON(){const e={},s=this.serializeArray();return t.each(s,(function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""})),e}})}($),e})()));